if(typeof InkTool==="undefined"){var InkTool={};InkTool.InkFlags=(function(){return {InkTool:false,InkFep:false,InkPDF:false};})();}InkTool.InkFlags.InkTool=true;if(typeof InkTool==="undefined"){var InkTool={};InkTool.InkFlags=(function(){return {InkTool:false,InkFep:false,InkPDF:false};})();InkTool.InkFlags.InkTool=true;}if(typeof InkTool.InkLib==="undefined"){InkTool.InkLib=(function(){var _1=document;var _2=function(){};var _3={log:function(){},debug:function(){},dummy:function(){}};return {Browser:(function(){var ua=navigator.userAgent;var _4=Object.prototype.toString.call(window.opera)=="[object Opera]";return {IE:!!window.attachEvent&&!_4,Opera:_4,WebKit:ua.indexOf("AppleWebKit/")>-1,Gecko:ua.indexOf("Gecko")>-1&&ua.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(ua),Chrome:ua.indexOf("Chrome")>-1,Firefox:ua.indexOf("Firefox")>-1,Safari:ua.indexOf("Safari")>-1&&ua.indexOf("Chrome")===-1&&ua.indexOf("Mobile")===-1};})(),BrowserVersion:(function(){var av=navigator.appVersion.toLowerCase();return {IE:(function(){var _5=av.indexOf("msie ");if(_5<0){return 0;}_5+=5;var _6=av.indexOf(".",_5);if(_6<0){return 0;}return parseInt(av.substring(_5,_6),10);})(),Others:0};})(),Platform:(function(){return window.navigator.platform;})(),SupportsTouches:(("createTouch" in document)||("ontouchstart" in document)),EventHandlerCounter:0,EventHandlers:{},Class:(function(){function _7(){};function _8(_9,_a){if(_9==null){_9=InkTool.Base;}function _b(){this.initialize.apply(this,arguments);};if(_9!=null){_7.prototype=_9.prototype;_b.prototype=new _7;_9.subclasses.push(_b);}for(var _c in _a){_b.prototype[_c]=_a[_c];}_b.superclass=_9;_b.subclasses=[];_b.prototype.constructor=_b;return _b;};function _d(_e,_f){for(var _10 in _f){_e.prototype[_10]=_f[_10];}return _e;};function _11(_12){var _13=new Object();for(var _14 in _12){if(typeof _12[_14].clone=="function"){_13[_14]=_12[_14].clone();}else{_13[_14]=_12[_14];}}return _13;};return {create:_8,extend:_d,clone:_11};})(),Debug:{level:0,console:_3,alert:_2,info:{}},setDebugLevel:function(_15){var _16=InkTool.InkLib.Debug;_16.level=_15;if(_15>0){_16.console=(typeof window.console!=="undefined")?window.console:_3;_16.alert=function(){window.alert.apply(window,arguments);};}else{_16.console=_3;_16.alert=_2;}},getDebugLevel:function(){return InkTool.InkLib.Debug.level;},setDebugInfo:function(key,val){var _17=InkTool.InkLib.Debug;_17.info[key]=val;},getDebugInfo:function(key,_18){var _19=InkTool.InkLib.Debug;var _1a=_19.info[key];if(_1a===null||_1a===undefined){return _18;}else{return _1a;}},addDebugInfo:function(key,_1b,_1c){var _1d=InkTool.InkLib.getDebugInfo(key,_1b);var val=0+_1d+_1c;InkTool.InkLib.setDebugInfo(key,val);},StartTime:(function(){var _1e=new Date();return _1e.getTime();})(),getPerformance:function(){if(!window.performance||!performance.now){var _1f=new Date();return _1f.getTime();}else{var _1f=performance.now();return InkTool.InkLib.StartTime+_1f;}},needsEmulateCanvas:function(){return (InkTool.InkLib.Browser.IE&&InkTool.InkLib.BrowserVersion.IE<=8);},getBrowserTypeName:function(){var _20=InkTool.InkLib.Browser;var _21=InkTool.InkLib.BrowserVersion;if(_20.IE){return "IE"+_21.IE;}else{if(_20.Opera){return "Opera";}else{if(_20.Chrome){return "Chorme";}else{if(_20.Firefox){return "Firefox";}else{if(_20.Safari){return "Safari";}else{if(_20.MobileSafari){return "MobileSafari";}else{if(_20.Gecko){return "Gecko";}else{if(_20.Webkit){return "Webkit";}else{return "Unknown Browser";}}}}}}}}},deepCopy:function(_22){var _23=InkTool.InkLib;var _24;if(_23.typeis("Object",_22)){_24={};for(var key in _22){_24[key]=_23.deepCopy(_22[key]);}}else{if(_23.typeis("Array",_22)){_24=[];for(var idx=0;idx<_22.length;idx++){_24[idx]=_23.deepCopy(_22[idx]);}}else{_24=_22;}}return _24;},typeis:function(_25,obj){var _26=Object.prototype.toString.call(obj).slice(8,-1);return (obj!==undefined&&obj!==null&&_26===_25);},deepEquals:function(_27,_28){var _29=InkTool.InkLib;if(_29.typeis("Object",_28)){if(_29.typeis("Object",_27)==false){return false;}for(var key in _28){if(_29.deepEquals(_27[key],_28[key])==false){return false;}}}else{if(_29.typeis("Array",_28)){if(_29.typeis("Array",_27)==false){return false;}if(_27.length!=_28.length){return false;}for(var idx=0;idx<_28.length;idx++){if(_29.deepEquals(_27[idx],_28[idx])==false){return false;}}}else{if(_27!=_28){return false;}}}return true;},getObjectKeyLength:function(obj){var _2a=InkTool.InkLib;if(_2a.typeis("Object",obj)==false){return 0;}else{if(_2a.typeis("Function",Object.keys)==true){return Object.keys(obj).length;}else{var num=0;for(var key in obj){num++;}return num;}}},getObjectKeys:function(obj){var _2b=InkTool.InkLib;if(_2b.typeis("Object",obj)==false){return [];}else{if(_2b.typeis("Function",Object.keys)==true){return Object.keys(obj);}else{var _2c=[];for(var key in obj){_2c.push(key);}return _2c;}}},getElementById:function(id){if(id===undefined||id===null||id===""){return null;}else{if(_1.getElementById){return _1.getElementById(id);}else{if(_1.all){return _1.all(id);}else{if(_1.layers){return _1.layers[id];}else{return null;}}}}},camelizeString:function(str){var _2d=str.split("-");if(_2d.length==1){return _2d[0];}var _2e=(str.indexOf("-")==0)?_2d[0].charAt(0).toUpperCase()+_2d[0].substring(1):_2d[0];for(var i=1,len=_2d.length;i<len;i++){var s=_2d[i];_2e+=s.charAt(0).toUpperCase()+s.substring(1);}return _2e;},trimString:function(str){var _2f,ch,_30;_30=-1;for(_2f=0;_2f<str.length;_2f++){ch=str.charAt(_2f);if(ch!=" "){_30=_2f;}}return str.substring(0,_30+1);},trimWhiteSpace:function(str){var _31,ch,_32,_33;_32=-1;_33=-1;for(_31=0;_31<str.length;_31++){ch=str.charAt(_31);if(ch!=" "&&ch!="\t"&&ch!="\r"&&ch!="\n"){if(_32<0){_32=_31;}_33=_31;}}return str.substring(_32,_33+1);},diffString:function(_34,_35,max){var _36=InkTool.InkLib.doDiffString(_34,_35,max);if(_36==null){return null;}else{return _36.best.map;}},doDiffString:function(_37,_38,max){if(_37==null||_38==null){return null;}if(max===undefined||max===null){max=0;}var _39={best:{score:-1,map:[]},crnt:{score:-1,map:[]},sflag:[],count:0,cut:0,max:max};var _3a=_38.length;var _3b=_37.length;_39.best.score=_3b*5;_39.crnt.score=0;for(var idx=0;idx<_3b;idx++){_39.best.map.push(-1);_39.crnt.map.push(-1);}for(var idx=0;idx<_3a;idx++){_39.sflag.push(-1);}InkTool.InkLib.rcDiffString(_39,_37,_38,0);return _39;},rcDiffString:function(_3c,_3d,_3e,_3f){if(_3c.max>0&&_3c.count>=_3c.max){return;}if(_3f==_3d.length){if(_3c.crnt.score<_3c.best.score){_3c.best.score=_3c.crnt.score;for(var idx=0;idx<_3c.crnt.map.length;idx++){_3c.best.map[idx]=_3c.crnt.map[idx];}}return;}var obj=_3d.substring(_3f,_3f+1);var _40=false;var _41=false;for(var idx=0;idx<_3e.length;idx++){var src=_3e.substring(idx,idx+1);if(_3c.sflag[idx]>=0){if(obj!=src){continue;}var _42=_3c.sflag[idx];var _43=_3c.crnt.map[_42];var _44=(_42==0)?-1:_3c.crnt.map[_42-1];var _45=_3c.crnt.map[_42+1];var _46=0;if(_44+1!=_43){_46++;}if(_43+1!=_45){_46++;}if(_46<2){continue;}var _47=(_3f==0)?-1:_3c.crnt.map[_3f-1];var _48=-1;if(_3f<_3d.length-1){var _49=_3d.substring(_3f+1,_3f+2);if(idx<_3e.length-1){var _4a=_3e.substring(idx+1,idx+2);if(_49==_4a&&_3c.sflag[idx+1]<0){_48=idx+1;}}}if(_47+1!=idx&&idx+1!=_48){continue;}var _4b=idx;var _4c=(_47+1==idx)?1:2;if(_3c.crnt.score+_4c>_3c.best.score){_3c.cut++;continue;}_3c.count++;_3c.crnt.map[_42]=-1;_3c.crnt.map[_3f]=idx;_3c.crnt.score+=_4c;_3c.sflag[_4b]=_3f;InkTool.InkLib.rcDiffString(_3c,_3d,_3e,_3f+1);_3c.sflag[_4b]=_42;_3c.crnt.score-=_4c;_3c.crnt.map[_3f]=-1;_3c.crnt.map[_42]=_43;_41=true;}else{if(obj==src){var _4b=idx;var _47=(_3f==0)?-1:_3c.crnt.map[_3f-1];var _4c=(idx==_47+1)?0:1;if(_3c.crnt.score+_4c>_3c.best.score){_3c.cut++;continue;}_3c.count++;_3c.crnt.map[_3f]=_4b;_3c.crnt.score+=_4c;_3c.sflag[_4b]=_3f;InkTool.InkLib.rcDiffString(_3c,_3d,_3e,_3f+1);_3c.sflag[_4b]=-1;_3c.crnt.score-=_4c;_3c.crnt.map[_3f]=-1;_41=true;}else{_40=true;}}}if(_40==true||_41==false){if(_41==true){var _4d=false;for(var idx=_3f+1;idx<_3d.length;idx++){var _4e=_3d.substring(idx,idx+1);if(obj==_4e){_4d=true;break;}}if(_4d==false){return;}}var _4b=-1;var _4c=2;if(_3c.crnt.score+_4c>_3c.best.score){_3c.cut++;return;}_3c.count++;_3c.crnt.map[_3f]=_4b;_3c.crnt.score+=_4c;InkTool.InkLib.rcDiffString(_3c,_3d,_3e,_3f+1);_3c.crnt.score-=_4c;_3c.crnt.map[_3f]=-1;}},stringToUtf8Bytes:function(_4f){var _50=[];if(_4f==null){return _50;}for(var i=0;i<_4f.length;i++){var c=_4f.charCodeAt(i);if(c<=127){_50.push(c);}else{if(c<=2047){_50.push(((c>>6)&31)|192);_50.push((c&63)|128);}else{_50.push(((c>>12)&15)|224);_50.push(((c>>6)&63)|128);_50.push((c&63)|128);}}}return _50;},utf8BytesToString:function(arr){if(arr==null){return null;}var _51="";var i;while(i=arr.shift()){if(i<=127){_51+=String.fromCharCode(i);}else{if(i<=223){var c=((i&31)<<6);c+=arr.shift()&63;_51+=String.fromCharCode(c);}else{if(i<=224){var c=((arr.shift()&31)<<6)|2048;c+=arr.shift()&63;_51+=String.fromCharCode(c);}else{var c=((i&15)<<12);c+=(arr.shift()&63)<<6;c+=arr.shift()&63;_51+=String.fromCharCode(c);}}}}return _51;},getStyleOfElement:function(_52,_53,_54){if(_52.currentStyle){return _52.currentStyle[InkTool.InkLib.camelizeString(_53)];}else{if(getComputedStyle){return getComputedStyle(_52,"").getPropertyValue(_53);}else{if(_1.defaultView){return _1.defaultView.getComputedStyle(_52,"").getPropertyValue(_53);}else{return _54;}}}},getStyleById:function(id,_55,_56){var _57=InkTool.InkLib.getElementById(id);if(_57==null){return _56;}else{return InkTool.InkLib.getStyleOfElement(_57,_55,_56);}},getScrollX:function(){if(window.scrollX){return window.scrollX;}else{if(window.pageXOffset){return window.pageXOffset;}else{if(_1.documentElement&&_1.documentElement.scrollLeft){return _1.documentElement.scrollLeft;}else{if(_1.body&&_1.body.scrollLeft){return _1.body.scrollLeft;}else{return 0;}}}}},getScrollY:function(){if(window.scrollY){return window.scrollY;}else{if(window.pageYOffset){return window.pageYOffset;}else{if(_1.documentElement&&_1.documentElement.scrollTop){return _1.documentElement.scrollTop;}else{if(_1.body&&_1.body.scrollTop){return _1.body.scrollTop;}else{return 0;}}}}},getClientX:function(){if(_1.documentElement&&_1.documentElement.clientLeft){return _1.documentElement.clientLeft;}else{if(_1.body&&_1.body.clientLeft){return _1.body.clientLeft;}else{return 0;}}},getClientY:function(){if(_1.documentElement&&_1.documentElement.clientTop){return _1.documentElement.clientTop;}else{if(_1.body&&_1.body.clientTop){return _1.body.clientTop;}else{return 0;}}},getOffsetX:function(_58){if(typeof window.crypto!="undefined"&&typeof window.getComputedStyle!="undefined"&&obj.style.left){return InkTool.InkLib.getClientX()+parseInt(_58.style.left);}else{return InkTool.InkLib.getClientX()+(_1.layers?_58.left:(_58.offsetLeft||_58.style.pixelLeft||0));}},getOffsetY:function(_59){if(typeof window.crypto!="undefined"&&typeof window.getComputedStyle!="undefined"&&obj.style.top){return InkTool.InkLib.getClientY()+parseInt(_59.style.top);}else{return InkTool.InkLib.getClientY()+(_1.layers?_59.top:(_59.offsetTop||_59.style.pixelTop||0));}},getEventX:function(_5a,_5b){sx=InkTool.InkLib.getScrollX();if(_5b!=null){ox=InkTool.InkLib.getOffsetX(_5b);}else{ox=0;}return _5a.clientX-ox+sx;},getEventY:function(_5c,_5d){sy=InkTool.InkLib.getScrollY();if(_5d!=null){oy=InkTool.InkLib.getOffsetY(_5d);}else{oy=0;}return _5c.clientY-oy+sy;},getClientWidth:function(){if(_1.documentElement.clientWidth){return _1.documentElement.clientWidth;}else{if(_1.body.clientWidth){return _1.body.clientWidth;}else{return window.innerWidth;}}},getClientHeight:function(){if(_1.documentElement.clientHeight){return _1.documentElement.clientHeight;}else{if(_1.body.clientHeight){return _1.body.clientHeight;}else{return window.innerHeight;}}},getPageWidth:function(){var _5e=InkTool.InkLib;var max=null;max=_5e.max(max,document.body.clientWidth);max=_5e.max(max,document.body.scrollWidth);max=_5e.max(max,document.documentElement.clientWidth);max=_5e.max(max,document.documentElement.scrollWidth);return max;},getPageHeight:function(){var _5f=InkTool.InkLib;var max=null;max=_5f.max(max,document.body.clientHeight);max=_5f.max(max,document.body.scrollHeight);max=_5f.max(max,document.documentElement.clientHeight);max=_5f.max(max,document.documentElement.scrollHeight);return max;},getElementSize:function(_60){if(_60==null){return {width:InkTool.InkLib.getClientWidth(),height:InkTool.InkLib.getClientHeight()};}if(InkTool.InkLib.getStyleOfElement(_60,"display","")!="none"){return {width:_60.offsetWidth,height:_60.offsetHeight};}var _61=_60.style.visibility;var _62=_60.style.position;_60.style.visibility="hidden";_60.style.position="absolute";_60.style.display="";var _63=_60.clientWidth;var _64=_60.clientHeight;_60.style.display="none";_60.style.position=_62;_60.style.visibility=_61;return {width:_63,height:_64};},getElementLocation:function(_65){var _66=_65;if(_66.getBoundingClientRect){var _67=_66.getBoundingClientRect();var _68=InkTool.InkLib.getScrollX();var _69=InkTool.InkLib.getScrollY();return {left:Math.round(_68+_67.left),top:Math.round(_69+_67.top)};}var xp=0;var yp=0;while(_66){xp+=_66.offsetLeft;yp+=_66.offsetTop;_66=_66.offsetParent;if(_66==null){break;}var pos=InkTool.InkLib.getStyleOfElement(_66,"position","");if(InkTool.InkLib.Browser.IE){if(pos!="absolute"&&pos!="fixed"){xp+=(parseInt(InkTool.InkLib.getStyleOfElement(_66,"border-left-width","0"))||0);yp+=(parseInt(InkTool.InkLib.getStyleOfElement(_66,"border-top-width","0"))||0);}else{if(InkTool.InkLib.BrowserVersion.IE>=9){xp+=(parseInt(InkTool.InkLib.getStyleOfElement(_66,"border-left-width","0"))||0);yp+=(parseInt(InkTool.InkLib.getStyleOfElement(_66,"border-top-width","0"))||0);}if(pos=="fixed"){var _68=InkTool.InkLib.getScrollX();var _69=InkTool.InkLib.getScrollY();xp+=_68;yp+=_69;}}}else{if(pos=="absolute"||pos=="fixed"){xp+=(parseInt(InkTool.InkLib.getStyleOfElement(_66,"border-left-width","0"))||0);yp+=(parseInt(InkTool.InkLib.getStyleOfElement(_66,"border-top-width","0"))||0);if(pos=="fixed"){var _68=InkTool.InkLib.getScrollX();var _69=InkTool.InkLib.getScrollY();xp+=_68;yp+=_69;}}}}if(InkTool.InkLib.Browser.Gecko){var bd=_1.getElementsByTagName("BODY")[0];xp+=2*(parseInt(InkTool.InkLib.getStyleOfElement(bd,"border-left-width","0"))||0);yp+=2*(parseInt(InkTool.InkLib.getStyleOfElement(bd,"border-top-width","0"))||0);}return {left:xp,top:yp};},getElementAbsoluteLocation:function(_6a){var _6b=_6a;var xp=0;var yp=0;while(_6b){xp+=_6b.offsetLeft;yp+=_6b.offsetTop;_6b=_6b.offsetParent;if(_6b==null){break;}var pos=InkTool.InkLib.getStyleOfElement(_6b,"position","");if(pos!=""&&pos!="static"){if(InkTool.InkLib.Browser.IE&&InkTool.InkLib.BrowserVersion.IE<9){xp-=(parseInt(InkTool.InkLib.getStyleOfElement(_6b,"border-left-width","0"))||0);yp-=(parseInt(InkTool.InkLib.getStyleOfElement(_6b,"border-top-width","0"))||0);}break;}if(InkTool.InkLib.Browser.IE){xp+=(parseInt(InkTool.InkLib.getStyleOfElement(_6b,"border-left-width","0"))||0);yp+=(parseInt(InkTool.InkLib.getStyleOfElement(_6b,"border-top-width","0"))||0);}}if(InkTool.InkLib.Browser.Gecko&&(_6b==null)){var bd=_1.getElementsByTagName("BODY")[0];xp+=2*(parseInt(InkTool.InkLib.getStyleOfElement(bd,"border-left-width","0"))||0);yp+=2*(parseInt(InkTool.InkLib.getStyleOfElement(bd,"border-top-width","0"))||0);}return {left:xp,top:yp};},getElementOfEventPosition:function(evt){var _6c;if(evt.target){_6c=evt.target;}else{if(window.navigator.pointerEnabled||window.navigator.msPointerEnabled){var xp=evt.clientX;var yp=evt.clientY;_6c=document.elementFromPoint(xp,yp);}else{var _6d=InkTool.InkLib.getEventPosition(evt);var _6e=InkTool.InkLib.convertPositionEventToAbsolute(_6d);_6c=document.elementFromPoint(_6e.left,_6e.top);}}return _6c;},getElementIdOfEventPosition:function(evt){var _6f;if(evt.target){return evt.target.id;}else{if(window.navigator.pointerEnabled||window.navigator.msPointerEnabled){var xp=evt.clientX;var yp=evt.clientY;_6f=document.elementFromPoint(xp,yp);}else{var _70=InkTool.InkLib.getEventPosition(evt);var _71=InkTool.InkLib.convertPositionEventToAbsolute(_70);_6f=document.elementFromPoint(_71.left,_71.top);}}return _6f?_6f.id:"";},isElementFixed:function(_72){var _73=_72;while(_73){var pos=InkTool.InkLib.getStyleOfElement(_73,"position","");if(pos=="fixed"){return true;}else{if(pos=="absolute"){return false;}}_73=_73.offsetParent;}return false;},addElementAfter:function(_74,_75){if(_74.nextSibling){_74.parentNode.insertBefore(_75,_74.nextSibling);}else{_74.parentNode.appendChild(_75);}},getMaxZIndex:function(){var _76=0;var _77=document.defaultView;var _78=function(_79){var _7a=document.getElementsByTagName(_79);for(var _7b=0;_7b<_7a.length;_7b++){var _7c=_7a[_7b];var _7d=InkTool.InkLib.getStyleOfElement(_7c,"z-index","0");_7d-=0;if(_76<_7d){_76=_7d;}}};if(arguments.length==0){_78("*");}else{for(var ct=0;ct<arguments.length;ct++){_78(arguments[ct]);}}return _76;},showElement:function(_7e){if(_7e!=null){_7e.style.visibility="visible";}},hideElement:function(_7f){if(_7f!=null){_7f.style.visibility="hidden";}},showElementById:function(id){InkTool.InkLib.showElement(InkTool.InkLib.getElementById(id));},hideElementById:function(id){InkTool.InkLib.hideElement(InkTool.InkLib.getElementById(id));},showPopup:function(_80,_81){InkTool.InkLib.showPopupBottom(_80,_81);},showPopupById:function(_82,_83){var _84=InkTool.InkLib.getElementById(_82);var _85=InkTool.InkLib.getElementById(_83);InkTool.InkLib.showPopup(_84,_85);},showPopupBottom:function(_86,_87){if(_86==null||_87==null){return;}var _88=InkTool.InkLib;var pos=_88.getElementLocation(_86);var _89=_88.getElementSize(_86);var _8a;if(_88.isElementFixed(_86)==true){_8a="fixed";}else{_8a="absolute";}var xp=pos.left;var yp=pos.top+_89.height;var _8b=_88.getElementSize(_87);var _8c=_88.getScrollX();var _8d=_88.getScrollY();var _8e=_88.getClientWidth();if(xp+_8b.width>_8c+_8e){xp=_8c+_8e-_8b.width;if(xp<_8c){xp=_8c;}}if(_8a=="fixed"){xp-=_8c;yp-=_8d;}_87.style.position=_8a;_87.style.left=""+xp+"px";_87.style.top=""+yp+"px";_88.showElement(_87);},showPopupBottomById:function(_8f,_90){var _91=InkTool.InkLib;var _92=_91.getElementById(_8f);var _93=_91.getElementById(_90);_91.showPopupBottom(_92,_93);},showPopupTop:function(_94,_95){if(_94==null||_95==null){return;}var _96=InkTool.InkLib;var pos=_96.getElementLocation(_94);var _97=_96.getElementSize(_95);var _98;if(_96.isElementFixed(_94)==true){_98="fixed";}else{_98="absolute";}var xp=pos.left;var yp=pos.top-_97.height;var _99=_96.getClientWidth();var _9a=_96.getScrollX();var _9b=_96.getScrollY();if(xp+_97.width>_9a+_99){xp=_9a+_99-_97.width;if(xp<_9a){xp=_9a;}}if(_98=="fixed"){xp-=_9a;yp-=_9b;}_95.style.position=_98;_95.style.left=""+xp+"px";_95.style.top=""+yp+"px";_96.showElement(_95);},showPopupTopById:function(_9c,_9d){var _9e=InkTool.InkLib;var _9f=_9e.getElementById(_9c);var _a0=_9e.getElementById(_9d);_9e.showPopupTop(_9f,_a0);},showPopupAuto:function(_a1,_a2){if(_a1==null||_a2==null){return;}var _a3=InkTool.InkLib;var pos=_a3.getElementLocation(_a1);var _a4=_a3.getElementSize(_a1);var _a5=_a3.getElementSize(_a2);var _a6;if(_a3.isElementFixed(_a1)==true){_a6="fixed";}else{_a6="absolute";}var _a7=_a3.getScrollX();var _a8=_a3.getScrollY();var _a9=_a3.getClientWidth();var _aa=_a3.getClientHeight();var _ab=_a3.getPageWidth();var _ac=_a3.getPageHeight();var xp=pos.left;var yp;var _ad=pos.top+_a4.height;var _ae=pos.top-_a5.height;var _af=0;if(_ad>=0&&_ad+_a5.height<_ac){_af=1;}if(_ad>=_a8&&_ad+_a5.height<_a8+_aa){_af=2;}var _b0=0;if(_ae>=0&&_ae+_a5.height<_ac){_b0=1;}if(_ae>=_a8&&_ae+_a5.height<_a8+_aa){_b0=2;}if(_af>=_b0){yp=_ad;}else{yp=_ae;}if(xp+_a5.width>_a7+_a9){xp=_a7+_a9-_a5.width;if(xp<_a7){xp=_a7;}}if(_a6=="fixed"){xp-=_a7;yp-=_a8;}_a2.style.position=_a6;_a2.style.left=""+xp+"px";_a2.style.top=""+yp+"px";_a3.showElement(_a2);},showPopupAutoById:function(_b1,_b2){var _b3=InkTool.InkLib;var _b4=_b3.getElementById(_b1);var _b5=_b3.getElementById(_b2);_b3.showPopupAuto(_b4,_b5);},showPopupCenter:function(_b6,_b7,_b8){if(_b6==null){return;}var _b9=InkTool.InkLib;var _ba=_b9.getStyleOfElement(_b6,"position","");var _bb=_b9.getElementSize(_b6);var _bc=_b9.getScrollX();var _bd=_b9.getScrollY();var _be=_b9.getClientWidth();var _bf=_b9.getClientHeight();var _c0=_b9.getPageWidth();var _c1=_b9.getPageHeight();if(_b7==true){if(_ba=="absolute"){var xp=(_c0-_bb.width)/2;_b6.style.left=""+xp+"px";}else{if(_ba=="fixed"){var xp=(_be-_bb.width)/2;_b6.style.left=""+xp+"px";}}}if(_b8==true){if(_ba=="absolute"){var yp=(_c1-_bb.height)/2;_b6.style.top=""+yp+"px";}else{if(_ba=="fixed"){var yp=(_bf-_bb.height)/2;_b6.style.top=""+yp+"px";}}}_b9.showElement(_b6);},showPopupCenterById:function(_c2,_c3,_c4){var _c5=InkTool.InkLib;var _c6=_c5.getElementById(_c2);_c5.showPopupCenter(_c6,_c3,_c4);},addEvent:function(_c7,_c8,fn){if(_c7==null){if(document.addEventListener){document.addEventListener(_c8,fn,false);return true;}else{if(document.attachEvent){return document.attachEvent("on"+_c8,fn);}else{return false;}}}else{if(_c7.addEventListener){_c7.addEventListener(_c8,function(){return fn.apply(_c7,arguments);},false);return true;}else{if(_c7.attachEvent){return _c7.attachEvent("on"+_c8,function(){return fn.apply(_c7,arguments);});}else{return false;}}}},addDynamicEvent:function(_c9,_ca,fn){var _cb;if(_c9==null){_c9=document;_cb={"elem":_c9,"event":_ca,"func":fn};}else{_cb={"elem":_c9,"event":_ca,"func":function(){return fn.apply(_c9,arguments);}};}InkTool.InkLib.EventHandlerCounter++;var hid=""+InkTool.InkLib.EventHandlerCounter;if(_c9.addEventListener){_c9.addEventListener(_ca,_cb.func,false);InkTool.InkLib.EventHandlers[hid]=_cb;return hid;}else{if(_c9.attachEvent){if(_c9.attachEvent("on"+_ca,_cb.func)==true){InkTool.InkLib.EventHandlers[hid]=_cb;return hid;}}}return null;},removeDynamicEvent:function(hid){var _cc=InkTool.InkLib.EventHandlers[hid];if(_cc==null){return false;}var _cd=_cc.elem;var _ce=_cc.event;var _cf=_cc.func;delete InkTool.InkLib.EventHandlers[hid];if(_cd.removeEventListener){_cd.removeEventListener(_ce,_cf,false);return true;}else{if(_cd.detachEvent){return _cd.detachEvent("on"+_ce,_cf);}else{return false;}}},contains:function(_d0,_d1){for(var i,len=_d0.length;i<len;i++){if(_d0[i]===_d1){return true;}}return false;},max:function(_d2,_d3){var _d4=(_d2===null||_d2===undefined||_d2===NaN);var _d5=(_d3===null||_d3===undefined||_d3===NaN);if(_d4&&_d5){return null;}else{if(_d4){return _d3;}else{if(_d5){return _d2;}else{if(_d2>=_d3){return _d2;}else{return _d3;}}}}},min:function(_d6,_d7){var _d8=(_d6===null||_d6===undefined||_d6===NaN);var _d9=(_d7===null||_d7===undefined||_d7===NaN);if(_d8&&_d9){return null;}else{if(_d8){return _d7;}else{if(_d9){return _d6;}else{if(_d6<=_d7){return _d6;}else{return _d7;}}}}},getLastEvent:function(evt){if(window.event){return window.event;}else{return evt;}},getEventPosition:function(evt){if(window.navigator.pointerEnabled||window.navigator.msPointerEnabled){return {left:(evt.clientX+InkTool.InkLib.getScrollX()),top:(evt.clientY+InkTool.InkLib.getScrollY())};}else{return {left:(evt.pageX?evt.pageX:evt.clientX+InkTool.InkLib.getScrollX()),top:(evt.pageY?evt.pageY:evt.clientY+InkTool.InkLib.getScrollY())};}},getEventPointerType:function(evt){var _da=evt.pointerType;if(_da){switch(_da){case 2:case "touch":return "touch";case 3:case "pen":return "pen";case 4:case "mouse":return "mouse";default:return "unknown";}}else{return "notype";}},getEventPressure:function(evt){if(evt.pressure){return evt.pressure;}else{return 0;}},getTouchEventPositionsLength:function(evt){if(evt.touches){return evt.touches.length;}else{return 0;}},getTouchEventPosition:function(evt,_db){if(evt.touches&&_db>=0&&_db<evt.touches.length){return InkTool.InkLib.getEventPosition(evt.touches[_db]);}else{return null;}},getTouchEventId:function(evt,_dc){if(evt.touches&&_dc>=0&&_dc<evt.touches.length){return evt.touches[_dc].identifier;}else{return null;}},getTouchEventPressure:function(evt,_dd){if(evt.touches&&_dd>=0&&_dd<evt.touches.length){var _de=evt.touches[_dd];if(_de.force){return _de.force;}else{if(_de.webkitForce){return _de.webkitForce;}else{return 0;}}}else{return 0;}},getTargetTouchEventPositionsLength:function(evt){if(evt.targetTouches){return evt.targetTouches.length;}else{return 0;}},getTargetTouchEventPosition:function(evt,_df){if(evt.targetTouches&&_df>=0&&_df<evt.targetTouches.length){return InkTool.InkLib.getEventPosition(evt.targetTouches[_df]);}else{return null;}},getTargetTouchEventId:function(evt,_e0){if(evt.targetTouches&&_e0>=0&&_e0<evt.targetTouches.length){return evt.targetTouches[_e0].identifier;}else{return null;}},getTargetTouchEventPressure:function(evt,_e1){if(evt.targetTouches&&_e1>=0&&_e1<evt.targetTouches.length){var _e2=evt.targetTouches[_e1];if(_e2.force){return _e2.force;}else{if(_e2.webkitForce){return _e2.webkitForce;}else{return 0;}}}else{return 0;}},getChangedTouchEventPositionsLength:function(evt){if(evt.changedTouches){return evt.changedTouches.length;}else{return 0;}},getChangedTouchEventPosition:function(evt,_e3){if(evt.changedTouches&&_e3>=0&&_e3<evt.changedTouches.length){return InkTool.InkLib.getEventPosition(evt.changedTouches[_e3]);}else{return null;}},getChangedTouchEventId:function(evt,_e4){if(evt.changedTouches&&_e4>=0&&_e4<evt.changedTouches.length){return evt.changedTouches[_e4].identifier;}else{return null;}},getChangedTouchEventPressure:function(evt,_e5){if(evt.changedTouches&&_e5>=0&&_e5<evt.changedTouches.length){var _e6=evt.changedTouches[_e5];if(_e6.force){return _e6.force;}else{if(_e6.webkitForce){return _e6.webkitForce;}else{return 0;}}}else{return 0;}},getPointerEventId:function(evt){return evt.pointerId;},convertPositionDocumentToElement:function(pos,_e7){var _e8=InkTool.InkLib.getElementLocation(_e7);return {left:pos.left-_e8.left,top:pos.top-_e8.top};},convertPositionEventToAbsolute:function(pos){return {left:pos.left-InkTool.InkLib.getScrollX(),top:pos.top-InkTool.InkLib.getScrollY()};},getEventPositionOfElement:function(evt,_e9){var _ea=InkTool.InkLib.getEventPosition(evt);var _eb=InkTool.InkLib.getElementLocation(_e9);return {left:_ea.left-_eb.left,top:_ea.top-_eb.top};},preventDefaultActionOfEvent:function(evt,_ec,_ed){if(_ec){if(evt.preventDefault){evt.preventDefault();}else{evt.returnValue=false;}}if(_ed){if(InkTool.InkLib.Browser.IE){evt.cancelBubble=true;}else{evt.stopPropagation();}}},getButtonPushed:function(_ee,_ef){var _f0=InkTool.InkLib.Browser;if(_f0.IE){var _f1={0:1,1:4,2:2};return (_ee.button===_f1[_ef]);}else{if(_f0.WebKit){switch(_ef){case 0:return _ee.which==1&&!_ee.metaKey;case 1:return _ee.which==2||(_ee.which==1&&_ee.metaKey);case 2:return _ee.which==3;default:return false;}}else{return _ee.which?(_ee.which===_ef+1):(_ee.button===_ef);}}},getButtonStatus:function(_f2){if(InkTool.InkLib.getButtonPushed(_f2,0)){return 1;}else{if(InkTool.InkLib.getButtonPushed(_f2,1)){return 2;}else{if(InkTool.InkLib.getButtonPushed(_f2,2)){return 3;}else{return 0;}}}},preLoadImage:function(_f3){var img=new Image();img.src=_f3+"?"+new Date().getTime();return img;},setSelectionToElement:function(_f4,_f5,end){if(_f4.setSelectionRange){_f4.setSelectionRange(_f5,end);}else{var _f6=-(_f4.value.length-end);var _f7=_f4.createTextRange();_f7.moveStart("character",_f5);_f7.moveEnd("character",_f6);_f7.select();}},selectAllOfElement:function(_f8){InkTool.InkLib.setSelectionToElement(_f8,0,_f8.value.length);},insertTextToElement:function(_f9,_fa){_f9.focus();if((_f9.selectionStart||_f9.selectionStart==0)&&(_f9.selectionEnd||_f9.selectionEnd==0)){var _fb=_f9.value;_f9.value=_fb.substring(0,_f9.selectionStart)+_fa+_fb.substring(_f9.selectionEnd,_fb.length);}else{var _fc=_1.selection.createRange();_fc.text=_fa;}},disableSelection:function(_fd){if(typeof _fd.onselectstart!="undefined"){_fd.onselectstart=function(){return false;};}else{if(typeof _fd.style.MozUserSelect!="undefined"){_fd.style.MozUserSelect="none";}else{_fd.onmousedown=function(){return false;};}}_fd.style.cursor="default";},setCookie:function(_fe,_ff){for(var key in _fe){var str=""+key+"="+encodeURIComponent(_fe[key]);if(_ff!=null&&_ff!=undefined){var _100=new Date();_100.setTime(_100.getTime()+_ff);str+=" ;expires="+_100.toUTCString();}document.cookie=str;}},getCookie:function(){var _101=new Object();var _102=document.cookie;if(_102!=""){var _103=_102.split(";");for(var _104=0;_104<_103.length;_104++){var _105=_103[_104].split("=");var key=InkTool.InkLib.trimWhiteSpace(_105[0]);var val=InkTool.InkLib.trimWhiteSpace(decodeURIComponent(_105[1]));_101[key]=val;}}return _101;},getCookieValue:function(_106,key,_107){if(_106==null){return _107;}var resp=_106[key];if(resp!=null&&resp!=undefined){if(typeof (_107)=="number"){return Number(resp);}else{if(typeof (_107)=="boolean"){if(resp=="false"){return false;}else{return Boolean(resp);}}else{return resp;}}}else{return _107;}},sendString:function(str,url,_108,_109,_10a){var _10b=InkTool.InkLib.getXmlHttpObject();var _10c={"httpobj":_10b,"trynum":_108,"tried":0,"interval":_109,"canceled":false,"error":false};_10b.onreadystatechange=function(){if(_10b.readyState==4){if(_10b.status==200){_10c.tried++;_10c.error=false;if(typeof (_10a)==="function"){_10a(_10c,_10b.responseText);}else{alert("resp="+_10b.responseText);}}else{_10c.tried++;_10c.error=true;if(typeof (_10a)==="function"){_10a(_10c,_10b.responseText);}else{alert("status error:"+_10b.status+":resp="+_10b.responseText);}if(_10c.canceled!=true&&(_10c.trynum<=0||_10c.tried<_10c.trynum)){setTimeout(function(){try{_10b.open("POST",url,true);_10b.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded");_10b.send(str);}catch(e){alert("http send error:"+e);_10c.error=true;}},_10c.interval);}}}};try{_10b.open("POST",url,true);_10b.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded");_10b.send(str);}catch(e){alert("http send error:"+e);_10c.error=true;}return _10c;},getXmlHttpObject:function(){var _10d=null;try{_10d=new XMLHttpRequest();}catch(e){try{_10d=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){_10d=new ActiveXObject("Microsoft.XMLHTTP");}}return _10d;},checkActiveX:function(_10e){var _10f;try{if(_10e!=null&&_10e!=""){_10f=new ActiveXObject(_10e);}else{_10f=null;}}catch(e){_10f=null;}var resp=(_10f!=null);if(_10f!=null){delete _10f;_10f=null;}return resp;},getAbsoluteURL:function(_110){var idx=_110.indexOf("://");if(idx>=0){return _110;}idx=_110.indexOf("/");if(idx==0){var _111=location.protocol;var host=location.host;return _111+"//"+host+_110;}else{var _112=location.href;idx=_112.lastIndexOf("/");if(idx<0){return _112+"/"+_110;}else{return _112.substring(0,idx+1)+_110;}}},dummyFunction:function(){}};})();}if(typeof InkTool.Base==="undefined"){InkTool.Base=function(){};InkTool.Base.superclass=null;InkTool.Base.subclasses=[];InkTool.Base.prototype={initialize:function(){},clone:function(){var dest=new Object();for(var _113 in this){dest[_113]=this.doClone(this[_113]);}return dest;},doClone:function(prop){if(prop instanceof InkTool.Base){return prop.clone();}else{if(prop instanceof Array){var _114=new Array();var _115=prop.length;for(var _116=0;_116<_115;_116++){_114.push(this.doClone(prop[_116]));}return _114;}else{if(typeof prop=="object"){var obj=new Object();for(var key in prop){obj[key]=this.doClone(prop[key]);}return obj;}else{return prop;}}}},extend:function(_117){for(var _118 in _117){this.prototype[_118]=_117[_118];}}};}if(typeof InkTool.InkColor==="undefined"){InkTool.InkColor=InkTool.InkLib.Class.create(null,{initialize:function(_1){this.setColor(_1);},clearColor:function(_2){this.ok=_2;this.R=0;this.G=0;this.B=0;this.A=0;},setColor:function(_3){if(_3===null){this.clearColor(false);}else{if(typeof _3=="string"){this.setString(_3);}else{if(typeof _3=="number"){this.setNumber(_3);}else{this.copyColor(_3);}}}},setString:function(_4){this.clearColor(false);_4=_4.replace(/ /g,"");_4=_4.toLowerCase();var _5={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};var _6=_5[_4];if(_6!=undefined){_4="#"+_6;}var _7=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*([0-9\.]*)\)$/,example:["rgba(123, 234, 45, 1.0)","rgba(255,234,245, 0.5)"],process:function(_8){return [parseInt(_8[1]),parseInt(_8[2]),parseInt(_8[3]),Math.floor(parseFloat(_8[4])*255+0.5)];}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(_9){return [parseInt(_9[1]),parseInt(_9[2]),parseInt(_9[3]),255];}},{re:/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#ff00ff00","80336699"],process:function(_a){return [parseInt(_a[2],16),parseInt(_a[3],16),parseInt(_a[4],16),parseInt(_a[1],16)];}},{re:/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(_b){return [parseInt(_b[1],16),parseInt(_b[2],16),parseInt(_b[3],16),255];}},{re:/^#(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(_c){return [parseInt(_c[1]+_c[1],16),parseInt(_c[2]+_c[2],16),parseInt(_c[3]+_c[3],16),255];}}];for(var i=0;i<_7.length;i++){var re=_7[i].re;var _d=_7[i].process;var _e=re.exec(_4);if(_e){channels=_d(_e);this.R=channels[0];this.G=channels[1];this.B=channels[2];this.A=channels[3];this.ok=true;break;}}if(this.ok==true){function _f(val){return (isNaN(val)==false&&val>=0&&val<=255);};if(_f(this.R)==false||_f(this.G)==false||_f(this.B)==false||_f(this.A)==false){this.clearColor(false);}}},setNumber:function(_10){this.A=(_10>>>24);this.R=((_10&16711680)>>16);this.G=((_10&65280)>>8);this.B=(_10&255);this.ok=true;},copyColor:function(_11){this.A=_11.A;this.R=_11.R;this.G=_11.G;this.B=_11.B;this.ok=_11.ok;},getRGB:function(){return "rgb("+this.R+","+this.G+","+this.B+")";},getRGBA:function(){return "rgba("+this.R+","+this.G+","+this.B+","+(this.A/255).toFixed(3)+")";},getHex:function(){var r=this.R.toString(16);var g=this.G.toString(16);var b=this.B.toString(16);if(r.length==1){r="0"+r;}if(g.length==1){g="0"+g;}if(b.length==1){b="0"+b;}return "#"+r+g+b;},getNumber:function(){return (((this.A<<24)+(this.R<<16)+(this.G<<8)+this.B)>>>0);},});}if(typeof InkTool.InkPenType==="undefined"){InkTool.InkPenType={Old_None:4,Old_BallpointPen:0,Old_FeltPen:1,Old_BrushPen:1,Old_StrokeEraser:2,Old_NormalEraser:3,Old_MarkerPen:5,Old_FudePen:6,Old_AirbrushPen:7,Old_VariableBallpointPen:8,Old_VariableFudePen:9,Old_Pencil:10,Old_PencilEmulated:11,Old_VariableSignPen:12,Old_FeltPenV100:501,Old_KesSound:1001,Old_KesText:1002,None:100,PressSenseBallpointPen:101,PressSenseFeltPen:102,PressSenseMarkerPen:103,PressSenseFudePen:104,PressSenseAirbrushPen:105,PressSenseSignPen:106,PressSenseSchoolPen:107,SolidPen:150,SpeedSenseBallpointPen:151,SpeedSenseFeltPen:152,SepedSenseMarkerPen:153,SpeedSenseFudePen:154,SpeedSsenseAirbrushPen:155,SpeedSenseSignPen:156,SpeedSenseSchoolPen:157,StrokeEraser:201,PressSenseNormalEraser:202,SolidEraser:203,Pencil:10,PencilEmulated:11,FeltPenV100:21,KesSound:51,KesText:52,AutoSwitchBallpointPen:301,AutoSwitchFeltPen:302,AutoSwitchMarkerPen:303,AutoSwitchFudePen:304,AutoSwitchAirbrushPen:305,AutoSwitchSignPen:306,AutoSwitchSchoolPen:307,AutoSwitchEraser:401,Max:9999};}if(typeof InkTool.InkStationery==="undefined"){InkTool.InkStationery=InkTool.InkLib.Class.create(null,{initialize:function(){this.tp=InkTool.InkPenType.None;this.col=new InkTool.InkColor("black");this.w=1;this.minw=1;this.maxw=1;this.oldType=-1;this.activeXPen=null;this.html5Pen=null;},getInfo:function(){return "type="+this.tp+":color="+this.col.getRGBA()+":width="+this.w+"("+this.minw+"-"+this.maxw+")";},getPenType:function(){return this.tp;},setPenColor:function(_1){this.col=_1;},getPenColor:function(){return this.col;},setPenWidth:function(_2){this.w=_2;},getPenWidth:function(){return this.w;},setPenMinWidth:function(_3){this.minw=_3;},getPenMinWidth:function(){return this.minw;},setPenMaxWidth:function(_4){this.maxw=_4;},getPenMaxWidth:function(){return this.maxw;},drawStart:function(_5){},strokeDispatch:function(_6,_7,_8){if(_8==0){var _9=_7.m;var xp=_7.x;var yp=_7.y;var wd=_7.w;var tm=_7.t;if(_9==0){this.strokeStart(_6,xp,yp,wd,tm);}else{if(_9==1){this.strokeMove(_6,xp,yp,wd,tm);}else{if(_9==3){this.strokePause(_6,xp,yp,wd,tm);}else{if(_9==4){this.strokeMoveFeature(_6,xp,yp,wd,tm);}else{if(_9==5){this.strokeMoveBend(_6,xp,yp,wd,tm);}else{if(_9==6){this.strokeMoveToEnd(_6,xp,yp,wd,tm);}else{if(_9==2){this.strokeEnd(_6,xp,yp,wd,tm);}}}}}}}return;}var _9=_7.m;if(_9==0){_6.queueCells=[];_6.queueCells.push(_7);if(_8==1){var xp=_7.x;var yp=_7.y;var wd=_7.w;var tm=_7.t;this.strokeStart(_6,xp,yp,wd,tm);}_6.featureLast=_7;_6.featureLLast=null;_6.agingDist=2*2;var _a=_6.ftdtStraightDist2;if(_6.agingDist>_a){_6.agingDist=_a;}}else{var _b=_6.ftdtBendDist;if(_b==0){if(_8==1){var md=_7.m;var xp=_7.x;var yp=_7.y;var wd=_7.w;var tm=_7.t;if(md==1){this.strokeMove(_6,xp,yp,wd,tm);}else{if(md==3){this.strokePause(_6,xp,yp,wd,tm);}else{if(md==4){this.strokeMoveFeature(_6,xp,yp,wd,tm);}else{if(md==5){this.strokeMoveBendLater(_6,xp,yp,wd,tm);}else{if(md==6){this.strokeMoveToEnd(_6,xp,yp,wd,tm);}else{if(md==2){this.strokeEnd(_6,xp,yp,wd,tm);}}}}}}}}else{_6.queueCells.push(_7);var _c=this.findFeaturePoints(_6,_9);var _a=_6.ftdtStraightDist2;for(var _d=0;_d<_c.length;_d++){if(_8==1){var _e=_c[_d];var md=_e.m;var xp=_e.x;var yp=_e.y;var wd=_e.w;var tm=_e.t;if(md==1){this.strokeMove(_6,xp,yp,wd,tm);}else{if(md==3){this.strokePause(_6,xp,yp,wd,tm);}else{if(md==4){this.strokeMoveFeature(_6,xp,yp,wd,tm);}else{if(md==5){this.strokeMoveBendLater(_6,xp,yp,wd,tm);}else{if(md==6){this.strokeMoveToEnd(_6,xp,yp,wd,tm);}else{if(md==2){this.strokeEnd(_6,xp,yp,wd,tm);}}}}}}}if(_6.agingDist<_a){_6.agingDist*=4;if(_6.agingDist>_a){_6.agingDist=_a;}}}}}},findFeaturePoints:function(_f,_10){var _11=[];var _12=_f.ftdtBendDist2;var _13=_f.agingDist;var _14=_f.ftdtTimeDist;var _15=_f.ftdtSharpDist2;var _16=_f.queueCells.length-1;var pt1=_f.queueCells[0];var pt3=_f.queueCells[_16];var _17=-1;var _18=0;var _19=1;for(var idx=1;idx<_16;idx++){var pt2=_f.queueCells[idx];var _1a=this.getLineSegmentAndPointDistance2(pt1.x,pt1.y,pt3.x,pt3.y,pt2.x,pt2.y);if(_1a>_18){_17=idx;_18=_1a;_19=(_10==2)?6:4;}}if(_17<0||_18<_12){_17=-1;if(_10==1){var _1b=this.getEuclideanDistance2(pt1.x,pt1.y,pt3.x,pt3.y);var _1c=pt3.t-pt1.t;if(_1b>=_13){_17=_16;_19=(_10==2)?6:4;}else{if(_1c>=_14){_17=_16;_19=3;}}}}var _1d=1;if(_17>=0){for(var idx=1;idx<_17;idx++){var pt=_f.queueCells[idx];if(pt.m==1){pt.m=-1;}}var _1e=_f.queueCells[_17];if(_15>0&&_f.featureLLast!=null&&_f.featureLast!=null&&(_f.featureLast.m==4||_f.featureLast.m==3)){var _1f=_f.featureLLast;var _20=_f.featureLast;var _21=this.detectBendPoint(_1f,_20,_1e,_15,_1d);if(_21){_20.m=5;_11.push(_20);}}_1e.m=_19;_11.push(_1e);_f.featureLLast=_f.featureLast;_f.featureLast=_1e;}if(_10!=1){var _22=1;if(_17>=0){_22=_17+1;}for(var idx=_22;idx<_16;idx++){var pt=_f.queueCells[idx];if(pt.m==1){pt.m=-1;}}_17=_16;var _1e=_f.queueCells[_17];if(_15>0&&_f.featureLLast!=null&&_f.featureLast!=null&&(_f.featureLast.m==4||_f.featureLast.m==3)){var _1f=_f.featureLLast;var _20=_f.featureLast;var _21=this.detectBendPoint(_1f,_20,_1e,_15,_1d);if(_21){_20.m=5;_11.push(_20);}}_11.push(_1e);_f.featureLLast=_f.featureLast;_f.featureLast=_1e;}if(_17>=0){for(var idx=0;idx<_17;idx++){_f.queueCells.shift();}}return _11;},detectBendPoint:function(pt1,pt2,pt3,_23,_24){var _25=this.getAngleOfLineSegments(pt1.x,pt1.y,pt2.x,pt2.y,pt2.x,pt2.y,pt3.x,pt3.y);if(_25<Math.PI/3){return false;}var x1=(pt1.x+pt2.x)/2;var y1=(pt1.y+pt2.y)/2;var x2=pt2.x;var y2=pt2.y;var x3=(pt2.x+pt3.x)/2;var y3=(pt2.y+pt3.y)/2;var xd1=x1-x2;var yd1=y1-y2;var xd2=x3-x2;var yd2=y3-y2;var _26=xd1*xd1+yd1*yd1;var _27=xd2*xd1+yd2*yd1;var _28=xd2*xd2+yd2*yd2;var _29=Math.sqrt(_28/_26);var _2a=1/(Math.sqrt(_29)+1);var _2b=_24;for(var ct=0;ct<_24;ct++){var _2c=4*(_26+2*_27+_28)*_2a*_2a*_2a-12*(_26+_27)*_2a*_2a+4*(3*_26+_27)*_2a-4*_26;var _2d=12*(_26+2*_27+_28)*_2a*_2a-24*(_26+_27)*_2a+4*(3*_26+_27);if(_2d==0){break;}else{if(_2d<0){_2a+=0.1;if(_2b>0){_2b--;ct--;}}else{_2a=_2a-_2c/_2d;}}}var xp=x1*(1-_2a)*(1-_2a)+x2*2*_2a*(1-_2a)+x3*_2a*_2a;var yp=y1*(1-_2a)*(1-_2a)+y2*2*_2a*(1-_2a)+y3*_2a*_2a;var xd=xp-x2;var yd=yp-y2;var _2e=(xd*xd+yd*yd);return (_2e>=_23);},strokeStart:function(_2f,xp,yp,wd,tm){},strokeMove:function(_30,xp,yp,wd,tm){},strokePause:function(_31,xp,yp,wd,tm){this.strokeMove(_31,xp,yp,wd,tm);},strokeMoveFeature:function(_32,xp,yp,wd,tm){this.strokeMove(_32,xp,yp,wd,tm);},strokeMoveBend:function(_33,xp,yp,wd,tm){this.strokeMove(_33,xp,yp,wd,tm);this.strokeMove(_33,xp+0.1,yp+0.1,wd,tm);},strokeMoveBendLater:function(_34,xp,yp,wd,tm){this.strokeMove(_34,xp+0.1,yp+0.1,wd,tm);},strokeMoveToEnd:function(_35,xp,yp,wd,tm){this.strokeMove(_35,xp,yp,wd,tm);},strokeEnd:function(_36,xp,yp,wd,tm){},drawEnd:function(_37){},fullDrawStart:function(_38){},fullStrokeDispatch:function(_39,_3a){var _3b=_3a.getMode();var xp=_3a.getX();var yp=_3a.getY();var wd=_3a.getWidth();var tm=_3a.getTime();if(_3b==0){this.fullStrokeStart(_39,xp,yp,wd,tm);}else{if(_3b==1){this.fullStrokeMove(_39,xp,yp,wd,tm);}else{if(_3b==3){this.fullStrokePause(_39,xp,yp,wd,tm);}else{if(_3b==4){this.fullStrokeMoveFeature(_39,xp,yp,wd,tm);}else{if(_3b==5){this.fullStrokeMoveBend(_39,xp,yp,wd,tm);}else{if(_3b==6){this.fullStrokeMoveToEnd(_39,xp,yp,wd,tm);}else{if(_3b==2){this.fullStrokeEnd(_39,xp,yp,wd,tm);}}}}}}}},fullStrokeStart:function(_3c,xp,yp,wd,tm){},fullStrokeMove:function(_3d,xp,yp,wd,tm){},fullStrokePause:function(_3e,xp,yp,wd,tm){this.fullStrokeMove(_3e,xp,yp,wd,tm);},fullStrokeMoveFeature:function(_3f,xp,yp,wd,tm){this.fullStrokeMove(_3f,xp,yp,wd,tm);},fullStrokeMoveBend:function(_40,xp,yp,wd,tm){this.fullStrokeMove(_40,xp,yp,wd,tm);this.fullStrokeMove(_40,xp+0.1,yp+0.1,wd,tm);},fullStrokeMoveToEnd:function(_41,xp,yp,wd,tm){this.fullStrokeMove(_41,xp,yp,wd,tm);},fullStrokeEnd:function(_42,xp,yp,wd,tm){},fullDrawEnd:function(_43){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getOldPenType:function(){return this.oldType;},getActiveXPen:function(){return this.activeXPen;},getHtml5Pen:function(){return this.html5Pen;},getSubInfo:function(){return "";},getEuclideanDistance:function(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return Math.sqrt(dx*dx+dy*dy);},getEuclideanDistance2:function(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return (dx*dx+dy*dy);},getLineSegmentAndPointDistance:function(x1,y1,x2,y2,xp,yp){var dx=x2-x1;var dy=y2-y1;var _44=dx*dx+dy*dy;var _45=dx*(x1-xp)+dy*(y1-yp);if(_44==0){return this.getEuclideanDistance(x1,y1,xp,yp);}else{var _46=-_45/_44;if(_46<=0){return this.getEuclideanDistance(x1,y1,xp,yp);}else{if(_46>=1){return this.getEuclideanDistance(x2,y2,xp,yp);}else{var tx=x1+dx*_46;var ty=y1+dy*_46;return this.getEuclideanDistance(tx,ty,xp,yp);}}}},getLineSegmentAndPointDistance2:function(x1,y1,x2,y2,xp,yp){var dx=x2-x1;var dy=y2-y1;var _47=dx*dx+dy*dy;var _48=dx*(x1-xp)+dy*(y1-yp);var xd,yd;if(_47==0){xd=xp-x1;yd=yp-y1;}else{var _49=-_48/_47;if(_49<=0){xd=xp-x1;yd=yp-y1;}else{if(_49>=1){xd=xp-x2;yd=yp-y2;}else{var tx=x1+dx*_49;var ty=y1+dy*_49;xd=xp-tx;yd=yp-ty;}}}return (xd*xd+yd*yd);},calcAngleOfVector:function(xp,yp){var _4a=xp*xp+yp*yp;if(_4a==0){return -100;}var _4b=Math.acos(xp/Math.sqrt(_4a));if(yp<0){_4b=2*Math.PI-_4b;}return _4b;},getAngleOfLineSegments:function(x1s,y1s,x1f,y1f,x2s,y2s,x2f,y2f){var _4c=this.calcAngleOfVector(x1f-x1s,y1f-y1s);var _4d=this.calcAngleOfVector(x2f-x2s,y2f-y2s);if(_4c==-100||_4d==-100){return 0;}var _4e=Math.abs(_4c-_4d);if(_4e>Math.PI){_4e=2*Math.PI-_4e;}return _4e;},getDLenByAlpha:function(_4f){var _50;_50=Math.pow(_4f,1.6)/27500;return _50;},dummy:function(){}});}if(typeof InkTool.DrawingContext==="undefined"){InkTool.DrawingContext=InkTool.InkLib.Class.create(null,{initialize:function(_51,_52,_53,_54){this.context=_51;this.offsetX=_52;this.offsetY=_53;this.zoomRatio=_54;this.eraserBgColor=null;this.ftdtBendDist=0.75;this.ftdtStraightDist=32;this.ftdtTimeDist=25;this.ftdtSharpDist=1.05;this.ftdtBendDist2=this.ftdtBendDist*this.ftdtBendDist;this.ftdtStraightDist2=this.ftdtStraightDist*this.ftdtStraightDist;this.ftdtSharpDist2=this.ftdtSharpDist*this.ftdtSharpDist;this.clipRect=null;this.canvasWidth=0;this.canvasHeight=0;this.queuePoints=new Array();},setContext:function(_55){this.context=_55;},getContext:function(){return this.context;},setOffset:function(_56,_57){this.offsetX=_56;this.offsetY=_57;},getOffsetX:function(){return this.offsetX;},getOffsetY:function(){return this.offsetY;},setZoomRatio:function(_58){this.zoomRatio=_58;},getZoomRatio:function(){return this.zoomRatio;},xpDataToDraw:function(xp){return ((xp-this.offsetX)*this.zoomRatio);},ypDataToDraw:function(yp){return ((yp-this.offsetY)*this.zoomRatio);},widthDataToDraw:function(_59){return (_59*this.zoomRatio);},heightDataToDraw:function(_5a){return (_5a*this.zoomRatio);},xpDrawToData:function(xp){return ((xp/this.zoomRatio)+this.offsetX);},ypDrawToData:function(yp){return ((yp/this.zoomRatio)+this.offsetY);},widthDrawToData:function(_5b){return (_5b/this.zoomRatio);},heightDrawToData:function(_5c){return (_5c/this.zoomRatio);},setEraserBgColor:function(_5d){this.eraserBgColor=_5d;},getEraserBgColor:function(){return this.eraserBgColor;},setFeatureDetectingParams:function(_5e,_5f,_60,_61){this.ftdtBendDist=_5e;this.ftdtStraightDist=_5f;this.ftdtTimeDist=_60;this.ftdtSharpDist=_61;this.ftdtBendDist2=this.ftdtBendDist*this.ftdtBendDist;this.ftdtStraightDist2=this.ftdtStraightDist*this.ftdtStraightDist;this.ftdtSharpDist2=this.ftdtSharpDist*this.ftdtSharpDist;},getFeatureDetectingBendDist:function(){return this.ftdtBendDist;},getFeatureDetectingStraightDist:function(){return this.ftdtStraightDist;},getFeatureDetectingTimeDist:function(){return this.ftdtTimeDist;},getFeatureDetectingSharpDist:function(){return this.ftdtSharpDist;},calcClipRect:function(_62,_63){var _64=this.offsetX;var top=this.offsetY;var _65=Math.round(_62/this.zoomRatio);var _66=Math.round(_63/this.zoomRatio);this.clipRect={"left":_64,"top":top,"width":_65,"height":_66};this.canvasWidth=_62;this.canvasHeight=_63;},setClipRect:function(_67){this.clipRect=_67;},getClipRect:function(){return this.clipRect;},setCanvasSize:function(_68,_69){this.canvasWidth=_68;this.canvasHeight=_69;},getCanvasWidth:function(){return this.canvasWidth;},getCanvasHeight:function(){return this.canvasHeight;},isCircleInRect:function(cx,cy,_6a){return (this.canvasWidth==0||this.canvasHeight==0||(cx+_6a>=0&&cx-_6a<=this.canvasWidth&&cy+_6a>=0&&cy-_6a<=this.canvasHeight));},clone:function(){var _6b=new InkTool.DrawingContext(this.context,this.offsetX,this.offsetY,this.zoomRatio);_6b.setFeatureDetectingParams(this.ftdtBendDist,this.ftdtStraightDist,this.ftdtTimeDist,this.ftdtSharpDist);_6b.setClipRect(this.clipRect);_6b.setCanvasSize(this.canvasWidth,this.canvasHeight);return _6b;},cloneWithContext:function(ctx){var _6c=new InkTool.DrawingContext(ctx,this.offsetX,this.offsetY,this.zoomRatio);_6c.setFeatureDetectingParams(this.ftdtBendDist,this.ftdtStraightDist,this.ftdtTimeDist,this.ftdtSharpDist);_6c.setClipRect(this.clipRect);_6c.setCanvasSize(this.canvasWidth,this.canvasHeight);return _6c;},dummy:function(){}});}if(typeof InkTool.InkBallpointPen==="undefined"){InkTool.InkBallpointPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.SolidPen;this.col=new InkTool.InkColor("darkred");this.w=2;this.minw=1;this.maxw=5;this.oldType=InkTool.InkPenType.SolidPen;},drawStart:function(_6d){var ctx=_6d.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_6d.widthDataToDraw(this.getPenWidth());var _6e=this.getPenColor().A;if(_6e==0||_6e==255){ctx.lineCap="round";}else{ctx.lineCap="butt";}ctx.lineJoin="round";},strokeStart:function(_6f,xp,yp,wd,tm){var ctx=_6f.context;var _70=_6f.xpDataToDraw(xp);var _71=_6f.ypDataToDraw(yp);_6f.lastData=[];_6f.llastX=_6f.lastX=_70;_6f.llastY=_6f.lastY=_71;_6f.moveCount=0;var _72=this.getPenColor().A;_6f.dlen=this.getDLenByAlpha(_72);},strokeMove:function(_73,xp,yp,wd,tm){return this.strokeMoveSub(_73,xp,yp,wd,tm);},strokeMoveSub:function(_74,xp,yp,wd,tm){var ctx=_74.context;var _75=_74.xpDataToDraw(xp);var _76=_74.ypDataToDraw(yp);if(_75==_74.lastX&&_76==_74.lastY){return;}var x1=(_74.lastX+_74.llastX)/2;var y1=(_74.lastY+_74.llastY)/2;var x2=_74.lastX;var y2=_74.lastY;var x3=(_74.lastX+_75)/2;var y3=(_74.lastY+_76)/2;var _77=this.getPenColor().A;if(0<_77&&_77<255){var _78=_74.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);var x3m=x3;var y3m=y3;if(dd3>0){var px3=dx3*_78/dd3;var py3=dy3*_78/dd3;x3m+=px3;y3m+=py3;}if(_74.moveCount>0){var x1m=x1;var y1m=y1;if(dd1>0){var px1=dx1*_78/dd1;var py1=dy1*_78/dd1;x1m+=px1;y1m+=py1;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.quadraticCurveTo(x2,y2,x3m,y3m);ctx.stroke();}else{var xc=x2;var yc=y2;var x2m=x2;var y2m=y2;if(dd3>0){var px2=dx3*_78/dd3;var py2=dy3*_78/dd3;xc+=px2;yc+=py2;x2m-=px2;y2m-=py2;}var _79=_74.widthDataToDraw(this.getPenWidth())/2;var _7a;if(dx3==0){if(dy3>0){_7a=Math.PI/2;}else{if(dy3==0){_7a=-100;}else{_7a=Math.PI*3/2;}}}else{_7a=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_7a=Math.PI*2-_7a;}}else{if(dy3>=0){_7a=Math.PI-_7a;}else{_7a=Math.PI+_7a;}}}var _7b,_7c;if(_7a==-100){_7b=0;_7c=Math.PI*2;}else{_7b=_7a+Math.PI/2;if(_7b>Math.PI*2){_7b-=Math.PI*2;}_7c=_7a-Math.PI/2;if(_7c<0){_7c+=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_79,_7b,_7c,false);ctx.fill();ctx.beginPath();ctx.moveTo(x2m,y2m);ctx.lineTo(x3m,y3m);ctx.stroke();}}else{ctx.beginPath();ctx.moveTo(x1,y1);ctx.quadraticCurveTo(x2,y2,x3,y3);ctx.stroke();}_74.llastX=_74.lastX;_74.llastY=_74.lastY;_74.lastX=_75;_74.lastY=_76;_74.moveCount++;},strokeEnd:function(_7d,xp,yp,wd,tm){var ctx=_7d.context;var _7e=_7d.xpDataToDraw(xp);var _7f=_7d.ypDataToDraw(yp);var x1=(_7d.lastX+_7d.llastX)/2;var y1=(_7d.lastY+_7d.llastY)/2;var x2=_7d.lastX;var y2=_7d.lastY;var x3=_7e;var y3=_7f;var _80=this.getPenColor().A;if(_7d.moveCount==0){var _81=_7d.widthDataToDraw(this.getPenWidth())/2;var _82,_83;_82=0;_83=Math.PI*2;ctx.beginPath();ctx.arc(x3,y3,_81,_82,_83,false);ctx.fill();}else{if(0<_80&&_80<255){var _84=_7d.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var x1m=x1;var y1m=y1;if(dd1>0){var px1=dx1*_84/dd1;var py1=dy1*_84/dd1;x1m+=px1;y1m+=py1;}var dx2=(x2-x1);var dy2=(y2-y1);var dd2=Math.sqrt(dx2*dx2+dy2*dy2);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);var xc=x3;var yc=y3;if(x2==x3&&y2==y3){dx3=dx2;dy3=dy2;dd3=dd2;var x3m=x3;var y3m=y3;if(dd2>0){var px3=dx3*_84/dd3;var py3=dy3*_84/dd3;x3m+=px3;y3m+=py3;xc-=px3;yc-=py3;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.lineTo(x3m,y3m);ctx.stroke();}else{var x3m=x3;var y3m=y3;if(dd3>0){var px3=dx3*_84/dd3;var py3=dy3*_84/dd3;x3m+=px3;y3m+=py3;xc-=px3;yc-=py3;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.quadraticCurveTo(x2,y2,x3m,y3m);ctx.stroke();}var _81=_7d.widthDataToDraw(this.getPenWidth())/2;var _85;if(dx3==0){if(dy3>0){_85=Math.PI/2;}else{if(dy3==0){_85=-100;}else{_85=Math.PI*3/2;}}}else{_85=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_85=Math.PI*2-_85;}}else{if(dy3>=0){_85=Math.PI-_85;}else{_85=Math.PI+_85;}}}var _82,_83;if(_85==-100){_82=0;_83=Math.PI*2;}else{_82=_85-Math.PI/2;if(_82<0){_82+=Math.PI*2;}_83=_85+Math.PI/2;if(_83>Math.PI*2){_83-=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_81,_82,_83,false);ctx.fill();}else{ctx.beginPath();ctx.moveTo(x1,y1);if(x2==x3&&y2==y3){ctx.lineTo(x3,y3);}else{ctx.quadraticCurveTo(x2,y2,x3,y3);}ctx.stroke();}}_7d.llastX=_7d.lastX;_7d.llastY=_7d.lastY;_7d.lastX=_7e;_7d.lastY=_7f;},drawEnd:function(_86){},fullDrawStart:function(_87){var ctx=_87.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_87.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";},fullStrokeStart:function(_88,xp,yp,wd,tm){var ctx=_88.context;var _89=_88.xpDataToDraw(xp);var _8a=_88.ypDataToDraw(yp);ctx.beginPath();ctx.moveTo(_89,_8a);_88.llastX=_88.lastX=_89;_88.llastY=_88.lastY=_8a;_88.lastData=[];_88.moveCount=0;},fullStrokeMove:function(_8b,xp,yp,wd,tm){this.fullStrokeMoveSub(_8b,xp,yp,wd,tm);},fullStrokeMoveSub:function(_8c,xp,yp,wd,tm){var ctx=_8c.context;var _8d=_8c.xpDataToDraw(xp);var _8e=_8c.ypDataToDraw(yp);if(_8d==_8c.lastX&&_8e==_8c.lastY){return;}var x2=_8c.lastX;var y2=_8c.lastY;var x3=(_8c.lastX+_8d)/2;var y3=(_8c.lastY+_8e)/2;ctx.quadraticCurveTo(x2,y2,x3,y3);_8c.llastX=_8c.lastX;_8c.llastY=_8c.lastY;_8c.lastX=_8d;_8c.lastY=_8e;_8c.moveCount++;},fullStrokePause:function(_8f,xp,yp,wd,tm){this.fullStrokeMoveSub(_8f,xp,yp,wd,tm);},fullStrokeMoveFeature:function(_90,xp,yp,wd,tm){this.fullStrokeMoveSub(_90,xp,yp,wd,tm);},fullStrokeMoveBend:function(_91,xp,yp,wd,tm){this.fullStrokeMoveSub(_91,xp,yp,wd,tm);this.fullStrokeMoveSub(_91,xp+0.1,yp+0.1,wd,tm);},fullStrokeMoveToEnd:function(_92,xp,yp,wd,tm){this.fullStrokeMoveSub(_92,xp,yp,wd,tm);},fullStrokeEnd:function(_93,xp,yp,wd,tm){var ctx=_93.context;var _94=_93.xpDataToDraw(xp);var _95=_93.ypDataToDraw(yp);var x2=_93.lastX;var y2=_93.lastY;var x3=_94;var y3=_95;if(_93.moveCount==0){var _96=_93.widthDataToDraw(this.getPenWidth())/2;var _97,_98;_97=0;_98=Math.PI*2;ctx.arc(x3,y3,_96,_97,_98,false);ctx.fill();}else{if(x2==x3&&y2==y3){ctx.lineTo(x3,y3);}else{ctx.quadraticCurveTo(x2,y2,x3,y3);}ctx.stroke();}_93.llastX=_93.lastX;_93.llastY=_93.lastY;_93.lastX=_94;_93.lastY=_95;},fullDrawEnd:function(_99){},hasFullDrawMode:function(){return true;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "BallpointPen";}});}if(typeof InkTool.SolidPen==="undefined"){InkTool.SolidPen=InkTool.InkLib.Class.create(InkTool.InkBallpointPen,{initialize:function(){this.tp=InkTool.InkPenType.SolidPen;this.col=new InkTool.InkColor("black");this.w=2;this.minw=1;this.maxw=5;this.oldType=InkTool.InkPenType.SolidPen;},hasFullDrawMode:function(){return true;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "SolidPen";}});}if(typeof InkTool.InkFeltPen==="undefined"){InkTool.InkFeltPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseFeltPen;this.col=new InkTool.InkColor("purple");this.w=5;this.minw=3;this.maxw=8;this.oldType=InkTool.InkPenType.Old_FeltPen;this.transparency=true;this.smoothing=true;this.startSharpness=5;this.feltmode=true;this.coExpornent=-1;this.accelRatio=0.4;this.decelRatio=0.2;this.vxRatio=1;this.axRatio=0.2;this.angleThres=Math.PI/4;this.angleTrig=Math.PI/3;this.minValAccel=-0.1;this.zoopRatio=1.4;this.loopDivValue=2;this.vBeta=1.6;this.aExp=-0.32;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=2;this.alphaSmooth=0;this.endingValBonus=0.15;this.endingValRatio=1.4;this.dotValRatio=0.5;this.endingRaveBonus=0.5;},setTransparency:function(_9a){this.transparency=_9a;},setSmoothing:function(_9b){this.smoothing=_9b;},drawStart:function(_9c){var ctx=_9c.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_9c.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";_9c.drawMinPenWidth=_9c.widthDataToDraw(this.getPenMinWidth());_9c.drawMaxPenWidth=_9c.widthDataToDraw(this.getPenMaxWidth());_9c.drawScalePenWidth=_9c.drawMaxPenWidth-_9c.drawMinPenWidth;},strokeStart:function(_9d,xp,yp,wd,tm){var ctx=_9d.context;var _9e=_9d.xpDataToDraw(xp);var _9f=_9d.ypDataToDraw(yp);_9d.lastDrawX=_9e;_9d.lastDrawY=_9f;_9d.lastTime=tm;_9d.firstDraw=true;_9d.moveCount=0;_9d.moveSum=0;_9d.lastData=[];_9d.lastVal=0;_9d.lastAcs=0;_9d.lastAcsSum=0;_9d.lastRadius=-1;_9d.lastAlpha=-1;_9d.lastGamma=-1;_9d.startX=xp;_9d.startY=yp;_9d.endingBonus=0;var _a0,_a1;_a0={"val":-1,"acs":0,"ang":0,"x":_9e,"y":_9f,"tm":8,"stt":0,"dst":0,"bend":false,"abnd":false,"rbnd":0,"ruvl":0,"ufac":0,"xfvl":0};_a1={"val":-1,"acs":0,"ang":0,"x":_9e,"y":_9f,"tm":8,"stt":0,"dst":0,"bend":false,"abnd":false,"rbnd":0,"ruvl":0,"ufac":0,"xfvl":0};_9d.lastData.push(_a0);_9d.lastData.push(_a1);_9d.timeStr="";},strokeMove:function(_a2,xp,yp,wd,tm){this.strokeMoveStat(_a2,xp,yp,wd,tm,1);},strokeMoveStat:function(_a3,xp,yp,wd,tm,_a4){_a3.timeStr="";if(tm<=_a3.lastTime){_a3.queuePoints.push({"x":xp,"y":yp,"m":_a4});_a3.lastTime=tm;return;}var _a5=tm-_a3.lastTime;var _a6=_a5/(_a3.queuePoints.length+1);if(_a6<6){_a6=6;}var _a7=_a6;var _a8,_a9;while(_a3.queuePoints.length>0){var _aa=_a3.queuePoints.shift();_a8=_a3.xpDataToDraw(_aa.x);_a9=_a3.ypDataToDraw(_aa.y);var dx=(_a8-_a3.lastDrawX);var dy=(_a9-_a3.lastDrawY);if(dx==0&&dy==0){_a6+=_a7;continue;}var _ab=_aa.m;this.strokeMoveSub(_a3,_a8,_a9,_a6,_ab,false,false,false);_a3.lastDrawX=_a8;_a3.lastDrawY=_a9;_a6=_a7;}_a8=_a3.xpDataToDraw(xp);_a9=_a3.ypDataToDraw(yp);var dx=(_a8-_a3.lastDrawX);var dy=(_a9-_a3.lastDrawY);if(dx==0&&dy==0){return;}this.strokeMoveSub(_a3,_a8,_a9,_a6,_a4,false,false,false);_a3.lastTime=tm;_a3.lastDrawX=_a8;_a3.lastDrawY=_a9;},strokeMoveSub:function(_ac,xp,yp,_ad,_ae,_af,_b0,_b1){var ctx=_ac.context;var _b2=xp;var _b3=yp;var _b4=_ac.drawMinPenWidth*0.5;var _b5=_ac.drawScalePenWidth*0.5;var _b6=_ac.moveSum;var _b7=_ac.moveCount;_ac.moveCount++;var _b8=_ac.lastData[_ac.lastData.length-1];var _b9=_ac.lastData[_ac.lastData.length-2];var t1=_b8.tm;var t2=_ad;var px1=_b9.x;var py1=_b9.y;var px2=_b8.x;var py2=_b8.y;var px3=_b2;var py3=_b3;var _ba=_b8.stt;var d1=_b8.dst;var vc1=_b8.val;if(vc1<0){vc1=0;}var pxd=(px3-px2);var pyd=(py3-py2);var d2=Math.sqrt(pxd*pxd+pyd*pyd)/_ac.zoomRatio;var vc3=d2/t2;if(_ac.moveCount==1){if(vc3>0.5){vc3=0.5;t2=d2/vc3;}}else{if(vc3>vc1+0.25){vc3=vc1+0.25;t2=d2/vc3;}else{if(vc3<vc1-0.25){vc3=vc1-0.25;t2=d2/vc3;}}}var ac0=_b8.acs;var ac2=(vc3-vc1)/t2;var ag0=_b8.ang;var ag2=this.getAngleOfLineSegment(px2,py2,px3,py3);if(ag2==null){ag2=ag0;}var _bb=this.valSmooth;var _bc=this.acsSmooth;var _bd=this.radiusSmooth;var _be=this.alphaSmooth;if(_af){_bd=0;}var _bf=(_bb>_bc)?_bb:_bc;if(_bf<12){_bf=12;}if(_b1==false){_ac.moveSum+=d2;var _c0;_c0={"val":vc3,"acs":ac2,"ang":ag2,"x":_b2,"y":_b3,"tm":t2,"stt":_ae,"dst":d2,"bend":false,"abnd":false,"rbnd":0,"ruvl":0,"ufac":0,"xfvl":0};_ac.lastData.push(_c0);if(_ac.lastData.length>_bf){_ac.lastData.shift();}}else{var xxx=1;}var _c1=this.angleThres;var _c2=this.angleTrig;var v1,v3,ax2;if(this.smoothing==false){v1=vc1;v3=vc3;ax2=ac2;}else{var _c3=_ac.lastData[_ac.lastData.length-1];v1=_ac.lastVal;_c3["ruvl"]=this.getRareUniVal(_ac.lastData,30);this.findBend(_ac.lastData,_ac.moveSum,8,_c1,_c2,_bf,_ac.zoomRatio);_c3["ufac"]=this.getUniAcs(_ac.lastData,30);_c3["xfvl"]=this.getExUniVal(_ac.lastData,90,60,0.2,0.5);v3=_c3["xfvl"];ax2=_c3["ufac"];}var _c4=this.coExpornent;var _c5=this.accelRatio;var _c6=this.decelRatio;var _c7=this.minValAccel;var _c8=this.zoopRatio;var _c9=this.loopDivValue;var _ca=this.vxRatio;var _cb=this.axRatio;if(_af==false){if(this.startSharpness>0){var _cc=_b6+_b7;var _cd=_ac.moveSum+_ac.moveCount;if(_cc<this.startSharpness){if(_cd>this.startSharpness){_cd=this.startSharpness;}var _ce=(_cc+_cd)/2;_b5=_b5*_ce/this.startSharpness;}}if(_b0){if(_ac.endingBonus==0){_ac.endingBonus=this.endingValBonus;}else{_ac.endingBonus*=this.endingValRatio;}v1+=_ac.endingBonus;v3+=_ac.endingBonus*this.endingValRatio;}}else{_b5*=0.5;v3*=this.dotValRatio;}var x1,y1,x2,y2,x3,y3,dd1,dd2;x1=(px1+px2)/2;y1=(py1+py2)/2;dd1=d1/2;x2=px2;y2=py2;x3=(px2+px3)/2;y3=(py2+py3)/2;dd2=d2/2;var v2,a1,a2,a3;if(_b1==true){v2=v1;a1=a2=a3=_ac.lastAcs;}else{if(_ac.moveCount==1){v2=v3;a1=a2=a3=0;}else{v2=(v1+v3)/2;a1=_ac.lastAcs;a3=(v3-v1)/t2;a2=(a3-a1)/2;}}var va3;if(a3>=0){va3=v3+a3*_c5;}else{va3=v3+a3*_c6;}va3=va3*_ca+ax2*_cb;if(va3<_c7){va3=_c7;}var rd1=_ac.lastRadius;if(rd1<0){var va1;if(a1>=0){va1=v1+a1*_c5;}else{va1=v1+a1*_c6;}va1=va1*_ca+ax2*_cb;if(va1<_c7){va1=_c7;}rd1=(_b4+_b5*Math.exp(_c4*va1));}var rd3=(_b4+_b5*Math.exp(_c4*va3));var _cf=(rd1+rd3)/(2*_ac.zoomRatio);if(_b0){_cf+=this.endingRaveBonus;}var _d0,_d1,_d2;if(InkTool.InkLib.needsEmulateCanvas()){_d0=1;_d1=8;}else{_d0=4;_d1=1;}_d2=0.5;var _d3=Math.round((dd1+dd2)*_ac.zoomRatio/_d1);if(_d3<1){_d3=1;}var _d4=Math.round((dd1+dd2)*_ac.zoomRatio/_d2);if(_d4<1){_d4=1;}var _d5=(dd1+dd2)/_cf*_d0;var _d6=Math.round(_d5);if(_d6<1){_d6=1;}var _d7=this.getPenColor();var _d8;var _d9,_da;var _db=va3;if(_db<=0.0001){_db=0.0001;}if(this.feltmode==true){_d9=1/(_db*this.vBeta*_c8);_da=this.aExp;}else{if(this.transparency==true){_d9=1/Math.sqrt(_db*this.vBeta*_c8);_da=this.aExp;}else{_d9=this.vBeta;_da=this.aExp;}}var _dc=1-Math.exp(_da*_cf);if(_d9<_dc){_dc=_d9;}var _dd=_d7.A*_dc;var _de;if(_af==true){if(this.feltmode==true){_dd/=2;}_de=2;}else{_de=_d0*2*_d6/_d5;}if(_d6<=0){}else{if(_d6<_d3){_de*=(_d3/_d6);_bd*=(_d3/_d6);_be*=(_d3/_d6);_d6=_d3;}else{if(_d6>_d4){_de*=(_d4/_d6);_bd*=(_d4/_d6);_be*=(_d4/_d6);_d6=_d4;}}}var _df=1-Math.pow((255-_dd)/255,1/_de);_d8=_df;if(_b1==true||_ac.moveCount==1){var xs,ys,xe,ye,vs,ve,as;var rs=_ac.lastRadius;var re;var gs=_ac.lastGamma;var ge=_d8;if(gs<0){gs=_d8;}var _e0=_d6;if(_b1==true){xs=x1;ys=y1;xe=x2;ye=y2;vs=v1;if(ax2>0){ve=v1+ax2*t1;}else{ve=v1;}as=a1;_e0++;}else{xs=x2;ys=y2;xe=x3;ye=y3;vs=v3;ve=v3;as=a3;}if(rs<0){rs=(_b4+_b5*Math.exp(_c4*vs));}var dva;if(as>=0){dva=ve+as*_c5;}else{dva=ve+as*_c6;}dva=dva*_ca+ax2*_cb;if(dva<_c7){dva=_c7;}re=(_b4+_b5*Math.exp(_c4*dva));var _e1=_ac.lastRadius;if(_e1<0){_e1=rs;}var _e2=_ac.lastAlpha;if(_e2<0){_e2=gs;}for(var idx=0;idx<_e0;idx++){var dt=idx/_d6;var dx=xs+(xe-xs)*dt;var dy=ys+(ye-ys)*dt;var dr=rs+(re-rs)*dt;var dg=gs+(ge-gs)*dt;if(_be<=1){_e2=dg;}else{_e2=(_e2*(_be-1)+dg)/_be;}if(_bd<=1){_e1=dr;}else{_e1=(_e1*(_bd-1)+dr)/_bd;}if(_ac.isCircleInRect(dx,dy,_e1)){var _e3="rgba("+_d7.R+","+_d7.G+","+_d7.B+","+_e2.toFixed(5)+")";ctx.fillStyle=_e3;ctx.beginPath();ctx.arc(dx,dy,_e1,0,Math.PI*2,false);ctx.fill();}}_ac.lastRadius=_e1;_ac.lastAlpha=_e2;}else{if(_ba==5){var xs,ys,xe,ye,vs,ve,as;xs=x1;ys=y1;xe=x2;ye=y2;vs=v1;ve=v2;as=a1;var gs=_ac.lastGamma;if(gs<0){gs=_d8;}var ge=(gs+_d8)/2;var _e4=Math.round(_d6*dd1/(dd1+dd2));if(_e4<1){_e4=1;}var _e5=_d6-_e4;_d6=_e4;for(var bct=0;bct<2;bct++){var rs,re;rs=_ac.lastRadius;if(rs<0){rs=(_b4+_b5*Math.exp(_c4*vs));}var dva;if(as>=0){dva=ve+as*_c5;}else{dva=ve+as*_c6;}dva=dva*_ca+ax2*_cb;if(dva<_c7){dva=_c7;}re=(_b4+_b5*Math.exp(_c4*dva));var _e1=_ac.lastRadius;if(_e1<0){_e1=rs;}var _e2=_ac.lastAlpha;if(_e2<0){_e2=gs;}for(var idx=0;idx<_d6;idx++){var dt=idx/_d6;var dx=xs+(xe-xs)*dt;var dy=ys+(ye-ys)*dt;var dr=rs+(re-rs)*dt;var dg=gs+(ge-gs)*dt;if(_be<=1){_e2=dg;}else{_e2=(_e2*(_be-1)+dg)/_be;}if(_bd<=1){_e1=dr;}else{_e1=(_e1*(_bd-1)+dr)/_bd;}if(_ac.isCircleInRect(dx,dy,_e1)){var _e3="rgba("+_d7.R+","+_d7.G+","+_d7.B+","+_e2.toFixed(5)+")";ctx.fillStyle=_e3;ctx.beginPath();ctx.arc(dx,dy,_e1,0,Math.PI*2,false);ctx.fill();}}_ac.lastRadius=_e1;_ac.lastAlpha=_e2;xs=x2;ys=y2;xe=x3;ye=y3;vs=v2;ve=v3;as=a3;gs=ge;ge=_d8;_d6=_e5;}}else{var _e6=dd1;var _e7=dd2;var _e8=_e7-_e6;var mia=-_e6;var ap2=_e6*_e6;var bp2=_e7*_e7;var _e9=bp2-ap2;var r1=_ac.lastRadius;if(r1<0){r1=(_b4+_b5*Math.exp(_c4*v1));}var _ea,_eb;if(a2>=0){_ea=v2+a2*_c5;}else{_ea=v2+a2*_c6;}_ea=_ea*_ca+ax2*_cb;if(_ea<_c7){_ea=_c7;}if(a3>=0){_eb=v3+a3*_c5;}else{_eb=v3+a3*_c6;}_eb=_eb*_ca+ax2*_cb;if(_eb<_c7){_eb=_c7;}var r2=(_b4+_b5*Math.exp(_c4*_ea));var r3=(_b4+_b5*Math.exp(_c4*_eb));var g1=_ac.lastGamma;if(g1<0){g1=_d8;}var g3=_d8;var g2=(g1+g3)/2;var _e1=r1;var _e2=g1;var _ec=(Math.abs(_e8)<0.1);for(var idx=0;idx<_d6;idx++){var dt;if(_ec){dt=idx/_d6;}else{var _ed=idx/_d6;dt=(mia+Math.sqrt(ap2+_e9*_ed))/_e8;}var dx=x1*(1-dt)*(1-dt)+x2*2*dt*(1-dt)+x3*dt*dt;var dy=y1*(1-dt)*(1-dt)+y2*2*dt*(1-dt)+y3*dt*dt;var dr=r1*(1-dt)*(1-dt)+r2*2*dt*(1-dt)+r3*dt*dt;var dg=g1*(1-dt)*(1-dt)+g2*2*dt*(1-dt)+g3*dt*dt;if(_be<=1){_e2=dg;}else{_e2=(_e2*(_be-1)+dg)/_be;}if(_bd<=1){_e1=dr;}else{_e1=(_e1*(_bd-1)+dr)/_bd;}if(_ac.isCircleInRect(dx,dy,_e1)){var _e3="rgba("+_d7.R+","+_d7.G+","+_d7.B+","+_e2.toFixed(5)+")";ctx.fillStyle=_e3;ctx.beginPath();ctx.arc(dx,dy,_e1,0,Math.PI*2,false);ctx.fill();}}_ac.lastRadius=_e1;_ac.lastAlpha=_e2;}}_ac.lastVal=v3;_ac.lastAcs=a3;_ac.lastGamma=_d8;},findBend:function(_ee,_ef,_f0,_f1,_f2,_f3,_f4){_f1=Math.PI/8;_f2=Math.PI/2;var _f5=4;var _f6=Math.PI/3;var _f7=2;var _f8=2;var _f9=_ee.length;if(_f9==0){return;}var _fa;_fa=_ee[_f9-1].ruvl;var _fb=1/16;var _fc=_ee[_f9-1].ang;var _fd=0;if(_f9>_f3){_fd=_f9-_f3;}if(_f2>0&&_f9>=2){var _fe=_ee[_f9-1].x;var _ff=_ee[_f9-1].y;var _100=_ee[_f9-2].x;var _101=_ee[_f9-2].y;var _102=_100;var _103=_101;var _104=false;var _105=false;var _106=_ef;for(var idx=_f9-2;idx>=_fd;idx--){_106-=_ee[idx+1].dst;if(_106<_f0){continue;}var val=_ee[idx].ruvl;var _107=this.getAngleDiff(_ee[idx].ang,_fc);if(_107!=null){var daxp=_fe-_102;var dayp=_ff-_103;var _108=Math.sqrt(daxp*daxp+dayp*dayp)/_f4;var _109=_ee[idx].x;var _10a=_ee[idx].y;var dxp=_102-_109;var dyp=_103-_10a;var dist=Math.sqrt(dxp*dxp+dyp*dyp)/_f4;if(_108>=_f8&&((_107>=_f2&&dist<=_f5)||(_107>=_f6&&dist<=_f7))){var tval=_ee[idx].ruvl;var tnum=1;var aidx=_f9-1;for(var tct=idx+1;tct<_f9-1;tct++){var _10b=this.getAngleDiff(_ee[tct].ang,_fc);if(_10b!=null&&_10b<=_f1&&_ee[tct].acs>0){aidx=tct;break;}}_ee[_f9-1].bend=true;_ee[aidx].abnd=true;if(_fa>=_fb&&tval<_fb){_ee[_f9-1].rbnd=3;_ee[aidx].rbnd=3;}else{_ee[_f9-1].rbnd=2;_ee[aidx].rbnd=2;}_104=true;}if(idx>0){var _10c=_ee[idx-1].x;var _10d=_ee[idx-1].y;var doxp=_100-_10c;var doyp=_101-_10d;var _10e=Math.sqrt(doxp*doxp+doyp*doyp)/_f4;if(_10e<_f8){_102=_10c;_103=_10d;_fc=_ee[idx].ang;}}}if(_fa>=_fb&&val<_fb){_ee[idx+1].bend=true;_ee[idx+1].abnd=true;_ee[idx+1].rbnd=1;_105=true;}if(_104&&_105){break;}}}},getAveVal:function(_10f,_110){var min=10000000;var max=0;var _111=-1;var _112=-1;var _113=_10f.length;var _114=0;if(_113>_110){_114=_113-_110;}for(var idx=_113-1;idx>=_114;idx--){if(_10f[idx].bend==true){_114=idx;break;}}var anum=0;for(var idx=_114;idx<_113;idx++){var val=_10f[idx].val;if(val<0){continue;}if(val<min){_111=idx;min=val;}if(val>max){_112=idx;max=val;}anum++;}var num=0;var sum=0;for(var idx=_114;idx<_113;idx++){var val=_10f[idx].val;if(val<0){continue;}else{if(idx==_111||idx==_112){if(anum<=2){sum+=val;num++;}else{if(anum<5){var rate=(anum-2)/3;sum+=val*rate;num+=rate;}}}else{sum+=val;num++;}}}var resp;if(num==0){resp=0;}else{resp=sum/num;}return resp;},getAveAcs:function(_115,_116){var min=10000000;var max=0;var _117=-1;var _118=-1;var _119=_115.length;var _11a=0;if(_119>_116){_11a=_119-_116;}for(var idx=_119-1;idx>=_11a;idx--){if(_115[idx].abnd==true){_11a=idx;break;}}var anum=0;for(var idx=_11a;idx<_119;idx++){var val=_115[idx].val;var acs=_115[idx].acs;if(val<0){continue;}if(acs<min){_117=idx;min=acs;}if(acs>max){_118=idx;max=acs;}anum++;}var num=0;var sum=0;for(var idx=_11a;idx<_119;idx++){var val=_115[idx].val;var acs=_115[idx].acs;if(val<0){continue;}else{if(idx==_117||idx==_118){if(anum<=2){sum+=acs;num++;}else{if(anum<5){var rate=(anum-2)/3;sum+=acs*rate;num+=rate;}}}else{sum+=acs;num++;}}}var resp;if(num==0){resp=0;}else{resp=sum/num;}return resp;},getRareUniVal:function(_11b,_11c){var _11d=0;var _11e=0;var _11f=0;var _120=_11b.length;for(var idx=_120-1;idx>=0;idx--){var time=_11b[idx].tm;var dist=_11b[idx].dst;if(_11d+time>_11c){break;}_11d+=time;_11e+=dist;_11f++;}var resp;if(_11f==0||_11d==0){if(_120==0){resp=0;}else{resp=_11b[_120-1].val;if(resp<0){resp=0;}}}else{resp=_11e/_11d;}return resp;},getUniVal:function(_121,_122){var _123=0;var _124=0;var _125=0;var _126=_121.length;for(var idx=_126-1;idx>=0;idx--){var time=_121[idx].tm;var dist=_121[idx].dst;if(_123+time>_122){break;}else{if(_121[idx].bend==true){break;}}_123+=time;_124+=dist;_125++;}var resp;if(_125==0||_123==0){if(_126==0){resp=0;}else{resp=_121[_126-1].ruvl;}}else{resp=_124/_123;}return resp;},getExUniVal:function(_127,_128,_129,_12a,_12b){var _12c=_128;if(_127.length>0){var val=_127[_127.length-1].ruvl;if(val<=_12a){_12c=_128;}else{if(val>=_12b){_12c=_129;}else{_12c=_128+(_129-_128)*(val-_12a)/(_12b-_12a);}}}return this.getUniVal(_127,_12c);},getValEnergy:function(_12d,_12e,_12f){var resp=0;if(_12d.length>1){var _130=_12d[_12d.length-1].xfvl;var _131=_12d[_12d.length-2].xfvl;var _132=_12d[_12d.length-2].engv;if(_130>=_131){var usep=_131*_12e;var lost=_132*usep;resp=_132-lost;if(resp<0){resp=0;}}else{resp=_132+(_131-_130);}}return resp;},getExAdd:function(_133,_134,_135,_136,_137,_138){var resp=0;if(_133.length>1){var _139=_133[_133.length-1].xfvl;var _13a=_133[_133.length-2].xfvl;var _13b=_133[_133.length-1].engv;if(_139>=_13a){var mul;if(_139>=_135){mul=_134;}else{mul=_134*_139/_135;}var mul2;var _13c=_139-_13a;if(_13c>=_136){mul2=1;}else{mul2=_13c/_136;}resp=_13b*mul*mul2;var _13d=_138-_139;if(_13d<_137){_13d=_137;}if(resp>_13d){resp=_13d;}}else{resp=0;}}return resp;},getExVal:function(_13e,_13f,_140){var _141=0;var _142=0;var _143=_13e.length;for(var idx=_143-1;idx>=0;idx--){var time=_13e[idx].tm;var eng=_13e[idx].enga;if(_141+time>_13f){break;}_141+=time;_142+=eng*time;}var _144,resp;if(_141==0){_144=_13e[_143-1].enga;}else{_144=_142/_141;}resp=_13e[_143-1].xfvl+_144;if(_143>1){var _145=_13e[_143-2].exvl;var _146=0.125;var _147=0.125;if(resp>_145+_146){resp=_145+_146;}else{if(resp<_145-_147){resp=_145-_147;}}}if(_13e.length>3){var _148=0;var _149=_13e[_13e.length-4].val;var _14a=_13e[_13e.length-3].val;var _14b=_13e[_13e.length-2].val;var _14c=_13e[_13e.length-1].val;var _14d=_13e[_13e.length-1].engv;if(_14a>=_149+0.05&&_14b>=_14a+0.05&&_14c>=_14b+0.05&&_14c>=_149+0.3){_148=-0.1+(_14c-_149);}else{if(_14b>=_14a+0.05&&_14c>=_14b+0.05&&_14c>=_14a+0.2){_148=-0.1+(_14c-_14a);}}if(_14d<0.05){var _14e=_14d/0.05;_148=_148*_14e*_14e;}if(resp>=0.5){var _14f=0.5/resp;_148=_148*_14f*_14f*_14f*_14f;}resp+=_148*_140;}return resp;},getUniAcs:function(_150,_151){var _152=0;var _153=-1;var _154=_150.length;for(var idx=_154-1;idx>=0;idx--){var time=_150[idx].tm;_153=_150[idx].ruvl;if(_152+time>_151){break;}else{if(_150[idx].abnd==true){break;}}_152+=time;}var resp;if(_152==0){if(_154==0){resp=0;}else{resp=_150[_154-1].acs;}}else{resp=(_150[_154-1].ruvl-_153)/_152;}return resp;},getUniAng:function(_155,_156){var _157=_155.length;var xp=_155[_157-1].x;var yp=_155[_157-1].y;var _158=false;var _159=0;var _15a=0;for(var idx=_157-2;idx>=0;idx--){var xo=_155[idx].x;var yo=_155[idx].y;var dx=(xp-xo);var dy=(yp-yo);var dist=(dx*dx)+(dy*dy);if(dist>=_156){_159=xo;_15a=yo;_158=true;break;}}var resp;if(_158==false){if(_157==0){resp=0;}else{resp=_155[_157-1].ang;}}else{resp=this.getAngleOfLineSegment(_159,_15a,xp,yp);}return resp;},getDifAng:function(_15b,_15c){var _15d=_15b.length;var xp=_15b[_15d-1].x;var yp=_15b[_15d-1].y;var _15e=-1;var _15f=0;var _160=0;for(var idx=_15d-2;idx>=0;idx--){var xo=_15b[idx].x;var yo=_15b[idx].y;var dx=(xp-xo);var dy=(yp-yo);var dist=(dx*dx)+(dy*dy);if(dist>=_15c){_15e=idx;_15f=xo;_160=yo;break;}}var resp;if(_15e<0){resp=0;}else{var ang=this.getAngleOfLineSegment(_15f,_160,xp,yp);resp=this.getAngleDiff(ang,_15b[_15e].ufag);}return resp;},getAngleDiff:function(_161,_162){if(_161==null||_162==null){return null;}var _163=Math.abs(_161-_162);if(_163>Math.PI){_163=2*Math.PI-_163;}return _163;},getAngleOfLineSegment:function(x1,y1,x2,y2){return this.getAngleOfVector(x2-x1,y2-y1);},getAngleOfVector:function(xp,yp){var dist,_164;dist=xp*xp+yp*yp;if(dist==0){return null;}_164=Math.acos(xp/Math.sqrt(dist));if(yp<0){_164=2*Math.PI-_164;}return _164;},strokePause:function(_165,xp,yp,wd,tm){this.strokeMoveStat(_165,xp,yp,wd,tm,3);},strokeMoveFeature:function(_166,xp,yp,wd,tm){this.strokeMoveStat(_166,xp,yp,wd,tm,4);},strokeMoveBend:function(_167,xp,yp,wd,tm){this.strokeMoveStat(_167,xp,yp,wd,tm,5);},strokeMoveBendLater:function(_168,xp,yp,wd,tm){var _169=_168.lastData[_168.lastData.length-1];_169.stt=5;},strokeMoveToEnd:function(_16a,xp,yp,wd,tm){this.strokeMoveStat(_16a,xp,yp,wd,tm,6);},strokeEnd:function(_16b,xp,yp,wd,tm){_16b.timeStr="";var ctx=_16b.context;if(tm<=_16b.lastTime+8){tm=_16b.lastTime+8;}var _16c=_16b.queuePoints.length+1;if(_16b.moveCount<=1){_16c+=(2-_16b.moveCount);}var _16d=(tm-_16b.lastTime)/_16c;var _16e=_16d;var _16f,_170;while(_16b.queuePoints.length>0){var _171=_16b.queuePoints.shift();_16f=_16b.xpDataToDraw(_171.x);_170=_16b.ypDataToDraw(_171.y);var dx=(_16f-_16b.lastDrawX);var dy=(_170-_16b.lastDrawY);if(dx==0&&dy==0){_16d+=_16e;continue;}var _172=_171.m;this.strokeMoveSub(_16b,_16f,_170,_16d,_172,false,true,false);_16b.lastDrawX=_16f;_16b.lastDrawY=_170;_16d=_16e;}_16f=_16b.xpDataToDraw(xp);_170=_16b.ypDataToDraw(yp);var vlx,vly,_173;var _174=_16b.lastData[_16b.lastData.length-1];if(_16b.moveCount<=5){var lxd=xp-_16b.startX;var lyd=yp-_16b.startY;var len=(lxd*lxd+lyd*lyd);if(len<=12.25){_173=true;}else{_173=false;}}else{_173=false;}if(_173==true){if(_16b.moveCount==0){this.strokeMoveSub(_16b,_174.x,_174.y,_16d,2,_173,true,false);vlx=_174.x;vly=_174.y;this.strokeMoveSub(_16b,vlx,vly,_16d,2,_173,true,false);}else{vlx=_174.x;vly=_174.y;this.strokeMoveSub(_16b,vlx,vly,_16d,2,_173,true,false);}}else{var lx=_16b.lastDrawX;var ly=_16b.lastDrawY;if(lx!=_16f||ly!=_170){this.strokeMoveSub(_16b,_16f,_170,_16d,2,_173,true,false);}vlx=_16f;vly=_170;}this.strokeMoveSub(_16b,vlx,vly,_16d,2,_173,true,true);},drawEnd:function(_175){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "FeltPen";}});}if(typeof InkTool.SpeedSenseFeltPen==="undefined"){InkTool.SpeedSenseFeltPen=InkTool.InkLib.Class.create(InkTool.InkFeltPen,{getSubInfo:function(){return "SpeedSenseFeltPen";}});}if(typeof InkTool.InkVariableBallpointPen==="undefined"){InkTool.InkVariableBallpointPen=InkTool.InkLib.Class.create(InkTool.InkFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseBallpointPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=InkTool.InkPenType.Old_BallpointPen;this.transparency=false;this.smoothing=true;this.startSharpness=10;this.feltmode=false;this.coExpornent=-1.3;this.accelRatio=0;this.decelRatio=0;this.vxRatio=1;this.axRatio=3;this.angleThres=Math.PI/4;this.angleTrig=Math.PI/3;this.minValAccel=-0.01;this.zoopRatio=1.4;this.loopDivValue=24;if(InkTool.InkLib.Browser.MobileSafari){this.vBeta=0.95;this.aExp=-1.8;}else{this.vBeta=1;this.aExp=-2.4;}this.valSmooth=4;this.acsSmooth=3;this.radiusSmooth=2;this.alphaSmooth=0;this.endingValBonus=0.4;this.endingValRatio=2;this.dotValRatio=0.5;this.endingRaveBonus=0;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "VariableBallpointPen";}});}if(typeof InkTool.SpeedSenseBallpointPen==="undefined"){InkTool.SpeedSenseBallpointPen=InkTool.InkLib.Class.create(InkTool.InkVariableBallpointPen,{getSubInfo:function(){return "SpeedSenseBallpointPen";}});}if(typeof InkTool.InkVariableSignPen==="undefined"){InkTool.InkVariableSignPen=InkTool.InkLib.Class.create(InkTool.InkFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseSignPen;this.col=new InkTool.InkColor("black");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=InkTool.InkPenType.Old_VariableSignPen;this.transparency=true;this.smoothing=true;this.startSharpness=7;this.feltmode=false;this.coExpornent=-1.3;this.accelRatio=0;this.decelRatio=0;this.vxRatio=1;this.axRatio=3;this.angleThres=Math.PI/4;this.angleTrig=Math.PI/3;this.minValAccel=-0.01;this.zoopRatio=1;this.loopDivValue=24;this.vBeta=2.8;this.aExp=-1.2;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=2;this.alphaSmooth=1;this.endingValBonus=0.2;this.endingValRatio=2;this.dotValRatio=0.5;this.endingRaveBonus=0.5;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "VariableSignPen";}});}if(typeof InkTool.SpeedSenseSignPen==="undefined"){InkTool.SpeedSenseSignPen=InkTool.InkLib.Class.create(InkTool.InkVariableSignPen,{getSubInfo:function(){return "SpeedSenseSignPen";}});}if(typeof InkTool.InkVariableFudePen==="undefined"){InkTool.InkVariableFudePen=InkTool.InkLib.Class.create(InkTool.InkFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseFudePen;this.col=new InkTool.InkColor("black");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=InkTool.InkPenType.Old_VariableFudePen;this.transparency=true;this.smoothing=true;this.startSharpness=20;this.feltmode=false;this.coExpornent=-1.5;this.accelRatio=24;this.decelRatio=12;this.vxRatio=1;this.axRatio=0;this.angleThres=Math.PI/4;this.angleTrig=Math.PI/3;this.minValAccel=-0.3;this.zoopRatio=1.5;this.loopDivValue=2;this.vBeta=2.8;this.aExp=-1.2;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=0;this.alphaSmooth=0;this.endingValBonus=0.3;this.endingValRatio=2;this.dotValRatio=0.5;this.endingRaveBonus=0.5;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "VariableFudePen";}});}if(typeof InkTool.SpeedSenseFudePen==="undefined"){InkTool.SpeedSenseFudePen=InkTool.InkLib.Class.create(InkTool.InkVariableFudePen,{getSubInfo:function(){return "SpeedSenseFudePen";}});}if(typeof InkTool.SpeedSenseSchoolPen==="undefined"){InkTool.SpeedSenseSchoolPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseSchoolPen;this.col=new InkTool.InkColor("darkred");this.w=2;this.minw=1;this.maxw=5;this.oldType=InkTool.InkPenType.SpeedSenseSchoolPen;},drawStart:function(_176){var ctx=_176.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_176.widthDataToDraw(this.getPenWidth());ctx.lineCap="butt";ctx.lineJoin="round";},strokeStart:function(_177,xp,yp,wd,tm){var ctx=_177.context;var _178=_177.xpDataToDraw(xp);var _179=_177.ypDataToDraw(yp);_177.lastData=[];_177.llastX=_177.lastX=_178;_177.llastY=_177.lastY=_179;_177.moveCount=0;var _17a=this.getPenColor().A;_177.dlen=this.getDLenByAlpha(_17a);},strokeMove:function(_17b,xp,yp,wd,tm){return this.strokeMoveSub(_17b,xp,yp,wd,tm);},strokeMoveSub:function(_17c,xp,yp,wd,tm){var ctx=_17c.context;var _17d=_17c.xpDataToDraw(xp);var _17e=_17c.ypDataToDraw(yp);if(_17d==_17c.lastX&&_17e==_17c.lastY){return;}var x1=(_17c.lastX+_17c.llastX)/2;var y1=(_17c.lastY+_17c.llastY)/2;var x2=_17c.lastX;var y2=_17c.lastY;var x3=(_17c.lastX+_17d)/2;var y3=(_17c.lastY+_17e)/2;var dlen=_17c.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);var x3m=x3;var y3m=y3;if(dd3>0){var px3=dx3*dlen/dd3;var py3=dy3*dlen/dd3;x3m+=px3;y3m+=py3;}if(_17c.moveCount>0){var x1m=x1;var y1m=y1;if(dd1>0){var px1=dx1*dlen/dd1;var py1=dy1*dlen/dd1;x1m+=px1;y1m+=py1;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.quadraticCurveTo(x2,y2,x3m,y3m);ctx.stroke();}else{if(dd1+dd3>=4){var rd1=_17c.widthDataToDraw(this.getPenWidth())/2;var ddx3=dx3*rd1/dd3;var ddy3=dy3*rd1/dd3;var x3a=x3m-ddy3;var y3a=y3m+ddx3;var x3b=x3m+ddy3;var y3b=y3m-ddx3;ctx.beginPath();ctx.moveTo(x3a,y3a);ctx.lineTo(x1,y1);ctx.lineTo(x3b,y3b);ctx.closePath();ctx.fill();}else{var xc=x2;var yc=y2;var x2m=x2;var y2m=y2;if(dd3>0){var px2=dx3*dlen/dd3;var py2=dy3*dlen/dd3;xc+=px2;yc+=py2;x2m-=px2;y2m-=py2;}var _17f=_17c.widthDataToDraw(this.getPenWidth())/2;var _180;if(dx3==0){if(dy3>0){_180=Math.PI/2;}else{if(dy3==0){_180=-100;}else{_180=Math.PI*3/2;}}}else{_180=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_180=Math.PI*2-_180;}}else{if(dy3>=0){_180=Math.PI-_180;}else{_180=Math.PI+_180;}}}var _181,_182;if(_180==-100){_181=0;_182=Math.PI*2;}else{_181=_180+Math.PI/2;if(_181>Math.PI*2){_181-=Math.PI*2;}_182=_180-Math.PI/2;if(_182<0){_182+=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_17f,_181,_182,false);ctx.fill();ctx.beginPath();ctx.moveTo(x2m,y2m);ctx.lineTo(x3m,y3m);ctx.stroke();}}_17c.llastX=_17c.lastX;_17c.llastY=_17c.lastY;_17c.lastX=_17d;_17c.lastY=_17e;_17c.moveCount++;},strokeEnd:function(_183,xp,yp,wd,tm){var ctx=_183.context;var _184=_183.xpDataToDraw(xp);var _185=_183.ypDataToDraw(yp);var x1=(_183.lastX+_183.llastX)/2;var y1=(_183.lastY+_183.llastY)/2;var x2=_183.lastX;var y2=_183.lastY;var x3=_184;var y3=_185;var dlen=_183.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var x1m=x1;var y1m=y1;if(dd1>0){var px1=dx1*dlen/dd1;var py1=dy1*dlen/dd1;x1m+=px1;y1m+=py1;}var dx2=(x2-x1);var dy2=(y2-y1);var dd2=Math.sqrt(dx2*dx2+dy2*dy2);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);if(_183.moveCount==0){var _186=_183.widthDataToDraw(this.getPenWidth())/2;var _187,_188;_187=0;_188=Math.PI*2;ctx.beginPath();ctx.arc(x3,y3,_186,_187,_188,false);ctx.fill();}else{if(dd2+dd3<8){var xc=x3;var yc=y3;if(x2==x3&&y2==y3){dx3=dx2;dy3=dy2;dd3=dd2;var x3m=x3;var y3m=y3;if(dd2>0){var px3=dx3*dlen/dd3;var py3=dy3*dlen/dd3;x3m+=px3;y3m+=py3;xc-=px3;yc-=py3;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.lineTo(x3m,y3m);ctx.stroke();}else{var x3m=x3;var y3m=y3;if(dd3>0){var px3=dx3*dlen/dd3;var py3=dy3*dlen/dd3;x3m+=px3;y3m+=py3;xc-=px3;yc-=py3;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.quadraticCurveTo(x2,y2,x3m,y3m);ctx.stroke();}var _186=_183.widthDataToDraw(this.getPenWidth())/2;var _189;if(dx3==0){if(dy3>0){_189=Math.PI/2;}else{if(dy3==0){_189=-100;}else{_189=Math.PI*3/2;}}}else{_189=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_189=Math.PI*2-_189;}}else{if(dy3>=0){_189=Math.PI-_189;}else{_189=Math.PI+_189;}}}var _187,_188;if(_189==-100){_187=0;_188=Math.PI*2;}else{_187=_189-Math.PI/2;if(_187<0){_187+=Math.PI*2;}_188=_189+Math.PI/2;if(_188>Math.PI*2){_188-=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_186,_187,_188,false);ctx.fill();}else{var rd1=_183.widthDataToDraw(this.getPenWidth())/2;var ddx1=dx2*rd1/dd2;var ddy1=dy2*rd1/dd2;var x1a=x1m-ddy1;var y1a=y1m+ddx1;var x1b=x1m+ddy1;var y1b=y1m-ddx1;var rd2=rd1*dd3/(dd2+dd3);var ddx2=dx3*rd2/dd3;var ddy2=dy3*rd2/dd3;var x2a=x2-ddy2;var y2a=y2+ddx2;var x2b=x2+ddy2;var y2b=y2-ddx2;if(x2==x3&&y2==y3){ctx.beginPath();ctx.moveTo(x1a,y1a);ctx.lineTo(x3,y3);ctx.lineTo(x1b,y1b);ctx.closePath();ctx.fill();}else{ctx.beginPath();ctx.moveTo(x1a,y1a);ctx.quadraticCurveTo(x2a,y2a,x3,y3);ctx.quadraticCurveTo(x2b,y2b,x1b,y1b);ctx.closePath();ctx.fill();}}}_183.llastX=_183.lastX;_183.llastY=_183.lastY;_183.lastX=_184;_183.lastY=_185;},drawEnd:function(_18a){},fullDrawStart:function(_18b){var ctx=_18b.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_18b.widthDataToDraw(this.getPenWidth());ctx.lineCap="butt";ctx.lineJoin="round";},fullStrokeStart:function(_18c,xp,yp,wd,tm){var ctx=_18c.context;var _18d=_18c.xpDataToDraw(xp);var _18e=_18c.ypDataToDraw(yp);ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();_18c.llastX=_18c.lastX=_18d;_18c.llastY=_18c.lastY=_18e;_18c.lastData=[];_18c.moveCount=0;var _18f=this.getPenColor().A;_18c.dlen=this.getDLenByAlpha(_18f);},fullStrokeMove:function(_190,xp,yp,wd,tm){this.fullStrokeMoveSub(_190,xp,yp,wd,tm);},fullStrokeMoveSub:function(_191,xp,yp,wd,tm){var ctx=_191.context;var _192=_191.xpDataToDraw(xp);var _193=_191.ypDataToDraw(yp);if(_192==_191.lastX&&_193==_191.lastY){return;}var x1=(_191.lastX+_191.llastX)/2;var y1=(_191.lastY+_191.llastY)/2;var x2=_191.lastX;var y2=_191.lastY;var x3=(_191.lastX+_192)/2;var y3=(_191.lastY+_193)/2;if(_191.moveCount>0){ctx.quadraticCurveTo(x2,y2,x3,y3);}else{var dlen=_191.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);var x3c=x3;var y3c=y3;var x3d=x3;var y3d=y3;if(dd3>0){var px3=dx3*dlen/dd3;var py3=dy3*dlen/dd3;x3c+=px3;y3c+=py3;x3d-=px3;y3d-=py3;}if(dd1+dd3>=4){var rd1=_191.widthDataToDraw(this.getPenWidth())/2;var ddx3=dx3*rd1/dd3;var ddy3=dy3*rd1/dd3;var x3a=x3c-ddy3;var y3a=y3c+ddx3;var x3b=x3c+ddy3;var y3b=y3c-ddx3;ctx.beginPath();ctx.moveTo(x3a,y3a);ctx.lineTo(x1,y1);ctx.lineTo(x3b,y3b);ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(x3d,y3d);}else{var xc=x2;var yc=y2;var x2m=x2;var y2m=y2;var dd2=Math.sqrt(dx3*dx3+dy3*dy3);if(dd2>0){var px2=dx3*dlen/dd2;var py2=dy3*dlen/dd2;xc+=px2;yc+=py2;x2m-=px2;y2m-=py2;}var _194=_191.widthDataToDraw(this.getPenWidth())/2;var _195;if(dx3==0){if(dy3>0){_195=Math.PI/2;}else{if(dy3==0){_195=-100;}else{_195=Math.PI*3/2;}}}else{_195=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_195=Math.PI*2-_195;}}else{if(dy3>=0){_195=Math.PI-_195;}else{_195=Math.PI+_195;}}}var _196,_197;if(_195==-100){_196=0;_197=Math.PI*2;}else{_196=_195+Math.PI/2;if(_196>Math.PI*2){_196-=Math.PI*2;}_197=_195-Math.PI/2;if(_197<0){_197+=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_194,_196,_197,false);ctx.fill();ctx.beginPath();ctx.moveTo(x2m,y2m);ctx.lineTo(x3,y3);}}_191.llastX=_191.lastX;_191.llastY=_191.lastY;_191.lastX=_192;_191.lastY=_193;_191.moveCount++;},fullStrokePause:function(_198,xp,yp,wd,tm){this.fullStrokeMoveSub(_198,xp,yp,wd,tm);},fullStrokeMoveFeature:function(_199,xp,yp,wd,tm){this.fullStrokeMoveSub(_199,xp,yp,wd,tm);},fullStrokeMoveBend:function(_19a,xp,yp,wd,tm){this.fullStrokeMoveSub(_19a,xp,yp,wd,tm);this.fullStrokeMoveSub(_19a,xp+0.1,yp+0.1,wd,tm);},fullStrokeMoveToEnd:function(_19b,xp,yp,wd,tm){this.fullStrokeMoveSub(_19b,xp,yp,wd,tm);},fullStrokeEnd:function(_19c,xp,yp,wd,tm){if(_19c.moveCount>0){var ctx=_19c.context;var x1=(_19c.lastX+_19c.llastX)/2;var y1=(_19c.lastY+_19c.llastY)/2;var x2=_19c.lastX;var y2=_19c.lastY;var dlen=_19c.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var x1n=x1;var y1n=y1;if(dd1>0){var px1=dx1*dlen/dd1;var py1=dy1*dlen/dd1;x1n-=px1;y1n-=py1;}ctx.lineTo(x1n,y1n);ctx.stroke();}this.strokeEnd(_19c,xp,yp,wd,tm);},fullDrawEnd:function(_19d){},hasFullDrawMode:function(){return true;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "SchoolPen";}});}if(typeof InkTool.PressSenseFeltPen==="undefined"){InkTool.PressSenseFeltPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseFeltPen;this.col=new InkTool.InkColor("purple");this.w=5;this.minw=3;this.maxw=8;this.oldType=-1;this.transparency=true;this.smoothing=true;this.feltmode=true;this.erasemode=false;this.zoopRatio=1.4;this.loopDivValue=2;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=0;this.alphaSmooth=3;},drawStart:function(_19e){var ctx=_19e.context;if(this.erasemode==true){if(_19e.eraserBgColor!=null){ctx.strokeStyle=_19e.eraserBgColor.getRGBA();ctx.fillStyle=_19e.eraserBgColor.getRGBA();ctx.globalCompositeOperation="source-over";}else{ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="destination-out";}}else{ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";}ctx.lineWidth=_19e.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";_19e.drawMinPenWidth=_19e.widthDataToDraw(this.getPenMinWidth());_19e.drawMaxPenWidth=_19e.widthDataToDraw(this.getPenMaxWidth());_19e.drawScalePenWidth=_19e.drawMaxPenWidth-_19e.drawMinPenWidth;},strokeStart:function(_19f,xp,yp,wd,tm){var ctx=_19f.context;var _1a0=_19f.xpDataToDraw(xp);var _1a1=_19f.ypDataToDraw(yp);var _1a2=_19f.widthDataToDraw(wd);_19f.llastDrawX=_1a0;_19f.llastDrawY=_1a1;_19f.llastDrawW=_1a2;_19f.lastDrawX=_1a0;_19f.lastDrawY=_1a1;_19f.lastDrawW=_1a2;_19f.llastTime=tm;_19f.lastTime=tm;_19f.firstDraw=true;_19f.moveCount=0;_19f.lastRadius=-1;_19f.lastAlpha=-1;_19f.timeStr="";},strokeMove:function(_1a3,xp,yp,wd,tm){_1a3.timeStr="";var _1a4=_1a3.xpDataToDraw(xp);var _1a5=_1a3.ypDataToDraw(yp);var _1a6=_1a3.widthDataToDraw(wd);var dx=(_1a4-_1a3.lastDrawX);var dy=(_1a5-_1a3.lastDrawY);if(dx==0&&dy==0){return;}this.strokeMoveSub(_1a3,_1a4,_1a5,_1a6,tm,false,false);_1a3.llastTime=_1a3.lastTime;_1a3.lastTime=tm;_1a3.llastDrawX=_1a3.lastDrawX;_1a3.llastDrawY=_1a3.lastDrawY;_1a3.llastDrawW=_1a3.lastDrawW;_1a3.lastDrawX=_1a4;_1a3.lastDrawY=_1a5;_1a3.lastDrawW=_1a6;},strokeMoveSub:function(_1a7,xp,yp,wp,tm,_1a8,_1a9){var ctx=_1a7.context;var _1aa=xp;var _1ab=yp;var _1ac=wp;var _1ad=_1a7.moveCount;_1a7.moveCount++;var px1=_1a7.llastDrawX;var py1=_1a7.llastDrawY;var pw1=_1a7.llastDrawW;var px2=_1a7.lastDrawX;var py2=_1a7.lastDrawY;var pw2=_1a7.lastDrawW;var px3=_1aa;var py3=_1ab;var pw3=_1ac;var pxd1=(px2-px1);var pyd1=(py2-py1);var pxd2=(px3-px2);var pyd2=(py3-py2);var d1=Math.sqrt(pxd1*pxd1+pyd1*pyd1)/_1a7.zoomRatio;var d2=Math.sqrt(pxd2*pxd2+pyd2*pyd2)/_1a7.zoomRatio;var _1ae=this.radiusSmooth;var _1af=this.alphaSmooth;var td1=_1a7.lastTime-_1a7.llastTime;var td2=tm-_1a7.lastTime;var _1b0=this.zoopRatio;var _1b1=this.loopDivValue;var x1,y1,w1,x2,y2,w2,x3,y3,w3,dd1,dd2,tdd1,tdd2;x1=(px1+px2)/2;y1=(py1+py2)/2;w1=(pw1+pw2)/2;x2=px2;y2=py2;w2=pw2;x3=(px2+px3)/2;y3=(py2+py3)/2;w3=(pw2+pw3)/2;dd1=d1/2;dd2=d2/2;tdd1=td1/2;tdd2=td2/2;if(tdd1<=0){tdd1=1;}if(tdd2<=0){tdd2=1;}var wave,vave;if(_1a9==true){wave=(w2+w3)/2/_1a7.zoomRatio;vave=dd2/tdd2;}else{if(_1a7.moveCount==1){wave=(w2+w3)/2/_1a7.zoomRatio;vave=dd2/tdd2;}else{wave=(w1+w2*2+w3)/4/_1a7.zoomRatio;vave=(dd1/tdd1+dd2/tdd2)/2;}}var rave=wave/2;var _1b2,_1b3,_1b4;_1b2=4;_1b3=1;_1b4=0.5;var _1b5=Math.round((dd1+dd2)*_1a7.zoomRatio/_1b3);if(_1b5<1){_1b5=1;}var _1b6=Math.round((dd1+dd2)*_1a7.zoomRatio/_1b4);if(_1b6<1){_1b6=1;}var _1b7=(dd1+dd2)/rave*_1b2;var loop=Math.round(_1b7);if(loop<1){loop=1;}var pcol=this.getPenColor();var _1b8;var _1b9,aexp;var tva2=vave;if(tva2<=0){tva2=0.0001;}if(this.feltmode==true){_1b9=1/(tva2*1.6*_1b0);aexp=-0.32;}else{if(this.transparency==true){_1b9=1/(tva2*2.4*_1b0);aexp=-1.2;}else{if(InkTool.InkLib.Browser.MobileSafari){_1b9=0.95;aexp=-3.6;}else{_1b9=1;aexp=-4.8;}}}var beta=1-Math.exp(aexp*rave);if(_1b9<beta){beta=_1b9;}var _1ba=pcol.A*beta;var _1bb;if(_1a8==true){if(this.feltmode==true){_1ba/=2;}_1bb=2;}else{_1bb=_1b2*2*loop/_1b7;}if(loop<=0){}else{if(loop<_1b5){_1bb*=(_1b5/loop);_1ae*=(_1b5/loop);_1af*=(_1b5/loop);loop=_1b5;}else{if(loop>_1b6){_1bb*=(_1b6/loop);_1ae*=(_1b6/loop);_1af*=(_1b6/loop);loop=_1b6;}}}var _1bc=1-Math.pow((255-_1ba)/255,1/_1bb);_1b8=_1bc;if(_1a9==true||_1a7.moveCount==1){var xs,ys,xe,ye,ws,we;if(_1a9==true){xs=x1;ys=y1;ws=w1;xe=x2;ye=y2;we=w2;loop++;}else{xs=x2;ys=y2;ws=w2;xe=x3;ye=y3;we=w3;}var _1bd,_1be;_1bd=_1be=_1a7.lastRadius;var _1bf,_1c0;_1bf=_1c0=_1a7.lastAlpha;for(var idx=0;idx<loop;idx++){var dt=idx/loop;var dx=xs+(xe-xs)*dt;var dy=ys+(ye-ys)*dt;var dw=ws+(we-ws)*dt;if(_1c0<0||_1af==0){_1bf=_1b8;}else{_1bf=(_1c0*(_1af-1)+_1b8)/_1af;}if(this.erasemode==false){var fcol="rgba("+pcol.R+","+pcol.G+","+pcol.B+","+_1bf.toFixed(5)+")";ctx.fillStyle=fcol;}_1c0=_1bf;ctx.beginPath();var _1c1=dw/2;if(_1be<0||_1ae==0){_1bd=_1c1;}else{_1bd=(_1be*(_1ae-1)+_1c1)/_1ae;}ctx.arc(dx,dy,_1bd,0,Math.PI*2,false);ctx.fill();_1be=_1bd;}_1a7.lastRadius=_1bd;_1a7.lastAlpha=_1bf;}else{var ddd1=dd1;var ddd2=dd2;if(ddd1<ddd2/6.6){ddd1=ddd2/6.6;}else{if(ddd2<ddd1/6.6){ddd2=ddd1/6.6;}}var _1c2=loop*ddd2+((loop-1)*(ddd1-ddd2))/2;var _1c3=0;var _1bd,_1be;_1bd=_1be=_1a7.lastRadius;var _1bf,_1c0;_1bf=_1c0=_1a7.lastAlpha;for(var idx=0;idx<loop;idx++){var dt;if(_1c2==0){dt=idx/loop;}else{dt=_1c3/_1c2;}var dx=x1*(1-dt)*(1-dt)+x2*2*dt*(1-dt)+x3*dt*dt;var dy=y1*(1-dt)*(1-dt)+y2*2*dt*(1-dt)+y3*dt*dt;var dw=w1*(1-dt)*(1-dt)+w2*2*dt*(1-dt)+w3*dt*dt;if(_1c0<0||_1af==0){_1bf=_1b8;}else{_1bf=(_1c0*(_1af-1)+_1b8)/_1af;}if(this.erasemode==false){var fcol="rgba("+pcol.R+","+pcol.G+","+pcol.B+","+_1bf.toFixed(5)+")";ctx.fillStyle=fcol;}_1c0=_1bf;ctx.beginPath();var _1c1=dw/2;if(_1be<0||_1ae==0){_1bd=_1c1;}else{_1bd=(_1be*(_1ae-1)+_1c1)/_1ae;}ctx.arc(dx,dy,_1bd,0,Math.PI*2,false);ctx.fill();_1be=_1bd;_1c3+=(ddd2+idx*(ddd1-ddd2)/loop);}_1a7.lastRadius=_1bd;_1a7.lastAlpha=_1bf;}},strokeEnd:function(_1c4,xp,yp,wd,tm){_1c4.timeStr="";var ctx=_1c4.context;if(tm<=_1c4.lastTime+8){tm=_1c4.lastTime+8;}var _1c5=_1c4.xpDataToDraw(xp);var _1c6=_1c4.ypDataToDraw(yp);var _1c7=_1c4.widthDataToDraw(wd);var dx=(_1c5-_1c4.lastDrawX);var dy=(_1c6-_1c4.lastDrawY);var vlx,vly,vlw,_1c8;if(_1c4.moveCount<=1){_1c8=true;if(_1c4.moveCount==0){this.strokeMoveSub(_1c4,_1c4.lastDrawX,_1c4.lastDrawY,_1c4.lastDrawW,_1c4.lastTime,_1c8,false);vlx=_1c4.lastDrawX;vly=_1c4.lastDrawY;vlw=_1c4.lastDrawW;this.strokeMoveSub(_1c4,vlx,vly,vlw,tm,_1c8,false);}else{vlx=_1c4.lastDrawX;vly=_1c4.lastDrawY;vlw=_1c4.lastDrawW;this.strokeMoveSub(_1c4,vlx,vly,vlw,tm,_1c8,false);}}else{_1c8=false;vlx=_1c4.lastDrawX;vly=_1c4.lastDrawY;vlw=_1c4.lastDrawW;}this.strokeMoveSub(_1c4,vlx,vly,vlw,tm,_1c8,true);},drawEnd:function(_1c9){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseFeltPen";}});}if(typeof InkTool.PressSenseBallpointPen==="undefined"){InkTool.PressSenseBallpointPen=InkTool.InkLib.Class.create(InkTool.PressSenseFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseBallpointPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.transparency=false;this.smoothing=true;this.feltmode=false;this.erasemode=false;this.zoopRatio=1.4;this.loopDivValue=24;this.valSmooth=4;this.acsSmooth=3;this.radiusSmooth=0;this.alphaSmooth=0;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseBallpointPen";}});}if(typeof InkTool.PressSenseSignPen==="undefined"){InkTool.PressSenseSignPen=InkTool.InkLib.Class.create(InkTool.PressSenseFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseSignPen;this.col=new InkTool.InkColor("black");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.transparency=true;this.smoothing=true;this.feltmode=false;this.erasemode=false;this.zoopRatio=1;this.loopDivValue=24;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=0;this.alphaSmooth=12;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseSignPen";}});}if(typeof InkTool.PressSenseSchoolPen==="undefined"){InkTool.PressSenseSchoolPen=InkTool.InkLib.Class.create(InkTool.PressSenseFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseSchoolPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.transparency=false;this.smoothing=true;this.feltmode=false;this.erasemode=false;this.zoopRatio=1.4;this.loopDivValue=24;this.valSmooth=4;this.acsSmooth=3;this.radiusSmooth=0;this.alphaSmooth=0;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseSchoolPen";}});}if(typeof InkTool.AutoSwitchoverPen==="undefined"){InkTool.AutoSwitchoverPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.None;this.col=new InkTool.InkColor("black");this.w=2;this.minw=1;this.maxw=5;this.oldType=-1;this.activeXPen=null;this.html5Pen=null;},setPenColor:function(_1ca){this.col=_1ca;if(this.activeXPen!=null){this.activeXPen.setPenColor(_1ca);}if(this.html5Pen!=null){this.html5Pen.setPenColor(_1ca);}},setPenWidth:function(_1cb){this.w=_1cb;if(this.activeXPen!=null){this.activeXPen.setPenWidth(_1cb);}if(this.html5Pen!=null){this.html5Pen.setPenWidth(_1cb);}},setPenMinWidth:function(_1cc){this.minw=_1cc;if(this.activeXPen!=null){this.activeXPen.setPenMinWidth(_1cc);}if(this.html5Pen!=null){this.html5Pen.setPenMinWidth(_1cc);}},setPenMaxWidth:function(_1cd){this.maxw=_1cd;if(this.activeXPen!=null){this.activeXPen.setPenMaxWidth(_1cd);}if(this.html5Pen!=null){this.html5Pen.setPenMaxWidth(_1cd);}},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return true;},getSubInfo:function(){return "AutoSwitchoverPen";}});}if(typeof InkTool.BallpointPen==="undefined"){InkTool.BallpointPen=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchBallpointPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.activeXPen=new InkTool.PressSenseBallpointPen();this.html5Pen=new InkTool.SpeedSenseBallpointPen();},getSubInfo:function(){return "BallpointPen";}});}if(typeof InkTool.FeltPen==="undefined"){InkTool.FeltPen=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchFeltPen;this.col=new InkTool.InkColor("purple");this.w=5;this.minw=3;this.maxw=8;this.oldType=-1;this.activeXPen=new InkTool.PressSenseFeltPen();this.html5Pen=new InkTool.SpeedSenseFeltPen();},getSubInfo:function(){return "FeltPen";}});}if(typeof InkTool.SignPen==="undefined"){InkTool.SignPen=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchSignPen;this.col=new InkTool.InkColor("black");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.activeXPen=new InkTool.PressSenseSignPen();this.html5Pen=new InkTool.SpeedSenseSignPen();},getSubInfo:function(){return "SignPen";}});}if(typeof InkTool.SchoolPen==="undefined"){InkTool.SchoolPen=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchSchoolPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.activeXPen=new InkTool.PressSenseSchoolPen();this.html5Pen=new InkTool.SpeedSenseSchoolPen();},getSubInfo:function(){return "SchoolPen";}});}if(typeof InkTool.InkFeltPenV100==="undefined"){InkTool.InkFeltPenV100=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.FeltPenV100;this.col=new InkTool.InkColor("purple");this.w=5;this.minw=3;this.maxw=8;this.oldType=InkTool.InkPenType.Old_FeltPenV100;},drawStart:function(_1ce){var ctx=_1ce.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_1ce.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";_1ce.drawMinPenWidth=_1ce.widthDataToDraw(this.getPenMinWidth());_1ce.drawMaxPenWidth=_1ce.widthDataToDraw(this.getPenMaxWidth());_1ce.drawScalePenWidth=_1ce.drawMaxPenWidth-_1ce.drawMinPenWidth;},strokeStart:function(_1cf,xp,yp,wd,tm){var ctx=_1cf.context;var _1d0=_1cf.xpDataToDraw(xp);var _1d1=_1cf.ypDataToDraw(yp);_1cf.llastX=_1cf.lastX=_1d0;_1cf.llastY=_1cf.lastY=_1d1;_1cf.lastTime=tm;_1cf.lastTimeSlice=8;_1cf.firstDraw=true;_1cf.moveCount=0;_1cf.moveSum=0;_1cf.lastData=[];_1cf.timeStr="";},strokeMove:function(_1d2,xp,yp,wd,tm){_1d2.timeStr="";if(tm<=_1d2.lastTime){_1d2.queuePoints.push({"x":xp,"y":yp});return;}var _1d3=(tm-_1d2.lastTime)/(_1d2.queuePoints.length+1);while(_1d2.queuePoints.length>0){var _1d4=_1d2.queuePoints.shift();this.strokeMoveSub(_1d2,_1d4.x,_1d4.y,_1d3);}this.strokeMoveSub(_1d2,xp,yp,_1d3);_1d2.lastTime=tm;},strokeMoveSub:function(_1d5,xp,yp,_1d6){var ctx=_1d5.context;var _1d7=_1d5.xpDataToDraw(xp);var _1d8=_1d5.ypDataToDraw(yp);var _1d9=_1d5.drawMinPenWidth;var _1da=_1d5.drawScalePenWidth;_1d5.moveCount++;_1d5.timeStr=_1d5.timeStr+","+_1d6;var _1db;if(_1d5.moveCount==1){var t2=_1d6;var px2=_1d5.lastX;var py2=_1d5.lastY;var px3=_1d7;var py3=_1d8;var d2=Math.sqrt(px2*px2-2*px2*px3+px3*px3+py2*py2-2*py2*py3+py3*py3);var v2=d2/t2;_1d5.lastV1=_1d5.lastV2=_1d5.lastV3=_1d5.lastV4=_1d5.lastV5=v2;_1db=v2;_1d5.moveSum+=d2;}else{var t1=_1d5.lastTimeSlice;var t2=_1d6;var px1=_1d5.llastX;var py1=_1d5.llastY;var px2=_1d5.lastX;var py2=_1d5.lastY;var px3=_1d7;var py3=_1d8;var d1=Math.sqrt(px1*px1-2*px1*px2+px2*px2+py1*py1-2*py1*py2+py2*py2);var d2=Math.sqrt(px2*px2-2*px2*px3+px3*px3+py2*py2-2*py2*py3+py3*py3);var vc1=d1/t1/_1d5.zoomRatio;var vc3=d2/t2/_1d5.zoomRatio;var v1=(_1d5.lastV3+_1d5.lastV4+vc1)/3;var v3=(_1d5.lastV4+_1d5.lastV5+vc3)/3;_1d5.moveSum+=d2;var _1dc=_1d5.moveSum+_1d5.moveCount;if(_1dc<10){_1da=_1da*_1dc/10;}var x1=(_1d5.lastX+_1d5.llastX)/2;var y1=(_1d5.lastY+_1d5.llastY)/2;var x2=_1d5.lastX;var y2=_1d5.lastY;var x3=(_1d5.lastX+_1d7)/2;var y3=(_1d5.lastY+_1d8)/2;var v2=(v1+v3)/2;var rave=_1d9+_1da*Math.exp(-1.5*v2);var loop=Math.round((d1+d2)/rave*10);if(loop<10){loop=10;}var zoop=Math.round((d1+d2)/(6.2*_1d5.zoomRatio)*10);if(zoop<10){zoop=10;}zoop/=2;var pcol=this.getPenColor();var _1dd=pcol.A/255/zoop;var fcol="rgba("+pcol.R+","+pcol.G+","+pcol.B+","+_1dd.toFixed(5)+")";ctx.fillStyle=fcol;var _1de=false;var dxl=0;var dyl=0;for(var idx=0;idx<loop;idx++){var dt=idx/loop;var dx=x3*(1-dt)*(1-dt)+x2*2*dt*(1-dt)+x1*dt*dt;var dy=y3*(1-dt)*(1-dt)+y2*2*dt*(1-dt)+y1*dt*dt;var dv=v3*(1-dt)*(1-dt)+v2*2*dt*(1-dt)+v1*dt*dt;ctx.beginPath();ctx.arc(dx,dy,_1d9+_1da*Math.exp(-1.5*dv),0,Math.PI*2,false);ctx.fill();_1de=true;dxl=dx;dyl=dy;}_1db=v2;}_1d5.llastX=_1d5.lastX;_1d5.llastY=_1d5.lastY;_1d5.lastX=_1d7;_1d5.lastY=_1d8;_1d5.lastV1=_1d5.lastV2;_1d5.lastV2=_1d5.lastV3;_1d5.lastV3=_1d5.lastV4;_1d5.lastV4=_1d5.lastV5;_1d5.lastV5=_1db;},strokeEnd:function(_1df,xp,yp,wd,tm){_1df.timeStr="";var ctx=_1df.context;if(tm<=_1df.lastTime){tm=_1df.lastTime+8;}if(_1df.queuePoints.length==0){return;}var _1e0=(tm-_1df.lastTime)/_1df.queuePoints.length;while(_1df.queuePoints.length>0){var _1e1=_1df.queuePoints.shift();this.strokeMoveSub(_1df,_1e1.x,_1e1.y,_1e0);}},drawEnd:function(_1e2){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "FeltPenV100";}});}if(typeof InkTool.InkPencil==="undefined"){InkTool.InkPencil=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){if(InkTool.InkLib.needsEmulateCanvas()){this.tp=InkTool.InkPenType.PencilEmulated;}else{this.tp=InkTool.InkPenType.PencilEmulated;}this.col=new InkTool.InkColor("#FF4A4C4B");this.w=1.8;this.minw=0.2;this.maxw=2;this.oldType=InkTool.InkPenType.Old_PencilEmulated;},drawStart:function(_1e3){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.drawStart.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.drawStart.apply(this,arguments);}},strokeStart:function(_1e4,xp,yp,wd,tm){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.strokeStart.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.strokeStart.apply(this,arguments);}},strokeMove:function(_1e5,xp,yp,wd,tm){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.strokeMove.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.strokeMove.apply(this,arguments);}},strokeMoveSub:function(_1e6,xp,yp,_1e7){InkTool.InkFeltPen.prototype.strokeMoveSub.apply(this,arguments);},strokeEnd:function(_1e8,xp,yp,wd,tm){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.strokeEnd.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.strokeEnd.apply(this,arguments);}},drawEnd:function(_1e9){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.drawEnd.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.drawEnd.apply(this,arguments);}},fullDrawStart:function(_1ea){InkTool.InkBallpointPen.prototype.fullDrawStart.apply(this,arguments);},fullStrokeStart:function(_1eb,xp,yp,wd,tm){InkTool.InkBallpointPen.prototype.fullStrokeStart.apply(this,arguments);},fullStrokeMove:function(_1ec,xp,yp,wd,tm){InkTool.InkBallpointPen.prototype.fullStrokeMove.apply(this,arguments);},fullStrokeEnd:function(_1ed,xp,yp,wd,tm){InkTool.InkBallpointPen.prototype.fullStrokeEnd.apply(this,arguments);},fullDrawEnd:function(_1ee){InkTool.InkBallpointPen.prototype.fullDrawEnd.apply(this,arguments);},hasFullDrawMode:function(){return (this.tp==InkTool.InkPenType.PencilEmulated);},isSpeedSensitive:function(){return (this.tp!=InkTool.InkPenType.PencilEmulated);},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "Pencil";}});}if(typeof InkTool.InkNormalEraser==="undefined"){InkTool.InkNormalEraser=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.SolidEraser;this.col=new InkTool.InkColor("black");this.w=12;this.minw=8;this.maxw=16;this.oldType=InkTool.InkPenType.Old_NormalEraser;},drawStart:function(_1ef){var ctx=_1ef.context;if(_1ef.eraserBgColor!=null){ctx.strokeStyle=_1ef.eraserBgColor.getRGBA();ctx.fillStyle=_1ef.eraserBgColor.getRGBA();ctx.globalCompositeOperation="source-over";}else{ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="destination-out";}ctx.lineWidth=_1ef.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";},strokeStart:function(_1f0,xp,yp,wd,tm){var ctx=_1f0.context;var _1f1=_1f0.xpDataToDraw(xp);var _1f2=_1f0.ypDataToDraw(yp);_1f0.lastData=[];_1f0.llastX=_1f0.lastX=_1f1;_1f0.llastY=_1f0.lastY=_1f2;},strokeMove:function(_1f3,xp,yp,wd,tm){var ctx=_1f3.context;var _1f4=_1f3.xpDataToDraw(xp);var _1f5=_1f3.ypDataToDraw(yp);var x1=(_1f3.lastX+_1f3.llastX)/2;var y1=(_1f3.lastY+_1f3.llastY)/2;var x2=_1f3.lastX;var y2=_1f3.lastY;var x3=(_1f3.lastX+_1f4)/2;var y3=(_1f3.lastY+_1f5)/2;ctx.beginPath();ctx.moveTo(x1,y1);ctx.quadraticCurveTo(x2,y2,x3,y3);if(InkTool.InkLib.Browser.Chrome){ctx.lineTo(x3+0.1,y3+0.1);}ctx.stroke();_1f3.llastX=_1f3.lastX;_1f3.llastY=_1f3.lastY;_1f3.lastX=_1f4;_1f3.lastY=_1f5;},strokeEnd:function(_1f6,xp,yp,wd,tm){var ctx=_1f6.context;var _1f7=_1f6.xpDataToDraw(xp);var _1f8=_1f6.ypDataToDraw(yp);var x1=(_1f6.lastX+_1f6.llastX)/2;var y1=(_1f6.lastY+_1f6.llastY)/2;var x2=_1f6.lastX;var y2=_1f6.lastY;var x3=_1f7;var y3=_1f8;ctx.beginPath();ctx.moveTo(x1,y1);ctx.quadraticCurveTo(x2,y2,x3,y3);if(InkTool.InkLib.Browser.Chrome||(x2==x3&&y2==y3)){ctx.lineTo(x3+0.1,y3+0.1);}ctx.stroke();_1f6.llastX=_1f6.lastX;_1f6.llastY=_1f6.lastY;_1f6.lastX=_1f7;_1f6.lastY=_1f8;},drawEnd:function(_1f9){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "NormalEraser";}});}if(typeof InkTool.SolidEraser==="undefined"){InkTool.SolidEraser=InkTool.InkLib.Class.create(InkTool.InkNormalEraser,{getSubInfo:function(){return "SolidEraser";}});}if(typeof InkTool.PressSenseNormalEraser==="undefined"){InkTool.PressSenseNormalEraser=InkTool.InkLib.Class.create(InkTool.PressSenseFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseNormalEraser;this.col=new InkTool.InkColor("black");this.w=12;this.minw=8;this.maxw=16;this.oldType=-1;this.transparency=false;this.smoothing=true;this.feltmode=false;this.erasemode=true;this.zoopRatio=1;this.loopDivValue=24;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=0;this.alphaSmooth=0;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseNormalEraser";}});}if(typeof InkTool.Eraser==="undefined"){InkTool.Eraser=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchEraser;this.col=new InkTool.InkColor("black");this.w=12;this.minw=8;this.maxw=16;this.oldType=-1;this.activeXPen=new InkTool.PressSenseNormalEraser();this.html5Pen=new InkTool.SolidEraser();},getSubInfo:function(){return "Eraser";}});}if(typeof InkTool.InkCell==="undefined"){InkTool.InkCell=InkTool.InkLib.Class.create(null,{initialize:function(_1,xp,yp,_2,_3,_4){this.m=_1;this.x=xp;this.y=yp;this.w=_2;this.p=_3;this.t=_4;},getMode:function(){return this.m;},getX:function(){return this.x;},getY:function(){return this.y;},getWidth:function(){return this.w;},getPressure:function(){return this.p;},getTime:function(){return this.t;}});}if(typeof InkTool.InkStroke==="undefined"){InkTool.InkStroke=InkTool.InkLib.Class.create(null,{initialize:function(_5){this.cs=new Array();this.st=_5.clone();},getStationery:function(){return this.st;},getColor:function(){return this.st.PenColor;},getPenType:function(){return this.st.PenType;},countCells:function(){return this.cs.length;},addCell:function(_6){this.cs.push(_6);},getCell:function(_7){if(_7<0||_7>=this.cs.length){return null;}else{return this.cs[_7];}},countFeatureCells:function(_8){var _9=0;if(_8===undefined||_8==null){for(var _a=0;_a<this.cs.length;_a++){if(this.cs[_a].m>=0){_9++;}}}else{for(var _a=0;_a<this.cs.length;_a++){if(this.cs[_a].m==_8){_9++;}}}return _9;}});}if(typeof InkTool.InkDrawing==="undefined"){InkTool.InkDrawing=InkTool.InkLib.Class.create(null,{initialize:function(){this.is=new Array();},countDrawItems:function(){return this.is.length;},addDrawItem:function(_b){this.is.push(_b);return true;},getDrawItem:function(_c){if(_c<0||_c>=this.is.length){return null;}else{return this.is[_c];}},deleteDrawItem:function(_d){this.is.splice(_d,1);return true;},clearDrawItems:function(){this.is.length=0;},countCells:function(){var _e=0;for(var _f=0;_f<this.is.length;_f++){_e+=this.is[_f].countCells();}return _e;},countFeatureCells:function(_10){var _11=0;for(var idx=0;idx<this.is.length;idx++){_11+=this.is[idx].countFeatureCells(_10);}return _11;}});}if(typeof InkTool.InkDrawn==="undefined"){InkTool.InkDrawn=InkTool.InkLib.Class.create(InkTool.InkDrawing,{initialize:function(){this.is=new Array();}});}if(typeof InkTool.InkLayer==="undefined"){InkTool.InkLayer=InkTool.InkLib.Class.create(null,{initialize:function(id,_12){this.Drawing=new InkTool.InkDrawing();this.Drawn=new InkTool.InkDrawn();this.ID=id;this.Zorder=_12;}});}if(typeof InkTool.InkPage==="undefined"){InkTool.InkPage=InkTool.InkLib.Class.create(null,{initialize:function(){this.layerList=new Array();this.layerList.push(new InkTool.InkLayer(1,100));this.currentLayerId=1;this.currentLayer=this.getLayerById(1);},countLayers:function(){return this.layerList.length;},getLayerList:function(){var _13=[];var _14=this.layerList.length;for(var _15=0;_15<_14;_15++){var _16=this.layerList[_15];_13.push({index:_15,id:_16.ID,zorder:_16.Zorder});}_13.sort(function(_17,_18){return (_18.zorder-_17.zorder);});return _13;},addLayer:function(id,_19){this.layerList.push(new InkTool.InkLayer(id,_19));return true;},getCurrentLayer:function(){return this.currentLayer;},getLayerById:function(id){var _1a=this.layerList.length;for(var _1b=0;_1b<_1a;_1b++){var _1c=this.layerList[_1b];if(_1c.ID==id){return _1c;}}return null;},getLayerByIndex:function(_1d){return this.layerList[_1d];},deleteLayerById:function(id){var _1e=this.layerList.length;for(var _1f=0;_1f<_1e;_1f++){var _20=this.layerList[_1f];if(_20.ID==id){this.layerList.splice(_1f,1);return true;}}return false;},getLayerByIndex:function(_21){this.layerList.splice(_21,1);return true;},clearLayers:function(){this.layerList.length=0;return true;}});}if(typeof InkTool.InkNote==="undefined"){InkTool.InkNote=InkTool.InkLib.Class.create(null,{initialize:function(){this.pageList=new Array();this.pageList.push(new InkTool.InkPage());},countPages:function(){return this.pageList.length;},addPage:function(){this.pageList.push(new InkTool.InkPage());return true;},addPages:function(num){for(var ct=0;ct<num;ct++){this.pageList.push(new InkTool.InkPage());}return true;},getPage:function(_22){return this.pageList[_22];},deletePage:function(_23){this.pageList.splice(_23,1);return true;},clearPages:function(){this.pageList.length=0;return true;}});}if(typeof InkTool.InkTabletInfo==="undefined"){InkTool.InkTabletInfo=InkTool.InkLib.Class.create(null,{initialize:function(){}});}if(typeof InkTool.InkData==="undefined"){InkTool.InkData=InkTool.InkLib.Class.create(null,{initialize:function(){this.TabletInfo=new InkTool.InkTabletInfo();this.Note=new InkTool.InkNote();}});}if(typeof InkTool.InkRect==="undefined"){InkTool.InkRect=InkTool.InkLib.Class.create(null,{initialize:function(_1,_2,_3,_4){this.left=_1;this.top=_2;this.width=_3;this.height=_4;},clearRect:function(){this.left=0;this.top=0;this.width=0;this.height=0;},getLeft:function(){return this.left;},getTop:function(){return this.top;},getWidth:function(){return this.width;},getHeight:function(){return this.height;},getRight:function(){return this.left+this.width;},getBottom:function(){return this.top+this.height;},equalsRect:function(_5){return (this.left==_5.left&&this.top==_5.top&&this.width==_5.width&&this.height==_5.height);},copyRect:function(_6){this.left=_6.left;this.top=_6.top;this.width=_6.width;this.height=_6.height;},cloneRect:function(){return new InkTool.InkRect(this.left,this.top,this.width,this.height);},isEmpty:function(){return (this.width==0||this.height==0);},containsPoint:function(_7,_8){return (_7>=this.left&&_7<this.getRight()&&_8>=this.top&&_8<this.getBottom());},containsPosition:function(_9){return (_9.left>=this.left&&_9.left<this.getRight()&&_9.top>=this.top&&_9.top<this.getBottom());},containsRect:function(_a){return (this.left<=_a.left&&this.top<=_a.top&&this.getRight()>=_a.getRight()&&this.getBottom()>=_a.getBottom());},intersectsRect:function(_b){var _c=(this.left>=_b.left)?this.left:_b.left;var _d=(this.getRight()<=_b.getRight())?this.getRight:_b.getRight();var _e=(this.top>=_b.top)?this.top:_b.top;var _f=(this.getBottom()<=_b.getBottom())?this.getBottom:_b.getBottom();return (_c<_d&&_e<_f);},andRect:function(_10){var _11=(this.left>=_10.left)?this.left:_10.left;var _12=(this.getRight()<=_10.getRight())?this.getRight:_10.getRight();if(_12<_11){_12=_11;}var _13=(this.top>=_10.top)?this.top:_10.top;var _14=(this.getBottom()<=_10.getBottom())?this.getBottom:_10.getBottom();if(_14<_13){_14=_13;}return new InkTool.InkRect(_11,_13,(_12-_11),(_14-_13));},orRect:function(_15){var _16=(this.left<=_15.left)?this.left:_15.left;var _17=(this.getRight()>=_15.getRight())?this.getRight:_15.getRight();var _18=(this.top<=_15.top)?this.top:_15.top;var _19=(this.getBottom()>=_15.getBottom())?this.getBottom:_15.getBottom();return new InkTool.InkRect(_16,_18,(_17-_16),(_19-_18));},margeRect:function(_1a){if(this.isEmpty()){return _1a.cloneRect();}else{if(_1a.isEmpty()){return this.cloneRect();}else{return this.orRect(_1a);}}},Dummy:null});}if(typeof InkTool.Base64Lib==="undefined"){InkTool.Base64Lib={encodeBase64Letter:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeBase64Letter:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],encodeBase64:function(_1b){var _1c,i,_1d;var _1e,_1f,_20;var _21=InkTool.Base64Lib;_1d=_1b.length;i=0;_1c="";while(i<_1d){_1e=_1b.charCodeAt(i++)&255;if(i==_1d){_1c+=_21.encodeBase64Letter.charAt(_1e>>2);_1c+=_21.encodeBase64Letter.charAt((_1e&3)<<4);_1c+="==";break;}_1f=_1b.charCodeAt(i++);if(i==_1d){_1c+=_21.encodeBase64Letter.charAt(_1e>>2);_1c+=_21.encodeBase64Letter.charAt(((_1e&3)<<4)|((_1f&240)>>4));_1c+=_21.encodeBase64Letter.charAt((_1f&15)<<2);_1c+="=";break;}_20=_1b.charCodeAt(i++);_1c+=_21.encodeBase64Letter.charAt(_1e>>2);_1c+=_21.encodeBase64Letter.charAt(((_1e&3)<<4)|((_1f&240)>>4));_1c+=_21.encodeBase64Letter.charAt(((_1f&15)<<2)|((_20&192)>>6));_1c+=_21.encodeBase64Letter.charAt(_20&63);}return _1c;},decodeBase64:function(_22){var _23,_24,_25,_26;var i,_27,_28;var _29=InkTool.Base64Lib;_27=_22.length;i=0;_28="";while(i<_27){do{_23=_29.decodeBase64Letter[_22.charCodeAt(i++)&255];}while(i<_27&&_23==-1);if(_23==-1){break;}do{_24=_29.decodeBase64Letter[_22.charCodeAt(i++)&255];}while(i<_27&&_24==-1);if(_24==-1){break;}_28+=String.fromCharCode((_23<<2)|((_24&48)>>4));do{_25=_22.charCodeAt(i++)&255;if(_25==61){return _28;}_25=_29.decodeBase64Letter[_25];}while(i<_27&&_25==-1);if(_25==-1){break;}_28+=String.fromCharCode(((_24&15)<<4)|((_25&60)>>2));do{_26=_22.charCodeAt(i++)&255;if(_26==61){return _28;}_26=_29.decodeBase64Letter[_26];}while(i<_27&&_26==-1);if(_26==-1){break;}_28+=String.fromCharCode(((_25&3)<<6)|_26);}return _28;},byteArrayToBase64:function(_2a){var _2b=InkTool.Base64Lib.encodeBase64Letter;if(_2a==null){return "====";}var _2c="";var ch=0;for(var idx=0;idx<_2a.length;idx++){switch(idx%3){case 0:_2c+=_2b.charAt((_2a[idx]>>2)&63);ch=(_2a[idx]&3)<<4;break;case 1:_2c+=_2b.charAt(ch|((_2a[idx]>>4)&15));ch=(_2a[idx]&15)<<2;break;case 2:_2c+=_2b.charAt(ch|((_2a[idx]>>6)&15));_2c+=_2b.charAt(_2a[idx]&63);ch=0;break;}}if(_2a.length%3==1){_2c+=_2b.charAt(ch);_2c+="==";}else{if(_2a.length%3==2){_2c+=_2b.charAt(ch);_2c+="=";}}return _2c;},Dummy:null};}if(typeof InkTool.SessionKeyLib==="undefined"){InkTool.SessionKeyLib={createSessionKey:function(_2d,_2e,_2f,_30){var _31=InkTool.InkLib.stringToUtf8Bytes(_2d);var _32=InkTool.SessionKeyLib.createRandHashByByteArray(_31,_2e,_2f,_30);return InkTool.Base64Lib.byteArrayToBase64(_32);},createRandHashByByteArray:function(_33,_34,_35,_36){var _37=[];for(var _38=0;_38<_35;_38++){_37.push(0);}for(var _39=0;_39<_33.length;_39++){var val=(_33[_39]&255);for(var _38=0;_38<_35;_38++){val=((val*_36)+_39)%_34.length;var rnd=_34[val];_37[_38]^=rnd;_37[_38]&=255;}}return _37;},Dummy:null};}if(typeof InkTool.InkDocTracePacket==="undefined"){InkTool.InkDocTracePacket=InkTool.InkLib.Class.create(null,{initialize:function(_1,_2,_3,id){this.etype=_1;this.serialNo=_2;this.touchIndex=_3;this.id=id;this.llastPos=null;this.llastTime=null;this.llastEvent=null;this.lastPos=null;this.lastTime=null;this.lastEvent=null;this.DocIsDrawing=false;this.crntMode=-1;this.List={};},setPosition:function(_4){this.llastPos=this.lastPos;this.llastTime=this.lastTime;var _5=new Date();this.lastPos=_4;this.lastTime=_5;},setPositionAndTime:function(_6,_7){this.llastPos=this.lastPos;this.llastTime=this.lastTime;this.lastPos=_6;this.lastTime=_7;},setEvent:function(_8){this.llastEvent=this.lastEvent;this.lastEvent=_8;},setPositionAndEvent:function(_9,_a){this.llastPos=this.lastPos;this.llastTime=this.lastTime;var _b=new Date();this.lastPos=_9;this.lastTime=_b;this.llastEvent=this.lastEvent;this.lastEvent=_a;},setPositionTimeAndEvent:function(_c,_d,_e){this.llastPos=this.lastPos;this.llastTime=this.lastTime;this.lastPos=_c;this.lastTime=_d;this.llastEvent=this.lastEvent;this.lastEvent=_e;},getPosision:function(){return this.lastPos;},getLastTime:function(){if(this.lastTime==null){return 0;}return this.lastTime.getTime();},getLastTimeInterval:function(){if(this.llastTime==null||this.lastTime==null){return 0;}return (this.lastTime.getTime()-this.llastTime.getTime());},getLastPosDistance:function(){if(this.llastPos==null||this.lastPos==null){return 0;}var dx=this.lastPos.left-this.llastPos.left;var dy=this.lastPos.top-this.llastPos.top;return Math.sqrt(dx*dx+dy*dy);},dummy:function(){}});}if(typeof InkTool.InkCanvasLib==="undefined"){InkTool.InkCanvasLib={Version:"2.04",CanvasClasses:{},List:{},Initialized:false,PreventDragAndSelect:true,DebugLevel:0,AnalyzeLevel:0,AnalyzeDebugInfo:1,Combinable:true,TimerDraw:null,TimerCopy:null,InkData:null,DummyDiv:null,DummyCanvas:null,SerialNo:0,MultiTouchMax:5,PenTrace:null,TouchTraceList:[],PointerTraceList:[],FeatureDetectingBendDist:0.75,FeatureDetectingStraightDist:32,FeatureDetectingTimeDist:25,FeatureDetectingSharpDist:1.05,DocLLastPenDownPos:{"left":-10000,"top":-10000},DocLLastPenUpTime:0,DocLastPenDownPos:{"left":-10000,"top":-10000},DocLastPenUpTime:0,DocLastPenDownIgnored:0,DocLastDevice:"unknown",DocPenEnterLimitDistance:64,HotSpotHappening:false,PauseLib:false,TotalDrawingTime:0,TotalDrawingCells:0,TotalCopyCount:0,TotalPenDownTime:0,TotalPenMoveTime:0,TotalPenUpTime:0,MouseDownInfo:"",MouseMoveInfo:"",MouseUpInfo:"",MouseInfoCallback:null,MouseDownNum:0,MouseMoveNum:0,MouseUpNum:0,TouchDownInfo:"",TouchMoveInfo:"",TouchUpInfo:"",TouchInfoCallback:null,GestureDownInfo:"",GestureMoveInfo:"",GestureUpInfo:"",GestureInfoCallback:null,MSPointerDownInfo:"",MSPointerMoveInfo:"",MSPointerUpInfo:"",MSPointerInfoCallback:null,PointerEnableTouch:true,PointerEnablePen:true,PointerEnableMouse:true,PointerEnableUnknown:true,PointerEnableAll:true,TraceInfo:"",TraceDistMax:0,TraceDistMaxInterval:0,TraceValMax:0,TraceValMaxDist:0,TraceValMaxInterval:0,TraceIntervalMax:0,TraceIntervalMin:10000,TraceInfoCallback:null,ActiveXList:[],ActiveXType:"",ActiveXGuid:"",ActiveXInit:"auto",ActiveXSignPad:null,ActiveXExists:0,DeviceWintabFitControlSize:false,DeviceWintabFitControlSizeParams:{ControlMargin:{Left:0,Top:0,Right:0,Bottom:0},KeepAspectRatio:false,EmbedTabletInControl:false,Alignment:{Horizontal:0,Vertical:0}},DeviceMsinkIgnoreTabletQuery:true,DeviceMsinkDefSupportStatus:true,DeviceMsinkDefSupportPressure:true,DeviceMsinkFailSupportStatus:true,DeviceMsinkFailSupportPressure:true,DeviceMsinkDefMinPressure:0,DeviceMsinkDefMaxPressure:1024,DeviceSignPadFitControlSizeParams:{ControlMargin:{Left:0,Top:0,Right:0,Bottom:0},KeepAspectRatio:false,EmbedTabletInControl:true,Alignment:{Horizontal:0,Vertical:0}},DeviceSignPadBackImageURL:null,initialize:function(){var _f=InkTool.InkLib;var _10=InkTool.InkCanvasLib;if(_10.Initialized){return;}_10.Initialized=true;_10.InkData=new InkTool.InkData();if(_10.PreventDragAndSelect){document.ondragstart=function(){return false;};document.onselectstart=function(){return false;};document.body.style.userSelect="none";document.body.style.MozUserSelect="none";document.body.style.webkitUserSelect="none";document.body.style.msUserSelect="none";document.body.style.msTouchAction="none";document.body.style.touchAction="none";}_10.setupTracePacket(_10.MultiTouchMax);if(window.navigator.pointerEnabled){_f.addEvent(null,"pointerdown",_10.docMSPointerDown);_f.addEvent(null,"pointermove",_10.docMSPointerMove);_f.addEvent(null,"pointerup",_10.docMSPointerUp);}else{if(window.navigator.msPointerEnabled){_f.addEvent(null,"MSPointerDown",_10.docMSPointerDown);_f.addEvent(null,"MSPointerMove",_10.docMSPointerMove);_f.addEvent(null,"MSPointerUp",_10.docMSPointerUp);}else{_f.addEvent(null,"mousedown",_10.docPenDown);_f.addEvent(null,"mousemove",_10.docPenMove);_f.addEvent(null,"mouseup",_10.docPenUp);}}_f.addEvent(null,"click",_10.docClick);_f.addEvent(null,"dblclick",_10.docDblClick);_f.addEvent(window,"resize",_10.docPenCancel);_f.addEvent(window,"scroll",_10.docPenCancel);_f.addEvent(window,"dragstart",_10.docPenCancelByDrag);_f.addEvent(null,"touchstart",_10.docTouchDown);_f.addEvent(null,"touchmove",_10.docTouchMove);_f.addEvent(null,"touchend",_10.docTouchUp);_f.addEvent(null,"gesturestart",_10.docGestureDown);_f.addEvent(null,"gesturechange",_10.docGestureMove);_f.addEvent(null,"gestureend",_10.docGestureUp);_10.TimerDraw=setInterval(function(){_10.traceInterval(true);},20);},setupTracePacket:function(num){var _11=InkTool.InkLib;var _12=InkTool.InkCanvasLib;_12.SerialNo=0;_12.PenTrace=new InkTool.InkDocTracePacket("pen",_12.SerialNo++,0,"");_12.TouchTraceList=[];for(var idx=0;idx<num;idx++){var _13=new InkTool.InkDocTracePacket("touch",_12.SerialNo++,0,"");_12.TouchTraceList.push(_13);}_12.PointerTraceList=[];for(var idx=0;idx<num;idx++){var _13=new InkTool.InkDocTracePacket("pointer",_12.SerialNo++,0,"");_12.PointerTraceList.push(_13);}for(var _14 in _12.List){var _15=_12.List[_14];_15.setupTracePacket();}},getMultiTouchMax:function(max){var _16=InkTool.InkCanvasLib;return _16.MultiTouchMax;},setMultiTouchMax:function(max){var _17=InkTool.InkLib;var _18=InkTool.InkCanvasLib;if(max<=0){max=1;}_18.MultiTouchMax=max;if(_18.Initialized){_18.setupTracePacket(max);}},setFeatureDetectingParams:function(_19,_1a,_1b,_1c){var _1d=InkTool.InkCanvasLib;if(_19!=null){_1d.FeatureDetectingBendDist=_19;}if(_1a!=null){_1d.FeatureDetectingStraightDist=_1a;}if(_1b!=null){_1d.FeatureDetectingTimeDist=_1b;}if(_1c!=null){_1d.FeatureDetectingSharpDist=_1c;}},setFeatureDetectingBend:function(_1e){var _1f=InkTool.InkCanvasLib;if(_1e!=null){_1f.FeatureDetectingBendDist=_1e;}},getFeatureDetectingBend:function(){var _20=InkTool.InkCanvasLib;return _20.FeatureDetectingBendDist;},setFeatureDetectingStraight:function(_21){var _22=InkTool.InkCanvasLib;if(_21!=null){_22.FeatureDetectingStraightDist=_21;}},getFeatureDetectingStraight:function(){var _23=InkTool.InkCanvasLib;return _23.FeatureDetectingStraightDist;},setFeatureDetectingTime:function(_24){var _25=InkTool.InkCanvasLib;if(_24!=null){_25.FeatureDetectingTimeDist=_24;}},getFeatureDetectingTime:function(){var _26=InkTool.InkCanvasLib;return _26.FeatureDetectingTimeDist;},setFeatureDetectingSharp:function(_27){var _28=InkTool.InkCanvasLib;if(_27!=null){_28.FeatureDetectingSharpDist=_27;}},getFeatureDetectingSharp:function(){var _29=InkTool.InkCanvasLib;return _29.FeatureDetectingSharpDist;},setPenEnterLimitDistance:function(_2a){var _2b=InkTool.InkCanvasLib;_2b.DocPenEnterLimitDistance=_2a;},getPenEnterLimitDistance:function(){var _2c=InkTool.InkCanvasLib;return _2c.DocPenEnterLimitDistance;},setPointerTypeTouchEnabled:function(_2d){var _2e=InkTool.InkCanvasLib;_2e.PointerEnableTouch=_2d;_2e.setupPointerTypeAll();},getPointerTypeTouchEnabled:function(){var _2f=InkTool.InkCanvasLib;return _2f.PointerEnableTouch;},setPointerTypePenEnabled:function(_30){var _31=InkTool.InkCanvasLib;_31.PointerEnablePen=_30;_31.setupPointerTypeAll();},getPointerTypePenEnabled:function(){var _32=InkTool.InkCanvasLib;return _32.PointerEnablePen;},setPointerTypeMouseEnabled:function(_33){var _34=InkTool.InkCanvasLib;_34.PointerEnableMouse=_33;_34.setupPointerTypeAll();},getPointerTypeMouseEnabled:function(){var _35=InkTool.InkCanvasLib;return _35.PointerEnableMouse;},setPointerTypeUnknownEnabled:function(_36){var _37=InkTool.InkCanvasLib;_37.PointerEnableUnknown=_36;_37.setupPointerTypeAll();},getPointerTypeUnknownEnabled:function(){var _38=InkTool.InkCanvasLib;return _38.PointerEnableUnknown;},setupPointerTypeAll:function(){var _39=InkTool.InkCanvasLib;_39.PointerEnableAll=(_39.PointerEnableTouch&&_39.PointerEnablePen&&_39.PointerEnableMouse&&_39.PointerEnableUnknown);},registerCanvasClass:function(key,_3a){InkTool.InkCanvasLib.CanvasClasses[key]=_3a;},getVersion:function(){return InkTool.InkCanvasLib.Version;},clearActiveX:function(){var _3b=InkTool.InkCanvasLib;_3b.ActiveXList=[];_3b.ActiveXType="";_3b.ActiveXGuid="";_3b.ActiveXInit="auto";_3b.ActiveXExists=0;},addActiveX:function(_3c,_3d,_3e){var _3f=InkTool.InkCanvasLib;if(_3e===undefined||_3e===null||_3e===""){_3e="auto";}var _40={"type":_3c,"guid":_3d,"init":_3e};_3f.ActiveXList.push(_40);if(_3f.ActiveXExists<0){_3f.ActiveXExists=0;}},setActiveX:function(_41,_42,_43){var _44=InkTool.InkCanvasLib;_44.clearActiveX();_44.addActiveX(_41,_42,_43);},checkActiveX:function(){var _45=InkTool.InkCanvasLib;var _46=false;if(_45.ActiveXExists==0){for(var idx=0;idx<_45.ActiveXList.length;idx++){var _47=_45.ActiveXList[idx];if(InkTool.InkLib.checkActiveX(_47.type)==true){_45.ActiveXType=_47.type;_45.ActiveXGuid=_47.guid;_45.ActiveXInit=_47.init;_46=true;break;}}_45.ActiveXExists=(_46==true)?1:-1;}else{_46=(_45.ActiveXExists>0);}return _46;},setDeviceFitControlSize:function(fit){var _48=InkTool.InkCanvasLib;_48.DeviceWintabFitControlSize=fit;},getDeviceFitControlSize:function(){var _49=InkTool.InkCanvasLib;return _49.DeviceWintabFitControlSize;},setDeviceFitControlSizeParams:function(_4a,_4b,_4c,_4d,_4e,_4f,_50,_51){var _52=InkTool.InkCanvasLib;_52.DeviceWintabFitControlSizeParams.ControlMargin.Left=_4a;_52.DeviceWintabFitControlSizeParams.ControlMargin.Top=_4b;_52.DeviceWintabFitControlSizeParams.ControlMargin.Right=_4c;_52.DeviceWintabFitControlSizeParams.ControlMargin.Bottom=_4d;_52.DeviceWintabFitControlSizeParams.KeepAspectRatio=_4e;_52.DeviceWintabFitControlSizeParams.EmbedTabletInControl=_4f;_52.DeviceWintabFitControlSizeParams.Alignment.Horizontal=_50;_52.DeviceWintabFitControlSizeParams.Alignment.Vertical=_51;},setDeviceFitControlSizeControlMargin:function(_53,_54,_55,_56){var _57=InkTool.InkCanvasLib;_57.DeviceWintabFitControlSizeParams.ControlMargin.Left=_53;_57.DeviceWintabFitControlSizeParams.ControlMargin.Top=_54;_57.DeviceWintabFitControlSizeParams.ControlMargin.Right=_55;_57.DeviceWintabFitControlSizeParams.ControlMargin.Bottom=_56;},getDeviceFitControlSizeControlMargin:function(){var _58=InkTool.InkCanvasLib;return _58.DeviceWintabFitControlSizeParams.ControlMargin;},setDeviceFitControlSizeKeepAspectRatio:function(_59){var _5a=InkTool.InkCanvasLib;_5a.DeviceWintabFitControlSizeParams.KeepAspectRatio=_59;},getDeviceFitControlSizeKeepAspectRatio:function(){var _5b=InkTool.InkCanvasLib;return _5b.DeviceWintabFitControlSizeParams.KeepAspectRatio;},setDeviceFitControlSizeEmbedTabletInControl:function(_5c){var _5d=InkTool.InkCanvasLib;_5d.DeviceWintabFitControlSizeParams.EmbedTabletInControl=_5c;},getDeviceFitControlSizeEmbedTabletInControl:function(){var _5e=InkTool.InkCanvasLib;return _5e.DeviceWintabFitControlSizeParams.EmbedTabletInControl;},setDeviceFitControlSizeAlignment:function(_5f,_60){var _61=InkTool.InkCanvasLib;_61.DeviceWintabFitControlSizeParams.Alignment.Horizontal=_5f;_61.DeviceWintabFitControlSizeParams.Alignment.Vertical=_60;},getDeviceFitControlSizeAlignment:function(){var _62=InkTool.InkCanvasLib;return _62.DeviceWintabFitControlSizeParams.Alignment;},setDeviceIgnoreTabletQuery:function(_63,_64,_65){var _66=InkTool.InkCanvasLib;_66.DeviceMsinkIgnoreTabletQuery=_63;_66.DeviceMsinkDefSupportStatus=_64;_66.DeviceMsinkDefSupportPressure=_65;},getDeviceIgnoreTabletQuery:function(){var _67=InkTool.InkCanvasLib;return _67.DeviceMsinkIgnoreTabletQuery;},getDeviceDefSupportSatus:function(){var _68=InkTool.InkCanvasLib;return _68.DeviceMsinkDefSupportStatus;},getDeviceDefSupportPressure:function(){var _69=InkTool.InkCanvasLib;return _69.DeviceMsinkDefSupportPressure;},getSignPadCanvas:function(){var _6a=InkTool.InkCanvasLib;return _6a.ActiveXSignPad;},setSignPadCanvas:function(id){var _6b=InkTool.InkCanvasLib;var _6c=_6b.getCanvas(id);if(_6c==null){return false;}if(_6c.isSignPadAvailable()==false){return false;}var oid=_6b.ActiveXSignPad;if(oid!=null){if(oid==id){return false;}var _6d=_6b.getCanvas(oid);if(_6d!=null){_6d.setSignPadPossible(false);}}_6c.setSignPadPossible(true);_6b.ActiveXSignPad=id;return true;},clearSignPadCanvas:function(){var _6e=InkTool.InkCanvasLib;var oid=_6e.ActiveXSignPad;if(oid==null){return false;}var _6f=_6e.getCanvas(oid);if(_6f!=null){_6f.setSignPadPossible(false);}_6e.ActiveXSignPad=null;return true;},isSignPadAvailable:function(){var _70=InkTool.InkCanvasLib;if(_70.ActiveXSignPad!=null){var _71=_70.List[_70.ActiveXSignPad];if(_71!=null){return _71.isSignPadAvailable();}}for(var _72 in _70.List){var _71=_70.List[_72];if(_71.isSignPadAvailable()){return true;}}return false;},isSignPadConnecting:function(){var _73=InkTool.InkCanvasLib;if(_73.ActiveXSignPad!=null){var _74=_73.List[_73.ActiveXSignPad];if(_74!=null){return _74.isSignPadConnecting();}}for(var _75 in _73.List){var _74=_73.List[_75];if(_74.isSignPadAvailable()){return _74.isSignPadConnecting();}}return false;},getSignPadInfo:function(){var _76=InkTool.InkCanvasLib;if(_76.ActiveXSignPad!=null){var _77=_76.List[_76.ActiveXSignPad];if(_77!=null){return _77.getSignPadInfo();}}for(var _78 in _76.List){var _77=_76.List[_78];if(_77.isSignPadAvailable()){return _77.getSignPadInfo();}}for(var _78 in _76.List){var _77=_76.List[_78];return _77.getSignPadInfo();}return {};},setSignPadImageURL:function(url){var _79=InkTool.InkCanvasLib;_79.DeviceSignPadBackImageURL=url;if(_79.ActiveXSignPad!=null){var _7a=_79.List[_79.ActiveXSignPad];if(_7a!=null){_7a.setSignPadImageURL(url);return;}}for(var _7b in _79.List){var _7a=_79.List[_7b];if(_7a.isSignPadAvailable()){_7a.getSignPadImageURL(url);return;}}},setSignPadFitControlSizeParams:function(_7c,_7d,_7e,_7f,_80,_81,_82,_83){var _84=InkTool.InkCanvasLib;_84.DeviceSignPadFitControlSizeParams.ControlMargin.Left=_7c;_84.DeviceSignPadFitControlSizeParams.ControlMargin.Top=_7d;_84.DeviceSignPadFitControlSizeParams.ControlMargin.Right=_7e;_84.DeviceSignPadFitControlSizeParams.ControlMargin.Bottom=_7f;_84.DeviceSignPadFitControlSizeParams.KeepAspectRatio=_80;_84.DeviceSignPadFitControlSizeParams.EmbedTabletInControl=_81;_84.DeviceSignPadFitControlSizeParams.Alignment.Horizontal=_82;_84.DeviceSignPadFitControlSizeParams.Alignment.Vertical=_83;},setSignPadFitControlSizeControlMargin:function(_85,_86,_87,_88){var _89=InkTool.InkCanvasLib;_89.DeviceSignPadFitControlSizeParams.ControlMargin.Left=_85;_89.DeviceSignPadFitControlSizeParams.ControlMargin.Top=_86;_89.DeviceSignPadFitControlSizeParams.ControlMargin.Right=_87;_89.DeviceSignPadFitControlSizeParams.ControlMargin.Bottom=_88;},getSignPadFitControlSizeControlMargin:function(){var _8a=InkTool.InkCanvasLib;return _8a.DeviceSignPadFitControlSizeParams.ControlMargin;},setSignPadFitControlSizeKeepAspectRatio:function(_8b){var _8c=InkTool.InkCanvasLib;_8c.DeviceSignPadFitControlSizeParams.KeepAspectRatio=_8b;},getSignPadFitControlSizeKeepAspectRatio:function(){var _8d=InkTool.InkCanvasLib;return _8d.DeviceSignPadFitControlSizeParams.KeepAspectRatio;},setSignPadFitControlSizeEmbedSignPadInControl:function(_8e){var _8f=InkTool.InkCanvasLib;_8f.DeviceSignPadFitControlSizeParams.EmbedTabletInControl=_8e;},getSignPadFitControlSizeEmbedSignPadInControl:function(){var _90=InkTool.InkCanvasLib;return _90.DeviceSignPadFitControlSizeParams.EmbedTabletInControl;},setSignPadFitControlSizeAlignment:function(_91,_92){var _93=InkTool.InkCanvasLib;_93.DeviceSignPadFitControlSizeParams.Alignment.Horizontal=_91;_93.DeviceSignPadFitControlSizeParams.Alignment.Vertical=_92;},getSignPadFitControlSizeAlignment:function(){var _94=InkTool.InkCanvasLib;return _94.DeviceSignPadFitControlSizeParams.Alignment;},setPreventDragAndSelect:function(_95){InkTool.InkCanvasLib.PreventDragAndSelect=_95;},suspendLibruary:function(){var _96=InkTool.InkCanvasLib;_96.PauseLib=true;},resumeLibruary:function(){var _97=InkTool.InkCanvasLib;_97.PauseLib=false;},setDebugLevel:function(_98){InkTool.InkCanvasLib.DebugLevel=_98;},isDebugging:function(){return (InkTool.InkCanvasLib.DebugLevel>0);},setAnalyzeLevel:function(_99){InkTool.InkCanvasLib.AnalyzeLevel=_99;},isAnalyzing:function(){return (InkTool.InkCanvasLib.AnalyzeLevel>0);},setAnalyzeDebugInfo:function(_9a){InkTool.InkCanvasLib.AnalyzeDebugInfo=_9a;},isAnalyzeDebugInfoShowing:function(){return (InkTool.InkCanvasLib.AnalyzeLevel>0&&InkTool.InkCanvasLib.AnalyzeDebugInfo>0);},getElementOfPosition:function(pos){var _9b=InkTool.InkLib.convertPositionEventToAbsolute(pos);var _9c=document.elementFromPoint(_9b.left,_9b.top);return _9c;},getElementOfPositionByPacket:function(_9d){if(_9d.etype=="pointer"){var xp=_9d.lastEvent.clientX;var yp=_9d.lastEvent.clientY;var _9e=document.elementFromPoint(xp,yp);return _9e;}else{return InkTool.InkCanvasLib.getElementOfPosition(_9d.lastPos);}},traceInterval:function(_9f){var _a0=InkTool.InkLib;var _a1=InkTool.InkCanvasLib;var _a2=_a0.needsEmulateCanvas();var _a3=(_9f==false&&_a2==false);for(var _a4 in _a1.List){var _a5=_a1.List[_a4];var _a6=_a5.getUseEmulatingTimer();if(_9f){_a5.tracePausing();}_a5.traceInterval();}},traceTimeout:function(){var _a7=InkTool.InkCanvasLib;for(var _a8 in _a7.List){var _a9=_a7.List[_a8];_a9.traceTimeout();}_a7.TotalCopyCount++;},convertPositionDocumentToCanvas:function(pos,_aa){return {left:pos.left-_aa.srect.left,top:pos.top-_aa.srect.top};},docPenDown:function(e){var _ab=InkTool.InkLib;var _ac=InkTool.InkCanvasLib;if(_ac.PenTrace.DocIsDrawing){return;}var evt=_ab.getLastEvent(e);var _ad=_ab.getButtonStatus(evt);if(_ad!=1){return;}_ac.DocLastDevice="mouse";var _ae=_ab.getEventPosition(evt);var _af=new Date();if(_ac.DocLastPenDownPos.left==_ae.left&&_ac.DocLastPenDownPos.top==_ae.top){if(_ac.DocLastPenUpTime+1000>_af.getTime()){_ac.DocLastPenDownIgnored=1;}}else{if(_ac.DocLLastPenDownPos.left==_ae.left&&_ac.DocLLastPenDownPos.top==_ae.top){if(_ac.DocLLastPenUpTime+1000>_af.getTime()){_ac.DocLastPenDownIgnored=2;}}else{_ac.DocLLastPenDownPos.left=_ac.DocLastPenDownPos.left;_ac.DocLLastPenDownPos.top=_ac.DocLastPenDownPos.top;_ac.DocLastPenDownPos.left=_ae.left;_ac.DocLastPenDownPos.top=_ae.top;}}_ac.PenTrace.setPositionTimeAndEvent(_ae,_af,evt);_ac.tracePenDown(_ac.PenTrace);},docPenMove:function(e){var _b0=InkTool.InkLib;var _b1=InkTool.InkCanvasLib;var evt=_b0.getLastEvent(e);var _b2=_b0.getButtonStatus(evt);var _b3=_b0.getEventPosition(evt);var _b4=_b1.PenTrace;var _b5=_b1.DocLastPenDownIgnored;if(_b5!=0){if(_b5==1&&_b1.DocLastPenDownPos.left==_b3.left&&_b1.DocLastPenDownPos.top==_b3.top){return;}if(_b5==2&&_b1.DocLLastPenDownPos.left==_b3.left&&_b1.DocLLastPenDownPos.top==_b3.top){return;}_b1.DocLastPenDownIgnored=0;}_b1.DocLastDevice="mouse";_b4.setPositionAndEvent(_b3,evt);if(_b4.DocIsDrawing==false||_b5!=0){if(_b2==1&&(_b0.Browser.IE||_b5!=0)){_b1.DocLLastPenDownPos.left=_b1.DocLastPenDownPos.left;_b1.DocLLastPenDownPos.top=_b1.DocLastPenDownPos.top;_b1.DocLastPenDownPos.left=_b3.left;_b1.DocLastPenDownPos.top=_b3.top;_b1.tracePenDown(_b4);}else{return;}}else{if(_b2==0){_b1.tracePenUp(_b4,1);return;}}_b1.tracePenMove(_b4);},docPenUp:function(e){var _b6=InkTool.InkLib;var _b7=InkTool.InkCanvasLib;if(_b7.PenTrace.DocIsDrawing==false){return;}var evt=_b6.getLastEvent(e);var _b8=_b6.getButtonStatus(evt);if(_b8!=1){return;}_b7.DocLastDevice="mouse";var _b9=_b6.getEventPosition(evt);_b7.PenTrace.setPositionAndEvent(_b9,evt);_b7.DocLLastPenUpTime=_b7.DocLastPenUpTime;_b7.DocLastPenUpTime=_b7.PenTrace.getLastTime();_b7.DocLastPenDownIgnored=0;if(_b6.Browser.Chrome){var _ba=_b7.PenTrace.getLastPosDistance();if(_ba>=1){_b7.tracePenMove(_b7.PenTrace);}}_b7.tracePenUp(_b7.PenTrace,0);_b7.PenTrace.DocIsDrawing=false;},docPenCancel:function(e){var _bb=InkTool.InkLib;var _bc=InkTool.InkCanvasLib;if(_bc.PenTrace.DocIsDrawing==false){return;}var evt=_bb.getLastEvent(e);var _bd=_bb.getEventPosition(evt);_bc.PenTrace.setPositionAndEvent(_bd,evt);_bc.tracePenUp(_bc.PenTrace,1);_bc.PenTrace.DocIsDrawing=false;_bc.DocLastPenDownIgnored=0;},docPenCancelByDrag:function(e){var _be=InkTool.InkLib;var _bf=InkTool.InkCanvasLib;var evt=_be.getLastEvent(e);var _c0=_be.getEventPosition(evt);_bf.PenTrace.setPositionAndEvent(_c0,evt);_bf.tracePenUp(_bf.PenTrace,1);_bf.PenTrace.DocIsDrawing=false;_bf.DocLastPenDownIgnored=0;var _c1=_bf.PointerTraceList.length;for(var tct=0;tct<_c1;tct++){var _c2=_bf.PointerTraceList[tct];if(_c2.crntMode>=0){_bf.tracePenUp(_c2,1);_c2.crntMode=2;}}_bf.docPointerTracePurge();var _c3=_bf.TouchTraceList.length;for(var tct=0;tct<_c3;tct++){var _c2=_bf.TouchTraceList[tct];if(_c2.crntMode>=0){_bf.tracePenUp(_c2,1);_c2.crntMode=2;}}_bf.docTouchTracePurge();},docClick:function(e){var _c4=InkTool.InkCanvasLib;_c4.docPenCancelByDrag(e);},docDblClick:function(e){var _c5=InkTool.InkCanvasLib;_c5.docPenCancelByDrag(e);},tracePenDown:function(_c6){var _c7=InkTool.InkLib;var _c8=InkTool.InkCanvasLib;var _c9=false;_c6.DocIsDrawing=true;if(_c8.TimerCopy!=null){clearTimeout(_c8.TimerCopy);_c8.TimerCopy=null;}var _ca=_c6.lastPos;var tid=_c7.getElementIdOfEventPosition(_c6.lastEvent);for(var _cb in _c8.List){var _cc=_c8.List[_cb];if(_cc.srect.containsPosition(_ca)&&_cc.isCanvasId(tid)){if(_cc.doPenDown(_c6,false)){_c9=true;}if(_cc.hotspotMode!=0){_c8.HotSpotHappening=true;}}}return _c9;},performPenDown:function(tid,xp,yp){var _cd=InkTool.InkLib;var _ce=InkTool.InkCanvasLib;if(xp===undefined){xp=0;}if(yp===undefined){yp=0;}var _cf=_ce.List[tid];if(_cf!=null){_cf.performPenDown(xp,yp);}},tracePenMove:function(_d0){var _d1=InkTool.InkLib;var _d2=InkTool.InkCanvasLib;var _d3=false;if(_d2.TimerCopy!=null){clearTimeout(_d2.TimerCopy);_d2.TimerCopy=null;}var _d4=_d0.lastPos;var tid=_d1.getElementIdOfEventPosition(_d0.lastEvent);for(var _d5 in _d2.List){var _d6=_d2.List[_d5];var _d7=_d0.List[_d5];if(_d6.srect.containsPosition(_d4)&&_d6.isCanvasId(tid)){if(_d7.isDrawing==false&&_d6.hotspotMode==0){var _d8=_d0.getLastPosDistance();if(_d8>=_d2.DocPenEnterLimitDistance){if(_d6.doPenDown(_d0,false)==true){_d3=true;}}else{if(_d6.doPenDown(_d0,true)==true){_d3=true;}if(_d6.doPenMove(_d0)==true){_d3=true;}}}else{if(_d6.doPenMove(_d0)==true){_d3=true;}}}else{if(_d7.isDrawing==true){_d6.doTracePausing(_d7,_d0.getLastTime(),1,_d0);if(_d6.doPenUp(_d0,0)==true){_d3=true;}}}}return _d3;},performPenMove:function(tid,xp,yp){var _d9=InkTool.InkLib;var _da=InkTool.InkCanvasLib;if(xp===undefined){xp=0;}if(yp===undefined){yp=0;}var _db=_da.List[tid];if(_db!=null){_db.performPenMove(xp,yp);}},tracePenUp:function(_dc,_dd){var _de=InkTool.InkLib;var _df=InkTool.InkCanvasLib;var _e0=false;_dc.DocIsDrawing=false;if(_df.TimerCopy!=null){clearTimeout(_df.TimerCopy);_df.TimerCopy=null;}for(var _e1 in _df.List){var _e2=_df.List[_e1];var _e3=_dc.List[_e1];if(_e3.isDrawing==true||_e2.hotspotMode!=0){if(_e2.doPenUp(_dc,_dd)){_e0=true;}}}_df.TimerCopy=setTimeout(function(){_df.traceTimeout();},250);return _e0;},performPenUp:function(tid,xp,yp){if(xp===undefined){xp=0;}if(yp===undefined){yp=0;}var _e4=InkTool.InkLib;var _e5=InkTool.InkCanvasLib;var _e6=_e5.List[tid];if(_e6!=null){_e6.performPenUp(xp,yp);}},performSignPadUp:function(tid,xp,yp){if(xp===undefined){xp=0;}if(yp===undefined){yp=0;}var _e7=InkTool.InkLib;var _e8=InkTool.InkCanvasLib;var _e9=_e8.List[tid];if(_e9!=null){_e9.performSignPadUp(xp,yp);}},docMSPointerDown:function(e){var _ea=InkTool.InkLib;var _eb=InkTool.InkCanvasLib;_eb.checkCanvasLocation();var evt=_ea.getLastEvent(e);if(_eb.PointerEnableAll!=true){var _ec=_ea.getEventPointerType(evt);switch(_ec){case "touch":if(_eb.PointerEnableTouch!=true){return;}break;case "pen":if(_eb.PointerEnablePen!=true){return;}break;case "mouse":if(_eb.PointerEnableMouse!=true){return;}break;default:if(_eb.PointerEnableUnknown!=true){return;}break;}}var _ed=_ea.getScrollX();var _ee=_ea.getScrollY();var _ef=_ea.getClientWidth();var _f0=_ea.getClientHeight();var _f1=_ea.getEventPosition(evt);if((_f1.left>=_ed&&_f1.left<_ed+_ef&&_f1.top>=_ee&&_f1.top<_ee+_f0)==false){return;}var _f2;_eb.HotSpotHappening=false;if(_eb.MultiTouchMax>1){_f2=_eb.docPointerDispatch(0,evt);}else{var _f3=_eb.PointerTraceList[0];var _f1=_ea.getEventPosition(evt);var id=_ea.getPointerEventId(evt);var _f4=new Date();if(_eb.DocLastPenDownPos.left==_f1.left&&_eb.DocLastPenDownPos.top==_f1.top){if(_eb.DocLastPenUpTime+1000>_f4.getTime()){_eb.DocLastPenDownIgnored=1;}}else{if(_eb.DocLLastPenDownPos.left==_f1.left&&_eb.DocLLastPenDownPos.top==_f1.top){if(_eb.DocLLastPenUpTime+1000>_f4.getTime()){_eb.DocLastPenDownIgnored=2;}}else{_eb.DocLLastPenDownPos.left=_eb.DocLastPenDownPos.left;_eb.DocLLastPenDownPos.top=_eb.DocLastPenDownPos.top;_eb.DocLastPenDownPos.left=_f1.left;_eb.DocLastPenDownPos.top=_f1.top;}}_f3.id=id;_f3.setPositionTimeAndEvent(_f1,_f4,evt);_f3.crntMode=0;_f2=_eb.tracePenDown(_f3);if(_f2==false&&_eb.DocLastPenDownIgnored!=0){_f3.crntMode=-1;}}if(_f2==true||_eb.HotSpotHappening){_ea.preventDefaultActionOfEvent(evt,true,true);}},checkCanvasLocation:function(){var _f5=InkTool.InkLib;var _f6=InkTool.InkCanvasLib;for(var _f7 in _f6.List){var _f8=_f6.List[_f7];_f8.relocation();}},docMSPointerMove:function(e){var _f9=InkTool.InkLib;var _fa=InkTool.InkCanvasLib;var evt=_f9.getLastEvent(e);if(_fa.PointerEnableAll!=true){var _fb=_f9.getEventPointerType(evt);switch(_fb){case "touch":if(_fa.PointerEnableTouch!=true){return;}break;case "pen":if(_fa.PointerEnablePen!=true){return;}break;case "mouse":if(_fa.PointerEnableMouse!=true){return;}break;default:if(_fa.PointerEnableUnknown!=true){return;}break;}}var _fc;if(_fa.MultiTouchMax>1){_fc=_fa.docPointerDispatch(1,evt);}else{var _fd=_fa.PointerTraceList[0];var _fe=_f9.getEventPosition(evt);var id=_f9.getPointerEventId(evt);var _ff=_fa.DocLastPenDownIgnored;if(_ff!=0){if(_ff==1&&_fa.DocLastPenDownPos.left==_fe.left&&_fa.DocLastPenDownPos.top==_fe.top){return;}if(_ff==2&&_fa.DocLLastPenDownPos.left==_fe.left&&_fa.DocLLastPenDownPos.top==_fe.top){return;}_fa.DocLastPenDownIgnored=0;}if(_fd.id==id&&_fd.crntMode>=0){_fd.setPositionAndEvent(_fe,evt);_fd.crntMode=1;_fc=_fa.tracePenMove(_fd);}else{if(_ff!=0){_fa.DocLLastPenDownPos.left=_fa.DocLastPenDownPos.left;_fa.DocLLastPenDownPos.top=_fa.DocLastPenDownPos.top;_fa.DocLastPenDownPos.left=_fe.left;_fa.DocLastPenDownPos.top=_fe.top;_fd.setPositionAndEvent(_fe,evt);_fd.crntMode=0;_fc=_fa.tracePenDown(_fd);}else{_fc=false;}}}if(_fc==true){_f9.preventDefaultActionOfEvent(evt,true,true);}},docMSPointerUp:function(e){var _100=InkTool.InkLib;var _101=InkTool.InkCanvasLib;var evt=_100.getLastEvent(e);if(_101.PointerEnableAll!=true){var _102=_100.getEventPointerType(evt);switch(_102){case "touch":if(_101.PointerEnableTouch!=true){return;}break;case "pen":if(_101.PointerEnablePen!=true){return;}break;case "mouse":if(_101.PointerEnableMouse!=true){return;}break;default:if(_101.PointerEnableUnknown!=true){return;}break;}}var _103;if(_101.MultiTouchMax>1){_103=_101.docPointerDispatch(2,evt);}else{var _104=_101.PointerTraceList[0];var epos=_100.getEventPosition(evt);_104.setPositionAndEvent(epos,evt);_104.crntMode=2;_101.DocLLastPenUpTime=_101.DocLastPenUpTime;_101.DocLastPenUpTime=_104.getLastTime();_101.DocLastPenDownIgnored=0;_103=_101.tracePenUp(_104,0);_104.crntMode=-1;}if(_103==true){_100.preventDefaultActionOfEvent(evt,true,true);}},docPointerDispatch:function(mode,evt){var _105=InkTool.InkLib;var _106=InkTool.InkCanvasLib;_106.DocLastDevice="mspointer";var epos=_105.getEventPosition(evt);var id=_105.getPointerEventId(evt);var _107=false;if(mode==0){var _108=_106.findPointerTracePacket(id);if(_108==null){var _109=_106.findEmptyPointerTracePacket();if(_109!=null){var _10a=true;var _10b=new Date();if(_106.DocLastPenDownPos.left==epos.left&&_106.DocLastPenDownPos.top==epos.top){if(_106.DocLastPenUpTime+1000>_10b.getTime()){_106.DocLastPenDownIgnored=1;}}else{if(_106.DocLLastPenDownPos.left==epos.left&&_106.DocLLastPenDownPos.top==epos.top){if(_106.DocLLastPenUpTime+1000>_10b.getTime()){_106.DocLastPenDownIgnored=2;}}else{_106.DocLLastPenDownPos.left=_106.DocLastPenDownPos.left;_106.DocLLastPenDownPos.top=_106.DocLastPenDownPos.top;_106.DocLastPenDownPos.left=epos.left;_106.DocLastPenDownPos.top=epos.top;}}if(_10a){_109.id=id;_109.setPositionTimeAndEvent(epos,_10b,evt);_109.crntMode=0;if(_106.tracePenDown(_109)==true){_107=true;}else{if(_106.DocLastPenDownIgnored!=0){_109.crntMode=-1;}}}}}else{}}else{if(mode==1){var _108=_106.findPointerTracePacket(id);if(_108==null){var _109=_106.findEmptyPointerTracePacket();if(_109!=null){var _10a=false;var _10c=_106.DocLastPenDownIgnored;if(_10c!=0){_10a=true;if(_10c==1&&_106.DocLastPenDownPos.left==epos.left&&_106.DocLastPenDownPos.top==epos.top){_10a=false;}if(_10c==2&&_106.DocLLastPenDownPos.left==epos.left&&_106.DocLLastPenDownPos.top==epos.top){_10a=false;}if(_10a==true){_106.DocLastPenDownIgnored=0;_106.DocLLastPenDownPos.left=_106.DocLastPenDownPos.left;_106.DocLLastPenDownPos.top=_106.DocLastPenDownPos.top;_106.DocLastPenDownPos.left=epos.left;_106.DocLastPenDownPos.top=epos.top;}}if(_10a==true){_109.id=id;_109.setPositionAndEvent(epos,evt);_109.crntMode=0;if(_106.tracePenDown(_109)==true){_107=true;}else{if(_106.DocLastPenDownIgnored!=0){_109.crntMode=-1;}}}}}else{_108.setPositionAndEvent(epos,evt);_108.crntMode=1;if(_106.tracePenMove(_108)==true){_107=true;}}}else{var _108=_106.findPointerTracePacket(id);if(_108==null){}else{_108.setPositionAndEvent(epos,evt);_108.crntMode=2;if(_106.tracePenUp(_108,0)==true){_107=true;}_106.DocLLastPenUpTime=_106.DocLastPenUpTime;_106.DocLastPenUpTime=_108.getLastTime();_106.DocLastPenDownIgnored=0;}}}_106.docPointerTracePurge();return _107;},findPointerTracePacket:function(id){var _10d=InkTool.InkLib;var _10e=InkTool.InkCanvasLib;var _10f=_10e.PointerTraceList.length;for(var idx=0;idx<_10f;idx++){var _110=_10e.PointerTraceList[idx];if(_110.id==id&&_110.crntMode>=0){return _110;}}return null;},findEmptyPointerTracePacket:function(){var _111=InkTool.InkLib;var _112=InkTool.InkCanvasLib;var _113=_112.PointerTraceList.length;for(var idx=0;idx<_113;idx++){var _114=_112.PointerTraceList[idx];if(_114.crntMode<0){return _114;}}var _115=-1;var _116=-1;for(var idx=0;idx<_113;idx++){var _114=_112.PointerTraceList[idx];var time=_114.getLastTime();if(_116<0||_115>time){_116=idx;_115=time;}}if(_116>=0){var _114=_112.PointerTraceList[_116];_114.crntMode=-1;_114.id=-1;return _114;}return null;},docPointerTracePurge:function(){var _117=InkTool.InkCanvasLib;var _118=_117.PointerTraceList.length;for(var idx=_118-1;idx>=0;idx--){if(_117.PointerTraceList[idx].crntMode==2){_117.PointerTraceList[idx].crntMode=-1;_117.PointerTraceList[idx].id=-1;}}},docTouchDown:function(e){var _119=InkTool.InkLib;var _11a=InkTool.InkCanvasLib;var evt=_119.getLastEvent(e);var _11b;_11a.HotSpotHappening=false;if(_11a.MultiTouchMax>1){_11b=_11a.docTouchDispatch(0,evt);}else{var epos=_119.getTouchEventPosition(evt,0);var id=_119.getTouchEventId(evt,0);var _11c=_11a.TouchTraceList[0];_11c.id=id;_11c.touchIndex=0;_11c.setPositionAndEvent(epos,evt);_11c.crntMode=0;_11b=_11a.tracePenDown(_11c);}if(_11b==true||_11a.HotSpotHappening==true){_119.preventDefaultActionOfEvent(evt,true,true);}},docTouchMove:function(e){var _11d=InkTool.InkLib;var _11e=InkTool.InkCanvasLib;var evt=_11d.getLastEvent(e);var _11f;if(_11e.MultiTouchMax>1){_11f=_11e.docTouchDispatch(1,evt);}else{var _120=_11e.TouchTraceList[0];var _121=-1;var _122=_11d.getTouchEventPositionsLength(evt);for(var idx=0;idx<_122;idx++){var tid=_11d.getTouchEventId(evt,idx);if(tid==_120.id){_121=idx;break;}}if(_121>=0){var epos=_11d.getTouchEventPosition(evt,_121);var id=_11d.getTouchEventId(evt,_121);_120.id=id;_120.touchIndex=_121;_120.setPositionAndEvent(epos,evt);_120.crntMode=1;_11f=_11e.tracePenMove(_120);}}if(_11f==true){_11d.preventDefaultActionOfEvent(evt,true,true);}},docTouchUp:function(e){var _123=InkTool.InkLib;var _124=InkTool.InkCanvasLib;var evt=_123.getLastEvent(e);var _125;if(_124.MultiTouchMax>1){_125=_124.docTouchDispatch(2,evt);}else{var _126=_124.TouchTraceList[0];_126.crntMode=2;_125=_124.tracePenUp(_126,0);}if(_125==true){_123.preventDefaultActionOfEvent(evt,true,true);}},docTouchDispatch:function(mode,evt){var _127=InkTool.InkLib;var _128=InkTool.InkCanvasLib;_128.DocLastDevice="touch";var _129=false;var _12a=_128.TouchTraceList.length;if(mode==0){_128.docTouchTraceChange(mode,evt);}else{if(mode==1){_128.docTouchTraceChange(mode,evt);}else{_128.docTouchTraceChange(mode,evt);}}for(var idx=0;idx<_12a;idx++){var _12b=_128.TouchTraceList[idx];if(_12b.crntMode==0){if(_128.tracePenDown(_12b)==true){_129=true;}}else{if(_12b.crntMode==1){if(_128.tracePenMove(_12b)==true){_129=true;}}else{if(_12b.crntMode==2){if(_128.tracePenUp(_12b,0)==true){_129=true;}}}}}_128.docTouchTracePurge();return _129;},docTouchTraceChange:function(mode,evt){var _12c=InkTool.InkLib;var _12d=InkTool.InkCanvasLib;var _12e=_12d.TouchTraceList.length;var _12f=_12c.getTouchEventPositionsLength(evt);var _130=_12c.getChangedTouchEventPositionsLength(evt);for(var idx=0;idx<_12e;idx++){var _131=_12d.TouchTraceList[idx];if(_131.crntMode>=0){_131.crntMode=2;}}for(var idx=0;idx<_12f;idx++){var epos=_12c.getTouchEventPosition(evt,idx);var id=_12c.getTouchEventId(evt,idx);var _132=false;for(var cct=0;cct<_130;cct++){var cid=_12c.getChangedTouchEventId(evt,cct);if(id==cid){_132=true;break;}}var _133=-1;for(var tct=0;tct<_12e;tct++){var _131=_12d.TouchTraceList[tct];if(_131.id==id&&_131.crntMode>=0){_133=tct;break;}}if(_133>=0){var _131=_12d.TouchTraceList[_133];_131.setPositionAndEvent(epos,evt);_131.touchIndex=idx;if(_132==false){_131.crntMode=3;}else{_131.crntMode=1;}}else{var _131=null;for(var tct=0;tct<_12e;tct++){var _134=_12d.TouchTraceList[tct];if(_134.crntMode<0){_131=_134;break;}}if(_131!=null){_131.id=id;_131.touchIndex=idx;_131.setPositionAndEvent(epos,evt);_131.crntMode=0;}}}},docTouchTracePurge:function(){var _135=InkTool.InkCanvasLib;var _136=_135.TouchTraceList.length;for(var idx=_136-1;idx>=0;idx--){if(_135.TouchTraceList[idx].crntMode==2){_135.TouchTraceList[idx].crntMode=-1;}}},docGestureDown:function(e){var _137=InkTool.InkLib;var _138=InkTool.InkCanvasLib;var evt=_137.getLastEvent(e);var _139=_138.docGestureDispatch(0,evt);if(_139==true){_137.preventDefaultActionOfEvent(evt,true,true);}},docGestureMove:function(e){var _13a=InkTool.InkLib;var _13b=InkTool.InkCanvasLib;var evt=_13a.getLastEvent(e);var _13c=_13b.docGestureDispatch(1,evt);if(_13c==true){_13a.preventDefaultActionOfEvent(evt,true,true);}},docGestureUp:function(e){var _13d=InkTool.InkLib;var _13e=InkTool.InkCanvasLib;var evt=_13d.getLastEvent(e);var _13f=_13e.docGestureDispatch(2,evt);if(_13f==true){_13d.preventDefaultActionOfEvent(evt,true,true);}},docGestureDispatch:function(mode,evt){var _140=InkTool.InkLib;var _141=InkTool.InkCanvasLib;_141.DocLastDevice="gesture";return false;},getCanvas:function(id){return InkTool.InkCanvasLib.List[id];},getDrawingCanvas:function(id){return InkTool.InkCanvasLib.List[id];},getCanvasIdList:function(){var keys=[];for(var key in InkTool.InkCanvasLib.List){keys.push(key);}return keys;},createCanvas:function(id,_142,_143,_144){var _145=InkTool.InkLib;var _146=InkTool.InkCanvasLib;var _147=_145.getElementById(id);if(_147==null){return null;}_146.initialize();if(_142===undefined||_142===null||_142===""){_142="standard";}if(_143===undefined||_143===null){_143=0;}if(_144===undefined||_144===null){_144=0;}var axex;if(_142!="standard"){axex=_146.checkActiveX();}else{axex=false;}var _148=false;if(_142=="auto"||_142=="auto+sp"){if(_142=="auto+sp"){_148=true;}if(axex==true){_142="activex";}else{_142="standard";}}else{if(_142=="activex+sp"){_142="activex";_148=true;}}var _149=_146.CanvasClasses[_142];if(_149==null){_149=InkTool.InkCanvasBase;}var _14a=new _149(_147,0,0,0,_143,_144,null,_148);_146.List[id]=_14a;return _14a;},createViewCanvas:function(id,_14b){var _14c=InkTool.InkLib;var _14d=InkTool.InkCanvasLib;var _14e=_14c.getElementById(id);if(_14e==null){return null;}var _14f=_14c.getElementById(_14b);if(_14f==null){return null;}_14d.initialize();var _150="standard";var _151=0;var _152=0;var _153=false;var _154=_14d.CanvasClasses[_150];if(_154==null){_154=InkTool.InkCanvasBase;}var _155=new _154(_14e,0,0,0,_151,_152,_14f,_153);_14d.List[id]=_155;return _155;},createFepCanvas:function(id){var _156=InkTool.InkLib;var _157=InkTool.InkCanvasLib;var _158=_156.getElementById(id);if(_158==null){return null;}_157.initialize();var _159=_157.CanvasClasses["standard"];if(_159==null){_159=InkTool.InkCanvasBase;}var _15a=new _159(_158,0,0,1,0,0,null,false);_157.List[id]=_15a;return _15a;},createPDFCanvas:function(id){var _15b=InkTool.InkLib;var _15c=InkTool.InkCanvasLib;var _15d=_15b.getElementById(id);if(_15d==null){return null;}_15c.initialize();var _15e=_15c.CanvasClasses["standard"];if(_15e==null){_15e=InkTool.InkCanvasBase;}var _15f=new _15e(_15d,0,0,2,0,0,null,false);_15c.List[id]=_15f;return _15f;},relayoutCanvas:function(id){var _160=InkTool.InkCanvasLib;var _161=_160.List[id];if(_161==null){return false;}return _161.relayout();},hideCanvas:function(id){var _162=InkTool.InkCanvasLib;var _163=_162.List[id];if(_163==null){return false;}return _163.display(false);},showCanvas:function(id){var _164=InkTool.InkCanvasLib;var _165=_164.List[id];if(_165==null){return false;}return _165.display(true);},createDummyCanvas:function(_166,_167){if(InkTool.InkCanvasLib.DummyDiv==null||InkTool.InkCanvasLib.DummyCanvas==null){var _168=document.createElement("div");_168.id="inkTool_dummy_canvas_div";_168.onselectstart=function(){return false;};_168.ondragstart=function(){return false;};_168.style.userSelect="none";_168.style.MozUserSelect="none";_168.style.webkitUserSelect="none";_168.style.msUserSelect="none";_168.style.msTouchAction="none";_168.style.touchAction="none";_168.style.position="absolute";_168.style.left="0px";_168.style.top="0px";_168.style.visibility="hidden";_168.style.padding="0px";_168.width=_166;_168.height=_167;InkTool.InkCanvasLib.DummyDiv=_168;var _169=document.createElement("canvas");_169.id="inktool_dummy_canvas";_169.onselectstart=function(){return false;};_169.ondragstart=function(){return false;};_169.style.userSelect="none";_169.style.MozUserSelect="none";_169.style.webkitUserSelect="none";_169.style.msUserSelect="none";_169.style.msTouchAction="none";_169.style.touchAction="none";_169.width=_166;_169.height=_167;if(InkTool.InkLib.needsEmulateCanvas()){G_vmlCanvasManager.initElement(_169);}InkTool.InkCanvasLib.DummyCanvas=_169;_168.appendChild(_169);document.body.appendChild(_168);return _169;}else{var _168=InkTool.InkCanvasLib.DummyDiv;_168.width=_166;_168.height=_167;var _169=InkTool.InkCanvasLib.DummyCanvas;_169.width=_166;_169.height=_167;return _169;}},releaseDummyCanvas:function(){InkTool.InkCanvasLib.createDummyCanvas(1,1);},getTotalDrawingTime:function(){return InkTool.InkCanvasLib.TotalDrawingTime;},getTotalDrawingCells:function(){return InkTool.InkCanvasLib.TotalDrawingCells;},getAveDrawingTime:function(){var _16a=InkTool.InkCanvasLib.TotalDrawingTime;var _16b=InkTool.InkCanvasLib.TotalDrawingCells;return _16a/_16b;},getTotalCopyCount:function(){return InkTool.InkCanvasLib.TotalCopyCount;},doNothing:function(){return false;},sendInk:function(id,url){var _16c=InkTool.InkCanvasLib.getCanvas(id);if(_16c==null){return;}if(_16c.countDrawItems()==0){return;}var _16d=_16c.saveInk();this.sendString("InkData="+_16d,url);},sendInkShort:function(id,url){var _16e=InkTool.InkCanvasLib.getCanvas(id);if(_16e==null){return;}if(_16e.countDrawItems()==0){return;}var _16f=_16e.saveInkShort();this.sendString("InkData="+_16f,url);},sendString:function(str,url,_170){var _171=InkTool.InkCanvasLib.getXmlHttpObject();_171.onreadystatechange=function(){if(_171.readyState==4&&_171.status==200){try{if(typeof (_170)==="function"){_170(_171.responseText);}else{alert("resp="+_171.responseText);}}catch(e){alert("request parse error:"+e);}}else{if(_171.readyState==4){alert("status error:"+_171.status+":resp="+_171.responseText);}}};try{_171.open("POST",url,true);_171.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded");_171.send(str);}catch(e){alert("http send error:"+e);}},getXmlHttpObject:function(){var _172=null;try{_172=new XMLHttpRequest();}catch(e){try{_172=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){_172=new ActiveXObject("Microsoft.XMLHTTP");}}return _172;},Dummy:null};}if(typeof InkTool.InkTracePacket==="undefined"){InkTool.InkTracePacket=InkTool.InkLib.Class.create(null,{initialize:function(_173){this.serialNo=_173;this.arrayCell=new Array();this.arrayCopy=new Array();this.llastX=0;this.llastY=0;this.llastT=0;this.lastX=0;this.lastY=0;this.lastT=0;this.moveCount=0;this.testTimeStr="";this.lastV1=0;this.lastV2=0;this.lastV3=0;this.lastV4=0;this.lastV5=0;this.lastMovePos={"left":0,"top":0};this.isDrawing=false;this.pen=null;this.drawingContext=null;this.drawingStroke=false;this.currentStroke=null;this.currentStatus;this.startTime=null;this.endTime=null;},addCell:function(cell){this.arrayCell.push(cell);},dummy:function(){}});}else{if(InkTool.InkCanvasLib.Combinable!==true){alert("Version mismatched!");}}if(typeof InkTool.InkCanvasBase==="undefined"){InkTool.InkCanvasBase=InkTool.InkLib.Class.create(null,{Extended:false,initialize:function(_174,_175,_176,mode,_177,_178,_179,_17a){var _17b=InkTool.InkLib;var _17c=InkTool.InkCanvasLib;if(_174==null){this.Initialized=false;return;}var epos=_17b.getElementAbsoluteLocation(_174);var _17d=_17b.getElementLocation(_174);var _17e=_17b.getElementSize(_174);if(_17e.width<8){_17e.width=8;}if(_17e.height<8){_17e.height=8;}var _17f=_176;if(_17f==0){_17f=_17b.getStyleOfElement(_174,"z-index",null);}this.Version=_17c.Version;this.CanvasType="standard";this.DeviceType="unknown";this.CanvasInfo={"version":_17c.Version,"name":"InkCanvas","signpad":false,"replay":true};this.drawingMode=0;this.replayMode=0;this.hotspotMode=0;this.canPenMove=false;this.useEmulatingTimer=InkTool.InkLib.needsEmulateCanvas();this.featureDetectingBendDist=_17c.FeatureDetectingBendDist;this.featureDetectingStraightDist=_17c.FeatureDetectingStraightDist;this.featureDetectingTimeDist=_17c.FeatureDetectingTimeDist;this.featureDetectingSharpDist=_17c.FeatureDetectingSharpDist;this.baseWidth=_177;this.baseHeight=_178;_174.onselectstart=function(){return false;};_174.ondragstart=function(){return false;};_174.style.userSelect="none";_174.style.MozUserSelect="none";_174.style.webkitUserSelect="none";_174.style.msUserSelect="none";_174.style.msTouchAction="none";_174.style.touchAction="none";this.id=_174.id;this.altid=null;this.zorder=_176;this.ezindex=_17f;this.viewZoomRatio=1;this.viewOffsetX=0;this.viewOffsetY=0;this.viewTimer=null;if(_179!=null){this.viewMode=1;this.viewRatio=3;this.viewWidth=_17e.width*this.viewRatio;this.viewHeight=_17e.height*this.viewRatio;this.viewTranslateX=-((this.viewWidth-_17e.width)/2);this.viewTranslateY=-((this.viewHeight-_17e.height)/2);this.altid=_179.id;this.container=document.createElement("div");this.container.id="inktool_"+this.id+"_container";this.container.onselectstart=function(){return false;};this.container.ondragstart=function(){return false;};this.container.style.userSelect="none";this.container.style.MozUserSelect="none";this.container.style.webkitUserSelect="none";this.container.style.msUserSelect="none";this.container.style.msTouchAction="none";this.container.style.touchAction="none";this.container.style.position="absolute";this.container.style.left=""+epos.left+"px";this.container.style.top=""+epos.top+"px";this.container.style.width=""+_17e.width+"px";this.container.style.height=""+_17e.height+"px";this.container.style.margin="0px";this.container.style.padding="0px";if(_17f!==null){this.container.style.zIndex=_17f;}this.container.style.overflow="hidden";this.bcanvas=document.createElement("canvas");this.bcanvas.id="inktool_"+this.id+"_back";this.bcanvas.onselectstart=function(){return false;};this.bcanvas.ondragstart=function(){return false;};this.bcanvas.style.userSelect="none";this.bcanvas.style.MozUserSelect="none";this.bcanvas.style.webkitUserSelect="none";this.bcanvas.style.msUserSelect="none";this.bcanvas.style.msTouchAction="none";this.bcanvas.style.touchAction="none";this.bcanvas.style.position="static";this.bcanvas.width=this.viewWidth;this.bcanvas.height=this.viewHeight;if(_17f!==null){this.bcanvas.style.zIndex=_17f;}this.container.appendChild(this.bcanvas);this.dcanvas=document.createElement("canvas");this.dcanvas.id="inktool_"+this.id+"_draw";this.dcanvas.onselectstart=function(){return false;};this.dcanvas.ondragstart=function(){return false;};this.dcanvas.style.userSelect="none";this.dcanvas.style.MozUserSelect="none";this.dcanvas.style.webkitUserSelect="none";this.dcanvas.style.msUserSelect="none";this.dcanvas.style.msTouchAction="none";this.dcanvas.style.touchAction="none";this.dcanvas.style.position="absolute";this.dcanvas.style.left="0px";this.dcanvas.style.top="0px";this.dcanvas.width=this.viewWidth;this.dcanvas.height=this.viewHeight;if(_17f!==null){this.dcanvas.style.zIndex=_17f;}this.container.appendChild(this.dcanvas);_17b.addElementAfter(_174,this.container);var ox=this.viewTranslateX;var oy=this.viewTranslateY;this.setViewStyle(this.bcanvas,1,ox,oy);this.setViewStyle(this.dcanvas,1,ox,oy);}else{this.viewMode=0;this.viewRatio=1;this.viewTranslateX=0;this.viewTranslateY=0;this.altid=null;this.container=null;this.dcanvas=document.createElement("canvas");this.dcanvas.id="inktool_"+this.id+"_draw";this.dcanvas.onselectstart=function(){return false;};this.dcanvas.ondragstart=function(){return false;};this.dcanvas.style.userSelect="none";this.dcanvas.style.MozUserSelect="none";this.dcanvas.style.webkitUserSelect="none";this.dcanvas.style.msUserSelect="none";this.dcanvas.style.msTouchAction="none";this.dcanvas.style.touchAction="none";this.dcanvas.style.position="absolute";this.dcanvas.style.left=""+epos.left+"px";this.dcanvas.style.top=""+epos.top+"px";this.dcanvas.width=_17e.width;this.dcanvas.height=_17e.height;if(_17f!==null){this.dcanvas.style.zIndex=_17f;}_17b.addElementAfter(_174,this.dcanvas);this.bcanvas=document.createElement("canvas");this.bcanvas.id="inktool_"+this.id+"_back";this.bcanvas.onselectstart=function(){return false;};this.bcanvas.ondragstart=function(){return false;};this.bcanvas.style.userSelect="none";this.bcanvas.style.MozUserSelect="none";this.bcanvas.style.webkitUserSelect="none";this.bcanvas.style.msUserSelect="none";this.bcanvas.style.msTouchAction="none";this.bcanvas.style.touchAction="none";this.bcanvas.style.position="absolute";this.bcanvas.style.left=""+epos.left+"px";this.bcanvas.style.top=""+epos.top+"px";this.bcanvas.width=_17e.width;this.bcanvas.height=_17e.height;if(_17f!==null){this.bcanvas.style.zIndex=_17f;}_17b.addElementAfter(_174,this.bcanvas);}if(_17b.needsEmulateCanvas()){G_vmlCanvasManager.initElement(this.dcanvas);}if(_17b.needsEmulateCanvas()){G_vmlCanvasManager.initElement(this.bcanvas);}this.dcontext=this.dcanvas.getContext("2d");this.hcanvas=document.createElement("canvas");this.hcanvas.width=_17e.width;this.hcanvas.height=_17e.height;this.slayer=null;this.canvasMode=mode;this.rect=new InkTool.InkRect(epos.left,epos.top,_17e.width,_17e.height);this.srect=new InkTool.InkRect(_17d.left,_17d.top,_17e.width,_17e.height);this.traceList={};this.arrayCell=new Array();this.arrayCopy=new Array();this.llastX=0;this.llastY=0;this.llastT=0;this.lastX=0;this.lastY=0;this.lastT=0;this.moveCount=0;this.testTimeStr="";this.lastV1=0;this.lastV2=0;this.lastV3=0;this.lastV4=0;this.lastV5=0;this.lastMoveX=0;this.lastMoveY=0;this.isDrawing=false;var ofx=this.viewOffsetX+this.viewTranslateX/this.viewZoomRatio;var ofy=this.viewOffsetY+this.viewTranslateY/this.viewZoomRatio;this.drawingContext=new InkTool.DrawingContext(null,ofx,ofy,1);this.drawingContext.setFeatureDetectingParams(this.featureDetectingBendDist,this.featureDetectingStraightDist,this.featureDetectingTimeDist,this.featureDetectingSharpDist);if(this.baseWidth>0){this.inkWidth=this.baseWidth;}else{this.inkWidth=_17e.width;}if(this.baseHeight>0){this.inkHeight=this.baseHeight;}else{this.inkHeight=_17e.height;}this.backColor=new InkTool.InkColor("rgba(0, 0, 0, 0.0)");this.pen=null;this.drawingStroke=false;this.currentStroke=null;this.pageIndex=_175;if(this.pageIndex==0){this.pageIndex=_17c.InkData.Note.countPages()+1;}this.penDownPreFunc=null;this.penDownFunc=null;this.penMoveFunc=null;this.penUpFunc=null;this.signpadUpFunc=null;this.penDownInnerPreFunc=null;this.penDownInnerFunc=null;this.penMoveInnerFunc=null;this.penUpInnerFunc=null;this.signpadUpInnerFunc=null;this.lastPenupTime=null;this.preFuncIntervalTime=500;if(_179!=null||mode==1||mode==2){this.autoZoomRatio=false;this.setupTracePacket();}else{this.autoZoomRatio=true;this.calcAutoZoomRatio();}if(this.pageIndex>0){var _180=_17c.InkData.Note.countPages();if(_180<this.pageIndex){_17c.InkData.Note.addPages(this.pageIndex-_180);}this.currentPage=_17c.InkData.Note.getPage(this.pageIndex-1);this.currentLayer=this.currentPage.getCurrentLayer();this.currentDrawing=this.currentLayer.Drawing;}else{this.currentPage=null;this.currentLayer=null;this.currentDrawing=null;}this.clearDrawingCanvas();this.drawingBuffer=new InkTool.InkDrawing();this.drawingMode=1;this.fullDrawMode=true;this.useFullDraw=false;this.replayMode=0;this.replaySpeed=1;this.replayMaxInterval=1000;this.replayStrokeIndex=0;this.replayCellIndex=0;this.replayStartTime=0;this.replayTargetBaseTime=0;this.replayLastTime=0;this.replayPackets=[];this.replayHandler=null;this.replayTimer=null;this.setupCanPenMove();},setupTracePacket:function(){var _181=InkTool.InkLib;var _182=InkTool.InkCanvasLib;var _183=new InkTool.InkTracePacket(0);_183.pen=this.pen;var _184=this.drawingContext;_183.drawingContext=_184.clone();_183.currentStatus=0;_182.PenTrace.List[this.id]=_183;for(var idx=0;idx<_182.TouchTraceList.length;idx++){_183=new InkTool.InkTracePacket(0);_183.pen=this.pen;var _184=this.drawingContext;_183.drawingContext=_184.clone();_183.currentStatus=0;_182.TouchTraceList[idx].List[this.id]=_183;}for(var idx=0;idx<_182.PointerTraceList.length;idx++){_183=new InkTool.InkTracePacket(0);_183.pen=this.pen;var _184=this.drawingContext;_183.drawingContext=_184.clone();_183.currentStatus=0;_182.PointerTraceList[idx].List[this.id]=_183;}},setupCanPenMove:function(){if(this.drawingMode==0||this.pen==null||this.replayMode!=0||this.hotspotMode!=0){this.canPenMove=false;}else{this.canPenMove=true;}if(InkTool.InkLib.needsEmulateCanvas()||this.fullDrawMode==true){this.useFullDraw=true;}else{this.useFullDraw=false;}},getVersion:function(){return this.getCanvasInfo("version");},getCanvasType:function(){return this.CanvasType;},getCanvasInfo:function(key){if(key===undefined||key===null||key===""){return this.CanvasInfo;}else{if(this.CanvasInfo==null){return null;}else{return this.CanvasInfo[key];}}},getDeviceType:function(){return this.DeviceType;},setDevicePriority:function(mode){return false;},getDevicePriority:function(){return "none";},setDeviceFitControlSize:function(fit){return false;},getDeviceFitControlSize:function(){return false;},setDeviceFitControlSizeParams:function(_185,_186,_187,_188,_189,_18a,_18b,_18c){return false;},setDeviceFitControlSizeControlMargin:function(_18d,_18e,_18f,_190){return false;},getDeviceFitControlSizeControlMargin:function(){return {Left:0,Top:0,Right:0,Bottom:0};},setDeviceFitControlSizeKeepAspectRatio:function(_191){return false;},getDeviceFitControlSizeKeepAspectRatio:function(){return 0;},setDeviceFitControlSizeEmbedTabletInControl:function(_192){return false;},getDeviceFitControlSizeEmbedTabletInControl:function(){return 0;},setDeviceFitControlSizeAlignment:function(_193,_194){return false;},getDeviceFitControlSizeAlignment:function(){return {Horizontal:0,Vertical:0};},setDeviceIgnoreTabletQuery:function(_195){return false;},getDeviceIgnoreTabletQuery:function(){return false;},getDeviceDefSupportStatus:function(){return false;},getDeviceDefSupportPressure:function(){return false;},setSignPadPossible:function(flag){return false;},getSignPadPossible:function(){return false;},isSignPadAvailable:function(){return false;},isSignPadConnecting:function(){return false;},getSignPadInfo:function(){return {"type":0,"name":"","id":"","width":0,"height":0};},setSignPadFitControlSize:function(fit){return false;},getSignPadFitControlSize:function(){return false;},setSignPadFitControlSizeParams:function(_196,_197,_198,_199,_19a,_19b,_19c,_19d){return false;},setSignPadFitControlSizeControlMargin:function(_19e,_19f,_1a0,_1a1){return false;},getSignPadFitControlSizeControlMargin:function(){return {Left:0,Top:0,Right:0,Bottom:0};},setSignPadFitControlSizeKeepAspectRatio:function(_1a2){return false;},getSignPadFitControlSizeKeepAspectRatio:function(){return 0;},setSignPadFitControlSizeEmbedSignPadInControl:function(_1a3){return false;},getSignPadFitControlSizeEmbedSignPadInControl:function(){return 0;},setSignPadFitControlSizeAlignment:function(_1a4,_1a5){return false;},getSignPadFitControlSizeAlignment:function(){return {Horizontal:0,Vertical:0};},setUseEmulatingTimer:function(flag){this.useEmulatingTimer=flag;},getUseEmulatingTimer:function(){return this.useEmulatingTimer;},setUseFullDrawMode:function(flag){this.fullDrawMode=flag;this.setupCanPenMove();},getUseFullDrawMode:function(){return this.fullDrawMode;},setFeatureDetectingParams:function(bend,_1a6,time,_1a7){if(bend!=null){this.featureDetectingBendDist=bend;}if(_1a6!=null){this.featureDetectingStraightDist=_1a6;}if(time!=null){this.featureDetectingTimeDist=time;}if(_1a7!=null){this.featureDetectingSharpDist=_1a7;}this.drawingContext.setFeatureDetectingParams(this.featureDetectingBendDist,this.featureDetectingStraightDist,this.featureDetectingTimeDist,this.featureDetectingSharpDist);this.setupTracePacket();},setFeatureDetectingBend:function(bend){this.setFeatureDetectingParams(bend,null,null,null);},getFeatureDetectingBend:function(){return this.featureDetectingBendDist;},setFeatureDetectingStraight:function(_1a8){this.setFeatureDetectingParams(null,_1a8,null,null);},getFeatureDetectingStraight:function(){return this.featureDetectingStraightDist;},setFeatureDetectingTime:function(time){this.setFeatureDetectingParams(null,null,time,null);},getFeatureDetectingTime:function(){return this.featureDetectingTimeDist;},setFeatureDetectingSharp:function(_1a9){this.setFeatureDetectingParams(null,null,null,_1a9);},getFeatureDetectingSharp:function(){return this.featureDetectingSharpDist;},getId:function(){return this.id;},getNumStrokes:function(){return this.countDrawItems();},getMaxStrokes:function(){return this.drawingBuffer.countDrawItems();},getNumCells:function(){return this.countDrawItemCells();},getNumFeatureCells:function(mode){return this.countDrawItemFeatureCells(mode);},setDrawingMode:function(mode){this.drawingMode=mode;if(mode==0&&this.isDrawing){this.isDrawing=false;this.doPenUp({"left":this.lastMoveX,"top":this.lastMoveY});}this.setupCanPenMove();},getDrawingMode:function(){return this.drawingMode;},setHandler:function(_1aa,_1ab){if(_1aa=="prependown"){this.penDownPreFunc=_1ab;}else{if(_1aa=="pendown"){this.penDownFunc=_1ab;}else{if(_1aa=="penmove"){this.penMoveFunc=_1ab;}else{if(_1aa=="penup"){this.penUpFunc=_1ab;}else{if(_1aa=="signpadup"){this.signpadUpFunc=_1ab;}}}}}},setAutoZoomRatio:function(){this.autoZoomRatio=true;this.calcAutoZoomRatio();this.redrawCurrentLayerByInk();},calcAutoZoomRatio:function(){var _1ac=this.rect.getWidth()/this.inkWidth;var _1ad=this.rect.getHeight()/this.inkHeight;if(_1ac<=_1ad){this.drawingContext.setZoomRatio(_1ac);}else{this.drawingContext.setZoomRatio(_1ad);}this.drawingContext.setOffset(0,0);this.setupTracePacket();},setZoomRatio:function(_1ae){this.autoZoomRatio=false;this.drawingContext.setZoomRatio(_1ae);this.drawingContext.calcClipRect(this.bcanvas.width,this.bcanvas.height);if(this.baseWidth>0||this.baseHeight>0){this.baseWidth=0;this.baseHeight=0;}this.inkWidth=Math.round(this.rect.getWidth()/this.drawingContext.getZoomRatio());this.inkHeight=Math.round(this.rect.getHeight()/this.drawingContext.getZoomRatio());this.setupTracePacket();this.redrawCurrentLayerByInk();},setOffset:function(_1af,_1b0){this.autoZoomRatio=false;this.drawingContext.setOffset(_1af,_1b0);this.drawingContext.calcClipRect(this.bcanvas.width,this.bcanvas.height);this.setupTracePacket();this.redrawCurrentLayerByInk();},setZoomAndOffset:function(_1b1,_1b2,_1b3){this.autoZoomRatio=false;this.drawingContext.setZoomRatio(_1b1);this.drawingContext.setOffset(_1b2,_1b3);this.drawingContext.calcClipRect(this.bcanvas.width,this.bcanvas.height);if(this.baseWidth>0||this.baseHeight>0){this.baseWidth=0;this.baseHeight=0;}this.inkWidth=Math.round(this.rect.getWidth()/this.drawingContext.getZoomRatio());this.inkHeight=Math.round(this.rect.getHeight()/this.drawingContext.getZoomRatio());this.setupTracePacket();this.redrawCurrentLayerByInk();},setCurrentZoomAndOffset:function(){this.autoZoomRatio=false;this.drawingContext.calcClipRect(this.bcanvas.width,this.bcanvas.height);if(this.baseWidth>0||this.baseHeight>0){this.baseWidth=0;this.baseHeight=0;}this.inkWidth=Math.round(this.rect.getWidth()/this.drawingContext.getZoomRatio());this.inkHeight=Math.round(this.rect.getHeight()/this.drawingContext.getZoomRatio());this.setupTracePacket();this.redrawCurrentLayerByInk();},setPen:function(pen){if(pen.isAutomaticSwitchover()==true){this.pen=pen.html5Pen;}else{this.pen=pen;}this.setupCanPenMove();return true;},setPrePenDownFuncIntervalTime:function(time){this.preFuncIntervalTime=time;},setBackgroundColor:function(_1b4){},setBackgroundImageURL:function(url){},setSignPadImageURL:function(url){},setActiveXMode:function(flag){},setView:function(_1b5,_1b6,_1b7,_1b8){if(this.viewMode==0){return;}this.viewMode=2;this.viewZoomRatio=_1b5;this.viewOffsetX=_1b6;this.viewOffsetY=_1b7;if(this.viewTimer!=null){clearTimeout(this.viewTimer);this.viewTimer=null;}if(_1b8==null||_1b8<=0){this.viewMode=1;this.doFixView();}else{var _1b9=this.drawingContext.getZoomRatio();var _1ba=this.drawingContext.getOffsetX();var _1bb=this.drawingContext.getOffsetY();var _1bc=this.viewZoomRatio/_1b9;var ox=-((this.viewOffsetX-_1ba)*this.viewZoomRatio);var oy=-((this.viewOffsetY-_1bb)*this.viewZoomRatio);this.setViewStyle(this.bcanvas,_1bc,ox,oy);this.setViewStyle(this.dcanvas,_1bc,ox,oy);var cvs=this;this.viewTimer=setTimeout(function(){cvs.viewMode=1;cvs.doFixView();},_1b8);}},fixView:function(){if(this.viewMode!=2){return;}this.viewMode=1;if(this.viewTimer!=null){clearTimeout(this.viewTimer);this.viewTimer=null;}this.doFixView();},doFixView:function(){var _1bd=this.drawingContext.getZoomRatio();var _1be=this.drawingContext.getOffsetX();var _1bf=this.drawingContext.getOffsetY();var pox,poy;if(_1bd!=this.viewZoomRatio){pox=-this.viewOffsetX*this.viewZoomRatio;poy=-this.viewOffsetY*this.viewZoomRatio;}else{pox=-((this.viewOffsetX-_1be)*this.viewZoomRatio);poy=-((this.viewOffsetY-_1bf)*this.viewZoomRatio);}var _1c0=false;if(pox>-this.rect.getWidth()/2){pox=-this.rect.getWidth();_1c0=true;}else{if(pox<-(this.viewWidth-this.rect.getWidth()*3/2)){pox=-(this.viewWidth-this.rect.getWidth()*2);_1c0=true;}}if(poy>-this.rect.getHeight()/2){poy=-this.rect.getHeight();_1c0=true;}else{if(poy<-(this.viewHeight-this.rect.getHeight()*3/2)){poy=-(this.viewHeight-this.rect.getHeight()*2);_1c0=true;}}this.viewTranslateX=pox;this.viewTranslateY=poy;this.setViewStyle(this.bcanvas,1,pox,poy);this.setViewStyle(this.dcanvas,1,pox,poy);if(_1c0||_1bd!=this.viewZoomRatio){var ofx=this.viewOffsetX+this.viewTranslateX/this.viewZoomRatio;var ofy=this.viewOffsetY+this.viewTranslateY/this.viewZoomRatio;this.setZoomAndOffset(this.viewZoomRatio,ofx,ofy);}},setViewStyle:function(elem,_1c1,ox,oy){var _1c2="translate("+ox+"px,"+oy+"px) "+"scale("+_1c1+","+_1c1+")";elem.style.setProperty("transform-origin","0 0");elem.style.setProperty("-moz-transform-origin","0 0");elem.style.setProperty("-webkit-transform-origin","0 0");elem.style.setProperty("-o-transform-origin","0 0");elem.style.setProperty("-ms-transform-origin","0 0");elem.style.setProperty("transform",_1c2);elem.style.setProperty("-moz-transform",_1c2);elem.style.setProperty("-webkit-transform",_1c2);elem.style.setProperty("-o-transform",_1c2);elem.style.setProperty("-ms-transform",_1c2);},relayout:function(){var _1c3=InkTool.InkLib;var _1c4=InkTool.InkCanvasLib;var _1c5;if(this.altid!=null){_1c5=_1c3.getElementById(this.altid);}else{_1c5=_1c3.getElementById(this.id);}if(_1c5==null){return false;}var epos=_1c3.getElementAbsoluteLocation(_1c5);var _1c6=_1c3.getElementLocation(_1c5);var _1c7=_1c3.getElementSize(_1c5);if(_1c7.width<8){_1c7.width=8;}if(_1c7.height<8){_1c7.height=8;}var _1c8=this.zorder;if(_1c8==0){_1c8=_1c3.getStyleOfElement(_1c5,"z-index",null);}if(this.container!=null){this.container.style.left=""+epos.left+"px";this.container.style.top=""+epos.top+"px";var _1c9=false;if(this.container.width!=_1c7.width||this.container.height!=_1c7.height){this.viewWidth=_1c7.width*this.viewRatio;this.viewHeight=_1c7.height*this.viewRatio;this.viewTranslateX=-((this.viewWidth-_1c7.width)/2);this.viewTranslateY=-((this.viewHeight-_1c7.height)/2);this.container.style.width=""+_1c7.width+"px";this.container.style.height=""+_1c7.height+"px";this.bcanvas.width=this.viewWidth;this.bcanvas.height=this.viewHeight;this.dcanvas.width=this.viewWidth;this.dcanvas.height=this.viewHeight;var ox=this.viewTranslateX;var oy=this.viewTranslateY;this.setViewStyle(this.bcanvas,1,ox,oy);this.setViewStyle(this.dcanvas,1,ox,oy);_1c9=true;}this.container.style.zIndex=_1c8;}else{this.bcanvas.style.left=""+epos.left+"px";this.bcanvas.style.top=""+epos.top+"px";var _1c9=false;if(this.bcanvas.width!=_1c7.width||this.bcanvas.height!=_1c7.height){this.bcanvas.width=_1c7.width;this.bcanvas.height=_1c7.height;_1c9=true;}this.bcanvas.style.zIndex=_1c8;this.dcanvas.style.left=""+epos.left+"px";this.dcanvas.style.top=""+epos.top+"px";this.dcanvas.width=_1c7.width;this.dcanvas.height=_1c7.height;this.dcanvas.style.zIndex=_1c8;}this.hcanvas.width=_1c7.width;this.hcanvas.height=_1c7.height;if(this.slayer!=null){this.slayer.style.left=""+epos.left+"px";this.slayer.style.top=""+epos.top+"px";this.slayer.width=_1c7.width;this.slayer.height=_1c7.height;this.slayer.style.zIndex=_1c8;}this.rect=new InkTool.InkRect(epos.left,epos.top,_1c7.width,_1c7.height);this.srect=new InkTool.InkRect(_1c6.left,_1c6.top,_1c7.width,_1c7.height);if(this.baseWidth>0){this.inkWidth=this.baseWidth;}else{this.inkWidth=Math.round(_1c7.width/this.drawingContext.getZoomRatio());}if(this.baseHeight>0){this.inkHeight=this.baseHeight;}else{this.inkHeight=Math.round(_1c7.height/this.drawingContext.getZoomRatio());}if(_1c9){if(this.autoZoomRatio){this.calcAutoZoomRatio();}if(this.container!=null){var ofx=this.viewOffsetX+this.viewTranslateX/this.viewZoomRatio;var ofy=this.viewOffsetY+this.viewTranslateY/this.viewZoomRatio;this.setOffset(ofx,ofy);}else{this.redrawCurrentLayerByInk();}}return true;},relocation:function(){var _1ca=InkTool.InkLib;var _1cb=InkTool.InkCanvasLib;var _1cc;if(this.altid!=null){_1cc=_1ca.getElementById(this.altid);}else{_1cc=_1ca.getElementById(this.id);}if(_1cc!=null){var epos=_1ca.getElementAbsoluteLocation(_1cc);var _1cd=_1ca.getElementLocation(_1cc);this.rect.left=epos.left;this.rect.top=epos.top;this.srect.left=_1cd.left;this.srect.top=_1cd.top;}},display:function(flag){var _1ce=InkTool.InkLib;var _1cf=InkTool.InkCanvasLib;if(flag){_1ce.showElement(this.bcanvas);_1ce.showElement(this.dcanvas);if(this.slayer!=null){_1ce.showElement(this.slayer);}}else{_1ce.hideElement(this.bcanvas);_1ce.hideElement(this.dcanvas);if(this.slayer!=null){_1ce.hideElement(this.slayer);}}},clearInk:function(){this.clearInkOfCurrentLayer();},undoInk:function(){this.undoInkOfCurrentLayer();},redoInk:function(){this.redoInkOfCurrentLayer();},saveInkObject:function(){return {};},saveInkObjectLegacy:function(){return {};},saveInkObjectWithFeature:function(){return {};},saveInk:function(){return "";},saveInkLegacy:function(){return "";},saveInkWithFeature:function(){return "";},saveInkObjectLong:function(){return {};},saveInkLong:function(){return "";},saveInkObjectShort:function(mode){return {};},saveInkShort:function(){return "";},saveDebugCsv:function(){return "";},loadInkObject:function(_1d0){this.loadInkShortObject(_1d0);},loadInk:function(_1d1){this.loadInkShort(_1d1);},loadInkLong:function(_1d2){var _1d3=JSON.parse(_1d2);this.loadInkLogObject(_1d3);},loadInkLongObject:function(_1d4){var _1d5=new InkTool.InkDrawing();for(var _1d6=0;_1d6<_1d4.is.length;_1d6++){var _1d7=_1d4.is[_1d6];var _1d8=_1d7.st.tp;var _1d9=this.createStationeryByType(_1d8);_1d9.setPenColor(new InkTool.InkColor(_1d7.st.col));_1d9.setPenWidth(_1d7.st.w);_1d9.setPenMinWidth(_1d7.st.minw);_1d9.setPenMaxWidth(_1d7.st.maxw);var _1da=new InkTool.InkStroke(_1d9);for(var _1db=0;_1db<_1d7.cs.length;_1db++){var cell=_1d7.cs[_1db];var _1dc=new InkTool.InkCell(cell.m,cell.x,cell.y,cell.w,cell.p,cell.t);_1da.addCell(_1dc);}_1d5.addDrawItem(_1da);}this.inkWidth=_1d4.w;this.inkHeight=_1d4.h;this.loadInkObjectSub(_1d5);},loadInkShort:function(_1dd){var _1de=JSON.parse(_1dd);this.loadInkShortObject(_1de);},loadInkShortObject:function(_1df){var _1e0=new InkTool.InkDrawing();for(var _1e1=0;_1e1<_1df.is.length;_1e1++){var _1e2=_1df.is[_1e1];var _1e3=_1e2.st.tp;var _1e4=this.createStationeryByType(_1e3);_1e4.setPenColor(new InkTool.InkColor(_1e2.st.col));_1e4.setPenWidth(_1e2.st.w);_1e4.setPenMinWidth(_1e2.st.minw);_1e4.setPenMaxWidth(_1e2.st.maxw);var _1e5=new InkTool.InkStroke(_1e4);var _1e6=_1e2.t;var _1e7=_1e2.st.w;var _1e8=false;for(var _1e9=0;_1e9<_1e2.cs.length;_1e9++){var _1ea=_1e2.cs[_1e9];var mode=(_1e9==0)?0:1;var _1eb=_1ea.split(":");if(_1eb.length>=2){mode=Number(_1eb[1]);_1ea=_1eb[0];_1e8=true;}var _1ec=_1ea.split("|");var _1ed=_1ec.length;var xp,yp,wd,pr,tm;xp=Number(_1ec[0]);yp=Number(_1ec[1]);if(_1ed==3){wd=_1e7;pr=0;tm=_1e6+Number(_1ec[2]);}else{if(_1ed==4){wd=Number(_1ec[2]);pr=0;tm=_1e6+Number(_1ec[3]);}else{if(_1ed>=5){wd=Number(_1ec[2]);pr=Number(_1ec[3]);tm=_1e6+Number(_1ec[4]);}}}var _1ee=new InkTool.InkCell(mode,xp,yp,wd,pr,tm);_1e5.addCell(_1ee);if(_1e9==_1e2.cs.length-1&&mode!=2){var _1ef=new InkTool.InkCell(2,xp,yp,wd,pr,tm);_1e5.addCell(_1ef);}}if(_1e8==false&&_1df.fdp){var _1f0=this.drawingContext.clone();_1f0.setFeatureDetectingParams(_1df.fdp.bd,_1df.fdp.st,_1df.fdp.tm,_1df.fdp.sp);for(var _1e9=0;_1e9<_1e5.countCells();_1e9++){var _1ee=_1e5.getCell(_1e9);_1e4.strokeDispatch(this.drawingContext,_1ee,2);}}_1e0.addDrawItem(_1e5);}this.inkWidth=_1df.w;this.inkHeight=_1df.h;this.loadInkObjectSub(_1e0);},createStationeryByType:function(_1f1){var _1f2;switch(_1f1){case InkTool.InkPenType.PressSenseBallpointPen:case "pn01":_1f2=new InkTool.PressSenseBallpointPen();break;case InkTool.InkPenType.PressSenseFeltPen:case "pn02":_1f2=new InkTool.PressSenseFeltPen();break;case InkTool.InkPenType.PressSenseSignPen:case "pn06":_1f2=new InkTool.PressSenseSignPen();break;case InkTool.InkPenType.PressSenseSchoolPen:case "pn07":_1f2=new InkTool.PressSenseSchoolPen();break;case InkTool.InkPenType.Old_BallpointPen:case InkTool.InkPenType.SolidPen:case "hp00":_1f2=new InkTool.SolidPen();break;case InkTool.InkPenType.Old_VariableBallpointPen:case InkTool.InkPenType.SpeedSenseBallpointPen:case "hp01":_1f2=new InkTool.InkVariableBallpointPen();break;case InkTool.InkPenType.Old_FeltPen:case InkTool.InkPenType.Old_BrushPen:case InkTool.InkPenType.SpeedSenseFeltPen:case "hp02":_1f2=new InkTool.InkFeltPen();break;case InkTool.InkPenType.Old_VariableFudePen:case InkTool.InkPenType.SpeedSenseFudePen:case "hp04":_1f2=new InkTool.InkVariableFudePen();break;case InkTool.InkPenType.Old_VariableSignPen:case InkTool.InkPenType.SpeedSenseSignPen:case "hp06":_1f2=new InkTool.InkVariableSignPen();break;case InkTool.InkPenType.SpeedSenseSchoolPen:case "hp07":_1f2=new InkTool.SpeedSenseSchoolPen();break;case InkTool.InkPenType.Old_Pencil:case InkTool.InkPenType.Old_PencilEmulated:case InkTool.InkPenType.Pencil:case InkTool.InkPenType.PencilEmulated:case "cpn1":case "cpn2":_1f2=new InkTool.InkPencil();break;case InkTool.InkPenType.Old_NormalEraser:case InkTool.InkPenType.SolidEraser:case "er03":_1f2=new InkTool.InkNormalEraser();break;case InkTool.InkPenType.PressSenseNormalEraser:case "er02":_1f2=new InkTool.PressSenseNormalEraser();break;case InkTool.InkPenType.Old_FeltPenV100:case InkTool.InkPenType.FeltPenV100:_1f2=new InkTool.InkFeltPenV100();break;default:_1f2=new InkTool.InkStationery();break;}return _1f2;},loadInkObjectSub:function(_1f3){if(this.autoZoomRatio){this.calcAutoZoomRatio();}else{this.setCurrentZoomAndOffset();}var _1f4=this.currentLayer;if(_1f4!=null){_1f4.Drawing=_1f3.clone();this.currentDrawing=_1f4.Drawing;this.drawingBuffer=this.currentDrawing.clone();}this.redrawCurrentLayerByInk();},loadRecogInkObject:function(_1f5){var _1f6=new InkTool.InkDrawing();for(var _1f7=0;_1f7<_1f5.strokes.length;_1f7++){var _1f8=_1f5.strokes[_1f7];var _1f9=this.pen;var _1fa=new InkTool.InkStroke(_1f9);var _1fb=_1f8.time;for(var _1fc=0;_1fc<_1f8.cells.length;_1fc++){var _1fd=_1f8.cells[_1fc];var mode=(_1fc==0)?0:1;var _1fe=_1f9.getPenWidth();var xp,yp,wd,pr,tm;xp=_1fd.x;yp=_1fd.y;wd=_1fe;pr=0;tm=_1fb+_1fd.t;var _1ff=new InkTool.InkCell(mode,xp,yp,wd,pr,tm);_1fa.addCell(_1ff);if(_1fc==_1f8.cells.length-1&&mode!=2){var _200=new InkTool.InkCell(2,xp,yp,wd,pr,tm);_1fa.addCell(_200);}}_1f6.addDrawItem(_1fa);}if(_1f5.size!=null){this.inkWidth=_1f5.size;this.inkHeight=_1f5.size;}else{this.inkWidth=_1f5.width;this.inkHeight=_1f5.height;}this.loadInkObjectSub(_1f6);},isCanvasTag:function(elem){var _201=elem;var tid=(elem?elem.id:"");if(InkTool.InkLib.needsEmulateCanvas()){if(this.id===tid){return true;}var _202=null;while(elem!==null){if(elem.tagName===undefined){return false;}var _203=elem.tagName.toLowerCase();if(_203=="body"){return false;}else{if(_203=="canvas"){_202=elem;break;}else{if(this.id===elem.id){return true;}else{if(this.slayer!=null&&this.slayer.id===elem.id){return true;}}}}elem=elem.parentNode;}if(!_202){return false;}if(this.dcanvas.id===_202.id||this.bcanvas.id===_202.id){return true;}else{return false;}}else{return (this.id===tid||this.dcanvas.id===tid||this.bcanvas.id===tid);}},isCanvasId:function(tid){if(InkTool.InkLib.needsEmulateCanvas()){return true;}else{return (this.dcanvas.id===tid||this.bcanvas.id===tid||this.id===tid);}},convertPositionDocumentToCanvas:function(dpos,_204,_205){return {left:((dpos.left-_204.srect.left-_204.viewTranslateX)/_205.zoomRatio)+_205.offsetX,top:((dpos.top-_204.srect.top-_204.viewTranslateY)/_205.zoomRatio)+_205.offsetY};},convertPositionElementToCanvas:function(_206,pos){return {"left":(pos.left/_206.getZoomRatio())+_206.getOffsetX(),"top":(pos.top/_206.getZoomRatio())+_206.getOffsetY()};},convertPositionCanvasToElement:function(_207,pos){return {"left":(pos.left-_207.getOffsetX())*_207.getZoomRatio(),"top":(pos.top-_207.getOffsetY())*_207.getZoomRatio()};},doPenDown:function(_208,last){if(this.replayMode!=0){return false;}var _209=InkTool.InkLib;var _20a=InkTool.InkCanvasLib;var dpos=(last)?_208.llastPos:_208.lastPos;var epos=this.convertPositionDocumentToCanvas(dpos,this,this.drawingContext);if(last==false&&(this.penDownInnerPreFunc!=null||this.penDownPreFunc!=null)){var _20b=(this.lastPenUpTime!=null)?this.lastPenUpTime:0;var crnt=new Date();var _20c=crnt.getTime();if(_20c-_20b>this.preFuncIntervalTime){if(this.penDownInnerPreFunc!=null){if(this.penDownInnerPreFunc(this,epos)==false){this.hotspotMode=1;this.setupCanPenMove();return false;}}if(this.penDownPreFunc!=null){try{if(this.penDownPreFunc(this,epos)==false){this.hotspotMode=1;this.setupCanPenMove();return false;}}catch(e){alert("prependown handler error:"+e);return false;}}}}this.hotspotMode=0;this.setupCanPenMove();if(this.drawingMode==0||this.pen==null||_20a.DocLastPenDownIgnored!=0){return false;}var _20d=_208.List[this.id];_20d.pen=this.pen;_20d.currentStatus=0;_20d.isDrawing=true;_20d.startTime=_208.getLastTime();this.DeviceType=_208.etype;var tm=_20d.startTime;_20d.currentStroke=new InkTool.InkStroke(_20d.pen);if(this.currentDrawing!=null){this.currentDrawing.addDrawItem(_20d.currentStroke);}var cell=new InkTool.InkCell(0,epos.left,epos.top,_20d.pen.getPenWidth(),0,tm);if(cell!=null){_20d.currentStroke.addCell(cell);if(_20d.pen.hasFullDrawMode()===true&&this.useFullDraw){if(this.useEmulatingTimer==true){_20d.arrayCell.push(cell);}else{_20d.drawingContext.context=this.dcanvas.getContext("2d");_20d.pen.drawStart(_20d.drawingContext);_20d.pen.strokeDispatch(_20d.drawingContext,cell,1);_20d.arrayCopy.push(cell);}}else{_20d.drawingContext.context=this.bcanvas.getContext("2d");_20d.pen.drawStart(_20d.drawingContext);_20d.pen.strokeDispatch(_20d.drawingContext,cell,1);}}if(this.penDownInnerFunc!=null){this.penDownInnerFunc(this,epos);}if(this.penDownFunc!=null){try{this.penDownFunc(this,epos);}catch(e){alert("pendown handler error:"+e);}}_20d.lastMovePos=epos;return true;},performPenDown:function(xp,yp){var epos={left:xp,top:yp};if(this.penDownInnerFunc!=null){this.penDownInnerFunc(this,epos);}if(this.penDownFunc!=null){try{this.penDownFunc(this,epos);}catch(e){alert("pendown handler error:"+e);}}},doPenMove:function(_20e){if(this.canPenMove==false){return false;}var _20f=InkTool.InkLib;var epos=this.convertPositionDocumentToCanvas(_20e.lastPos,this,this.drawingContext);var _210=_20e.List[this.id];var tm=_20e.getLastTime();_210.currentStatus=1;var cell=new InkTool.InkCell(1,epos.left,epos.top,_210.pen.getPenWidth(),0,tm);if(cell!=null){_210.currentStroke.addCell(cell);if(_210.pen.hasFullDrawMode()===true&&this.useFullDraw){if(this.useEmulatingTimer==true){_210.arrayCell.push(cell);}else{_210.pen.strokeDispatch(_210.drawingContext,cell,1);_210.arrayCopy.push(cell);}}else{_210.pen.strokeDispatch(_210.drawingContext,cell,1);}}if(this.penMoveInnerFunc!=null){this.penMoveInnerFunc(this,epos);}if(this.penMoveFunc!=null){try{this.penMoveFunc(this,epos);}catch(e){alert("penmove handler error:"+e);}}_210.lastMovePos=epos;return true;},performPenMove:function(xp,yp){var epos={left:xp,top:yp};if(this.penMoveInnerFunc!=null){this.penMoveInnerFunc(this,epos);}if(this.penMoveFunc!=null){try{this.penMoveFunc(this,epos);}catch(e){alert("penmove handler error:"+e);}}},doPenUp:function(_211,mode){if(this.drawingMode==0||this.pen==null||this.replayMode!=0){if(this.hotspotMode!=0){this.hotspotMode=0;this.setupCanPenMove();}return false;}if(this.hotspotMode!=0){this.hotspotMode=0;this.setupCanPenMove();return false;}var _212=InkTool.InkLib;var _213=_211.List[this.id];var epos;if(mode==0){epos=this.convertPositionDocumentToCanvas(_211.lastPos,this,this.drawingContext);_213.lastMovePos=epos;}else{epos=_213.lastMovePos;}_213.currentStatus=2;if(_213.isDrawing){_213.isDrawing=false;_213.endTime=this.lastPenUpTime=_211.getLastTime();var tm=_213.endTime;var cell=new InkTool.InkCell(2,epos.left,epos.top,_213.pen.getPenWidth(),0,tm);if(cell!=null){_213.currentStroke.addCell(cell);if(_213.pen.hasFullDrawMode()===true&&this.useFullDraw){if(this.useEmulatingTimer==true){_213.arrayCell.push(cell);}else{_213.pen.strokeDispatch(_213.drawingContext,cell,1);_213.pen.drawEnd(_213.drawingContext);_213.arrayCopy.push(cell);}}else{_213.pen.strokeDispatch(_213.drawingContext,cell,1);_213.pen.drawEnd(_213.drawingContext);}}if(_213.currentStroke!=null){this.drawingBuffer=this.currentLayer.Drawing.clone();}if(this.penUpInnerFunc!=null){this.penUpInnerFunc(this,epos);}if(this.penUpFunc!=null){try{this.penUpFunc(this,epos);}catch(e){alert("penup handler error:"+e);}}}return true;},performPenUp:function(xp,yp){var epos={left:xp,top:yp};if(this.penUpInnerFunc!=null){this.penUpInnerFunc(this,epos);}if(this.penUpFunc!=null){try{this.penUpFunc(this,epos);}catch(e){alert("penup handler error:"+e);}}},performSignPadUp:function(xp,yp){var epos={left:xp,top:yp};if(this.signpadUpInnerFunc!=null){this.signpadUpInnerFunc(this,epos);}if(this.signpadUpFunc!=null){try{this.signpadUpFunc(this,epos);}catch(e){alert("signpad up handler error:"+e);}}},clearInkOfCurrentLayer:function(){this.clearupTracers();this.currentLayer.Drawing.clearDrawItems();this.drawingBuffer.clearDrawItems();this.clearScreen();return true;},undoInkOfCurrentLayer:function(){var _214=this.currentLayer.Drawing;var num=_214.countDrawItems();if(num==0){return false;}this.clearupTracers();_214.deleteDrawItem(num-1);this.redrawCurrentLayerByInk();return true;},redoInkOfCurrentLayer:function(){var _215=this.currentLayer.Drawing;var num=_215.countDrawItems();var bnum=this.drawingBuffer.countDrawItems();if(num>=bnum){return false;}this.clearupTracers();_215.addDrawItem(this.drawingBuffer.getDrawItem(num));this.redrawCurrentLayerByInk();return true;},clearupTracers:function(){this.traceInterval();this.traceTimeout();this.clearTracers();},countDrawItems:function(){var _216=this.currentLayer.Drawing;return _216.countDrawItems();},countDrawItemCells:function(){var _217=this.currentLayer.Drawing;return _217.countCells();},countDrawItemFeatureCells:function(mode){var _218=this.currentLayer.Drawing;return _218.countFeatureCells(mode);},clearScreen:function(){var bctx=this.bcanvas.getContext("2d");bctx.clearRect(0,0,this.bcanvas.width,this.bcanvas.height);if(this.isDrawing!==true){this.arrayCell.length=0;this.arrayCopy.length=0;}this.clearDrawingCanvas();},redrawCurrentLayerByInk:function(){var _219=InkTool.InkLib;var _21a=this.currentLayer;if(_21a==null){return false;}this.clearScreen();var _21b,ctx;_21b=this.bcanvas;ctx=_21b.getContext("2d");var _21c=this.drawingContext.cloneWithContext(ctx);var _21d=_21a.Drawing;return this.drawInkTo(_21c,_21d);},drawInkTo:function(_21e,_21f){var _220=InkTool.InkLib;var _221=InkTool.InkCanvasLib;var _222=InkTool.InkLib.needsEmulateCanvas();var num=_21f.countDrawItems();for(var _223=0;_223<num;_223++){var _224=_21f.getDrawItem(_223);var _225=_224.getStationery();if(_225.hasFullDrawMode()&&this.useFullDraw){_225.fullDrawStart(_21e);}else{_225.drawStart(_21e);}var cnum=_224.countCells();for(var _226=0;_226<cnum;_226++){var _227=_224.getCell(_226);if(_225.hasFullDrawMode()&&this.useFullDraw){_225.fullStrokeDispatch(_21e,_227);}else{_225.strokeDispatch(_21e,_227,0);}}if(_225.hasFullDrawMode()&&this.useFullDraw){_225.fullDrawEnd(_21e);}else{_225.drawEnd(_21e);}}return true;},clearDrawingCanvas:function(){var ctx=this.dcanvas.getContext("2d");ctx.clearRect(0,0,this.dcanvas.width,this.dcanvas.height);if(InkTool.InkLib.needsEmulateCanvas()){ctx.strokeStyle="rgba(255,255,255,0.01)";ctx.fillStyle="rgba(255,255,255,0.01)";ctx.globalCompositeOperation="source-over";ctx.fillRect(0,0,this.dcanvas.width,this.dcanvas.height);}},clearTracers:function(){for(var _228 in this.traceList){packet=this.traceList[_228];delete this.traceList[_228];}},traceInterval:function(){var _229=InkTool.InkLib;var _22a=InkTool.InkCanvasLib;for(var idx=0;idx<_22a.TouchTraceList.length;idx++){var _22b=_22a.TouchTraceList[idx];this.doTraceInterval(_22b.List[this.id]);}for(var idx=0;idx<_22a.PointerTraceList.length;idx++){var _22b=_22a.PointerTraceList[idx];this.doTraceInterval(_22b.List[this.id]);}this.doTraceInterval(_22a.PenTrace.List[this.id]);},doTraceInterval:function(_22c){var _22d=InkTool.InkLib;var _22e=InkTool.InkCanvasLib;if(_22c==null||_22c.pen==null||_22c.arrayCell.length==0){return false;}var _22f,ctx;if(_22c.pen.hasFullDrawMode()===false||this.useFullDraw==false){_22f=this.bcanvas;ctx=_22f.getContext("2d");}else{_22f=this.dcanvas;ctx=this.dcontext;}var _230=_22c.drawingContext;_230.context=ctx;_22c.pen.drawStart(_230);var _231=0;while(_231<16&&_22c.arrayCell.length>0){var cell=_22c.arrayCell.shift();_231++;if(_22c.pen.hasFullDrawMode()&&this.useFullDraw){_22c.arrayCopy.push(cell);}_22c.pen.strokeDispatch(_230,cell,1);}_22c.pen.drawEnd(_230);return true;},traceTimeout:function(){var _232=InkTool.InkLib;var _233=InkTool.InkCanvasLib;var _234=this.dcanvas;var _235=this.bcanvas;var bctx=_235.getContext("2d");var _236=false;for(var idx=0;idx<_233.TouchTraceList.length;idx++){var _237=_233.TouchTraceList[idx];if(this.doTraceTimeout(_237.List[this.id])==true){_236=true;}}for(var idx=0;idx<_233.PointerTraceList.length;idx++){var _237=_233.PointerTraceList[idx];if(this.doTraceTimeout(_237.List[this.id])==true){_236=true;}}if(this.doTraceTimeout(_233.PenTrace.List[this.id])==true){_236=true;}if(_236==true){this.clearDrawingCanvas();}},doTraceTimeout:function(_238){if(_238==null){return false;}var _239=0;for(var _23a=0;_23a<_238.arrayCopy.length;_23a++){var stat=_238.arrayCopy[_23a].getMode();if(stat==2){_239=_23a+1;}}if(_239>0){var _23b=this.bcanvas;var bctx=_23b.getContext("2d");var _23c=this.drawingContext;var _23d=_23c.cloneWithContext(bctx);_23d.lastData=[];_238.pen.fullDrawStart(_23d);for(var _23a=0;_23a<_239;_23a++){var cell=_238.arrayCopy.shift();_238.pen.fullStrokeDispatch(_23d,cell);}_238.pen.fullDrawEnd(_23d);return true;}else{return false;}},tracePausing:function(){var _23e=InkTool.InkLib;var _23f=InkTool.InkCanvasLib;if(this.featureDetectingBendDist==0){return;}var _240=new Date();var crnt=_240.getTime();for(var idx=0;idx<_23f.TouchTraceList.length;idx++){var _241=_23f.TouchTraceList[idx];if(_241.crntMode>=0){this.doTracePausing(_241.List[this.id],crnt,0,null);}}for(var idx=0;idx<_23f.PointerTraceList.length;idx++){var _241=_23f.PointerTraceList[idx];if(_241.crntMode>=0){this.doTracePausing(_241.List[this.id],crnt,0,null);}}this.doTracePausing(_23f.PenTrace.List[this.id],crnt,0,null);},doTracePausing:function(_242,crnt,mode,_243){var _244=InkTool.InkLib;var _245=InkTool.InkCanvasLib;if(_242.pen==null||_242.currentStroke==null){return false;}var _246=_242.currentStroke.countCells();if(_246==0){return false;}var cell=_242.currentStroke.getCell(_246-1);var xp,yp,wd,tm,stat;if(mode==0){xp=cell.getX();yp=cell.getY();wd=cell.getWidth();tm=cell.getTime();stat=cell.getMode();}else{var epos=this.convertPositionDocumentToCanvas(_243.lastPos,this,this.drawingContext);xp=epos.left;yp=epos.top;wd=cell.getWidth();tm=crnt;stat=0;}if(stat==2){return false;}if(mode==0){if(crnt-tm<this.featureDetectingTimeDist){return false;}var _247=0;for(var idx=_246-1;idx>=0;idx--){var _248=_242.currentStroke.getCell(idx);var _249=_248.getMode();var oxp=_248.getX();var oyp=_248.getY();if(stat==0||stat==1||oxp!=xp||oyp!=yp){break;}_247++;}if(_247>2){return false;}}var _24a=new InkTool.InkCell(3,xp,yp,wd,0,crnt);if(_24a!=null){_242.currentStroke.addCell(_24a);if(_242.pen.hasFullDrawMode()==true&&this.useFullDraw){if(this.useEmulatingTimer==true){_242.arrayCell.push(_24a);}else{_242.pen.strokeDispatch(_242.drawingContext,_24a,1);_242.pen.drawEnd(_242.drawingContext);_242.arrayCopy.push(_24a);}}else{_242.pen.strokeDispatch(_242.drawingContext,_24a,1);}return true;}else{return false;}},benchMarkCircles:function(ccol,_24b,_24c,_24d){},dummy:function(){}});}InkTool.InkLib.Class.extend(InkTool.InkCanvasBase,(function(){var iobj={saveInkObjectShort:function(mode){var _24e=new Object();if(this.viewMode!=0){_24e.w=this.rect.getWidth();_24e.h=this.rect.getHeight();}else{_24e.w=this.inkWidth;_24e.h=this.inkHeight;}_24e.v=this.Version;_24e.is=new Array();savesrc=this.currentDrawing.clone();for(var _24f=0;_24f<savesrc.is.length;_24f++){var sobj=new Object();var ssrc=savesrc.is[_24f];var _250=0;var col={"A":ssrc.st.col.A,"R":ssrc.st.col.R,"G":ssrc.st.col.G,"B":ssrc.st.col.B};sobj.st={"col":col,"maxw":ssrc.st.maxw,"minw":ssrc.st.minw,"tp":ssrc.st.tp,"w":ssrc.st.w};var _251=ssrc.st.isPressureSensitive();sobj.cs=new Array();for(var _252=0;_252<ssrc.cs.length;_252++){var csrc=ssrc.cs[_252];if(mode!=null&&mode!=0){if(csrc.m==-1){continue;}}else{if(csrc.m==2){continue;}}if(_252==0){_250=csrc.t;}var cstr;var crnt=csrc.t;if(mode==0&&_252==ssrc.cs.length-2&&ssrc.cs[_252+1].m==2){crnt=ssrc.cs[_252+1].t;}if(_251){cstr=csrc.x+"|"+csrc.y+"|"+csrc.w+"|"+csrc.p+"|"+(crnt-_250);}else{cstr=csrc.x+"|"+csrc.y+"|"+(crnt-_250);}if(mode!=null&&mode!=0){cstr+=":"+csrc.m;}sobj.cs.push(cstr);}sobj.t=_250;_24e.is.push(sobj);}if(mode==0&&this.featureDetectingBendDist>0){_24e.fdp={"bd":this.featureDetectingBendDist,"st":this.featureDetectingStraightDist,"tm":this.featureDetectingTimeDist,"sp":this.featureDetectingSharpDist};}return _24e;},saveInkObject:function(){if(this.featureDetectingBendDist==0){return this.saveInkObjectShort(0);}else{return this.saveInkObjectShort(1);}},saveInkObjectLegacy:function(){return this.saveInkObjectShort(0);},saveInkObjectWithFeature:function(){return this.saveInkObjectShort(1);},saveInk:function(){var _253=this.saveInkObject();var _254=JSON.stringify(_253);return _254;},saveInkLegacy:function(){var _255=this.saveInkObjectLegacy();var _256=JSON.stringify(_255);return _256;},saveInkWithFeature:function(){var _257=this.saveInkObjectWithFeature();var _258=JSON.stringify(_257);return _258;},saveInkObjectLong:function(){var _259=this.currentDrawing.clone();if(this.viewMode!=0){_259.w=this.rect.getWidth();_259.h=this.rect.getHeight();}else{_259.w=this.inkWidth;_259.h=this.inkHeight;}_259.v=this.Version;return _259;},saveInkLong:function(){var _25a=this.saveInkObjectLong();var _25b=JSON.stringify(_25a);return _25b;},saveInkShort:function(){var _25c=this.saveInkObjectShort(1);var _25d=JSON.stringify(_25c);return _25d;},saveDebugCsv:function(){var resp="";return resp;},saveImage:function(){if(typeof (this.bcanvas.toDataURL)=="function"){var _25e=[];for(var _25f=0;_25f<arguments.length;_25f++){_25e[_25f]=arguments[_25f];}return this.saveImageSub(96,null,_25e);}else{return null;}},saveImageWithBGColor:function(){if(typeof (this.bcanvas.toDataURL)=="function"){var dpi=96;var _260=arguments[0];var _261=[];for(var _262=1;_262<arguments.length;_262++){_261[_262-1]=arguments[_262];}return this.saveImageSub(dpi,_260,_261);}else{return null;}},saveImageDPI:function(){if(typeof (this.bcanvas.toDataURL)=="function"){var dpi=arguments[0];var _263=[];for(var _264=1;_264<arguments.length;_264++){_263[_264-1]=arguments[_264];}return this.saveImageSub(dpi,null,_263);}else{return null;}},saveImageDPIWithBGColor:function(){if(typeof (this.bcanvas.toDataURL)=="function"){var dpi=arguments[0];var _265=arguments[1];var _266=[];for(var _267=2;_267<arguments.length;_267++){_266[_267-2]=arguments[_267];}return this.saveImageSub(dpi,_265,_266);}else{return null;}},saveImageSub:function(dpi,_268,_269){try{var _26a=96;var _26b,_26c;if(this.autoZoomRatio==false&&(this.baseWidth==0||this.baseHeight==0)){_26b=Math.round(this.rect.getWidth()*dpi/_26a);_26c=Math.round(this.rect.getHeight()*dpi/_26a);}else{_26b=Math.round(this.inkWidth*dpi/_26a);_26c=Math.round(this.inkHeight*dpi/_26a);}var _26d=InkTool.InkCanvasLib.createDummyCanvas(_26b,_26c);var _26e=dpi/_26a;var ctx=_26d.getContext("2d");ctx.clearRect(0,0,_26b,_26c);if(_268!=null){var _26f=new InkTool.InkColor(_268);ctx.fillStyle=_26f.getRGBA();ctx.fillRect(0,0,_26b,_26c);}var _270=this.currentLayer;if(_270!=null){var _271=new InkTool.DrawingContext(ctx,0,0,_26e);_271.setFeatureDetectingParams(this.featureDetectingBendDist,this.featureDetectingStraightDist,this.featureDetectingTimeDist,this.featureDetectingSharpDist);if(_268!=null){var _26f=new InkTool.InkColor(_268);_271.eraserBgColor=_26f;}var _272=_270.Drawing;this.drawInkTo(_271,_272);}var resp=_26d.toDataURL.apply(_26d,_269);InkTool.InkCanvasLib.releaseDummyCanvas();return resp;}catch(e){alert("saveImageSub error:"+e);return null;}},replayInk:function(_273,_274,_275){if(this.replayMode!=0){return false;}var _276=this.currentDrawing;var _277=_276.countDrawItems();if(_277==0){if(_275!=null){_275(this,0);}return false;}var _278=_276.getDrawItem(0);if(_278==null||_278.countCells()==0){if(_275!=null){_275(this,0);}return false;}var _279=_278.getCell(0);if(_279==null){if(_275!=null){_275(this,0);}return false;}this.replayMode=1;this.replaySpeed=_273;this.replayMaxInterval=_274;this.replayStrokeIndex=0;this.replayCellIndex=0;this.replayPackets=[];this.setupCanPenMove();var crnt=new Date();this.replayStartTime=crnt.getTime();this.replayTargetBaseTime=_279.getTime();this.replayLastTime=0;this.replayHandler=_275;var _27a=this.drawingContext;var _27b=this;this.clearScreen();var _27c=this.useFullDraw;this.replayTimer=setInterval(function(){var crnt=new Date();var _27d=crnt.getTime();var _27e=_27b.replayTargetBaseTime+Math.round((_27d-_27b.replayStartTime)*_27b.replaySpeed);for(var idx=_27b.replayStrokeIndex;idx<_277;idx++){var _27f=_276.getDrawItem(idx);var cpen=_27f.getStationery();var _280=_27f.getCell(0);if(_280.getTime()>_27e){break;}var _281,ctx;if(cpen.hasFullDrawMode()===false||_27c==false){_281=_27b.bcanvas;ctx=_281.getContext("2d");}else{_281=_27b.dcanvas;ctx=_27b.dcontext;}var _282=_27a.cloneWithContext(ctx);var _283={"stroke":_27f,"pen":cpen,"index":0,"finished":false,"drctx":_282};_27b.replayPackets.push(_283);_27b.replayStrokeIndex++;}for(var pct=0;pct<_27b.replayPackets.length;pct++){var _283=_27b.replayPackets[pct];_283.pen.drawStart(_283.drctx);}var _284=false;while(true){var _285=0;for(var pct=0;pct<_27b.replayPackets.length;pct++){var _283=_27b.replayPackets[pct];if(_283.finished==true){continue;}var _286=_283.pen;var _287=_283.stroke.getCell(_283.index);var _288=_283.stroke.countCells();var _289=_287.getTime();if(_289>_27e){continue;}_286.strokeDispatch(_283.drctx,_287,0);_285++;_283.index++;_27b.replayLastTime=_27d;if(_283.index>=_288){_283.finished=true;_286.drawEnd(_283.drctx);}}if(_285==0){break;}}var _28a=true;for(var pct=0;pct<_27b.replayPackets.length;pct++){var _283=_27b.replayPackets[pct];if(_283.finished==false){_283.pen.drawEnd(_283.drctx);_28a=false;}}if(_28a==true){for(var pct=0;pct<_27b.replayPackets.length;pct++){var _283=_27b.replayPackets[pct];var _286=_283.pen;var _288=_283.stroke.countCells();if(_286.hasFullDrawMode()&&_27c==true){var _28b=_27b.bcanvas;var bctx=_28b.getContext("2d");var _28c=_27a.cloneWithContext(bctx);_286.fullDrawStart(_28c);for(var _28d=0;_28d<_288;_28d++){var _28e=_283.stroke.getCell(_28d);_286.fullStrokeDispatch(_28c,_28e);}_286.fullDrawEnd(_28c);}}_27b.clearDrawingCanvas();_27b.replayPackets=[];if(_27b.replayStrokeIndex>=_277){if(_27b.replayTimer!=null){clearInterval(_27b.replayTimer);_27b.replayTimer=null;}_27b.replayMode=0;_27b.setupCanPenMove();if(_27b.replayHandler!=null){_27b.replayHandler(_27b,0);}}else{var _28f=_276.getDrawItem(_27b.replayStrokeIndex);var _290=_28f.getCell(0);var _289=_290.getTime();if(_27d>=_27b.replayLastTime+_27b.replayMaxInterval){_27b.replayTargetBaseTime+=(_289-_27e);}}}},60);return true;},replayInkOld:function(_291,_292,_293){if(this.replayMode!=0){return false;}var _294=this.currentDrawing;var _295=_294.countDrawItems();if(_295==0){if(_293!=null){_293(this,0);}return false;}var _296=_294.getDrawItem(0);if(_296==null||_296.countCells()==0){if(_293!=null){_293(this,0);}return false;}var _297=_296.getCell(0);if(_297==null){if(_293!=null){_293(this,0);}return false;}this.replayMode=1;this.replaySpeed=_291;this.replayMaxInterval=_292;this.replayStrokeIndex=0;this.replayCellIndex=0;this.replayPackets=[];this.setupCanPenMove();var crnt=new Date();this.replayStartTime=crnt.getTime();this.replayTargetBaseTime=_297.getTime();this.replayLastTime=0;this.replayHandler=_293;var _298=this.drawingContext;var _299=_298.clone();var _29a=this;this.clearScreen();var _29b=this.useFullDraw;this.replayTimer=setInterval(function(){var crnt=new Date();var _29c=crnt.getTime();var _29d=_29a.replayTargetBaseTime+Math.round((_29c-_29a.replayStartTime)*_29a.replaySpeed);var _29e=_294.getDrawItem(_29a.replayStrokeIndex);var _29f=_29e.getStationery();var _2a0,ctx;if(_29f.hasFullDrawMode()===false||_29b==false){_2a0=_29a.bcanvas;ctx=_2a0.getContext("2d");}else{_2a0=_29a.dcanvas;ctx=_29a.dcontext;}_299.context=ctx;_29f.drawStart(_299);var _2a1=false;while(true){var _2a2=_29e.getCell(_29a.replayCellIndex);var _2a3=_29e.countCells();var _2a4=_2a2.getTime();if(_2a4>_29d){if(_29c>=_29a.replayLastTime+_29a.replayMaxInterval){_29a.replayTargetBaseTime+=(_2a4-_29d);}else{break;}}_29a.replayLastTime=_29c;var xp=_2a2.getX();var yp=_2a2.getY();var wd=_2a2.getWidth();var tm=_2a2.getTime();if(_29a.replayCellIndex==0){_29f.strokeStart(_299,xp,yp,wd,tm);}else{if(_29a.replayCellIndex<_2a3-1){_29f.strokeMove(_299,xp,yp,wd,tm);}else{_29f.strokeEnd(_299,xp,yp,wd,tm);}}_29a.replayCellIndex++;if(_29a.replayCellIndex>=_2a3){_29f.drawEnd(_299);if(_29f.hasFullDrawMode()&&_29b){var _2a5=_29a.bcanvas;var bctx=_2a5.getContext("2d");var _2a6=_298.cloneWithContext(bctx);_29f.fullDrawStart(_2a6);for(var _2a7=0;_2a7<_2a3;_2a7++){var _2a8=_29e.getCell(_2a7);var xp=_2a8.getX();var yp=_2a8.getY();var wd=_2a8.getWidth();var tm=_2a8.getTime();if(_2a7==0){_29f.fullStrokeStart(_2a6,xp,yp,wd,tm);}else{if(_2a7<_2a3-1){_29f.fullStrokeMove(_2a6,xp,yp,wd,tm);}else{_29f.fullStrokeEnd(_2a6,xp,yp,wd,tm);}}}_29f.fullDrawEnd(_2a6);_29a.clearDrawingCanvas();}_29a.replayStrokeIndex++;_29a.replayCellIndex=0;if(_29a.replayStrokeIndex>=_295){_2a1=true;break;}_29e=_294.getDrawItem(_29a.replayStrokeIndex);_29f=_29e.getStationery();if(_29f.hasFullDrawMode()===false||_29b==false){_2a0=_29a.bcanvas;ctx=_2a0.getContext("2d");}else{_2a0=_29a.dcanvas;ctx=_29a.dcontext;}_299.context=ctx;_29f.drawStart(_299);}}if(_2a1){if(_29a.replayTimer!=null){clearInterval(_29a.replayTimer);_29a.replayTimer=null;}_29a.replayMode=0;_29a.setupCanPenMove();if(_29a.replayHandler!=null){_29a.replayHandler(_29a,0);}}else{_29f.drawEnd(_299);}},60);return true;},stopReplay:function(){if(this.replayMode==0){return;}if(this.replayTimer!=null){clearInterval(this.replayTimer);this.replayTimer=null;}this.replayMode=0;this.setupCanPenMove();if(this.replayHandler!=null){this.replayHandler(this,1);}this.redrawCurrentLayerByInk();},changeReplay:function(_2a9,_2aa){this.replaySpeed=_2a9;this.replayMaxInterval=_2aa;},isReplaying:function(){return (this.replayMode!=0);},getReplayCurrentStroke:function(){if(this.replayMode==0){return -1;}else{return this.replayStrokeIndex;}},getReplayMaxStroke:function(){return this.getNumStrokes();},dummy:function(){}};var resp={};if(InkTool.InkFlags.InkTool===true||InkTool.InkFlags.InkPDF===true){resp.saveInkObjectShort=iobj.saveInkObjectShort;}if(InkTool.InkFlags.InkTool===true){resp.saveInkObject=iobj.saveInkObject;resp.saveInkObjectLegacy=iobj.saveInkObjectLegacy;resp.saveInkObjectWithFeature=iobj.saveInkObjectWithFeature;resp.saveInk=iobj.saveInk;resp.saveInkLegacy=iobj.saveInkLegacy;resp.saveInkWithFeature=iobj.saveInkWithFeature;resp.saveInkObjectLong=iobj.saveInkObjectLong;resp.saveInkLong=iobj.saveInkLong;resp.saveInkShort=iobj.saveInkShort;resp.saveDebugCsv=iobj.saveDebugCsv;resp.saveImage=iobj.saveImage;resp.saveImageWithBGColor=iobj.saveImageWithBGColor;resp.saveImageDPI=iobj.saveImageDPI;resp.saveImageDPIWithBGColor=iobj.saveImageDPIWithBGColor;resp.saveImageSub=iobj.saveImageSub;resp.replayInk=iobj.replayInk;resp.replayInkOld=iobj.replayInkOld;resp.stopReplay=iobj.stopReplay;resp.changeReplay=iobj.changeReplay;resp.isReplaying=iobj.isReplaying;resp.getReplayCurrentStroke=iobj.getReplayCurrentStroke;resp.getReplayMaxStroke=iobj.getReplayMaxStroke;}return resp;})());InkTool.InkCanvasLib.registerCanvasClass("standard",InkTool.InkCanvasBase);if(typeof InkTool.InkCanvasActiveX==="undefined"){InkTool.InkCanvasActiveX=InkTool.InkLib.Class.create(null,{initialize:function(_1,_2,_3,_4,_5,_6,_7,_8){var _9=InkTool.InkLib;var _a=InkTool.InkCanvasLib;var _b=_9.getBrowserTypeName();if(_1==null){this.Initialized=false;return;}var _c=_9.getElementAbsoluteLocation(_1);var _d=_9.getElementLocation(_1);var _e=_9.getElementSize(_1);var _f=_3;if(_f==0){_f=_9.getStyleOfElement(_1,"z-index",null);}this.Version="1.0";this.CanvasType="activex";this.CanvasInfo=null;this.InitializeMode=8;this.InitializeModeStr="auto";this.doSetInitializeMode(_a.ActiveXInit);if(_8==true){if(_a.ActiveXSignPad!=null){_8=false;}else{_a.ActiveXSignPad=_1.id;}}this.UseSignPad=_8;this.InitWintabFit=_a.DeviceWintabFitControlSize;this.InitWintabFitParams=_9.deepCopy(_a.DeviceWintabFitControlSizeParams);this.InitMsinkIgnoreQuery=_a.DeviceMsinkIgnoreTabletQuery;this.InitMsinkDefSupportStatus=_a.DeviceMsinkDefSupportStatus;this.InitMsinkDefSupportPressure=_a.DeviceMsinkDefSupportPressure;this.InitSignPadFitParams=_9.deepCopy(_a.DeviceSignPadFitControlSizeParams);this.drawingMode=0;this.replayMode=0;this.hotspotMode=0;this.useEmulatingTimer=true;this.baseWidth=_5;this.baseHeight=_6;_1.onselectstart=function(){return false;};_1.ondragstart=function(){return false;};_1.style.userSelect="none";_1.style.MozUserSelect="none";_1.style.webkitUserSelect="none";_1.style.msUserSelect="none";_1.style.msTouchAction="none";_1.style.touchAction="none";this.id=_1.id;this.zorder=_3;this.ezindex=_f;this.dcanvas=document.createElement("object");var _10=document.createElement("param");_10.setAttribute("name","Appearance");_10.setAttribute("value","0");this.dcanvas.appendChild(_10);var _11=document.createElement("param");_11.setAttribute("name","BorderStyle");_11.setAttribute("value","0");this.dcanvas.appendChild(_11);var _12=document.createElement("param");_12.setAttribute("name","InitializeMode");_12.setAttribute("value",""+this.InitializeMode);this.dcanvas.appendChild(_12);var _13=document.createElement("param");_13.setAttribute("name","FitControlSize");_13.setAttribute("value",((this.InitWintabFit)?"1":"0"));this.dcanvas.appendChild(_13);var _14=document.createElement("param");_14.setAttribute("name","BaseWidth");if(this.baseWidth>0){_14.setAttribute("value",""+this.baseWidth);}else{_14.setAttribute("value",""+_e.width);}this.dcanvas.appendChild(_14);var _15=document.createElement("param");_15.setAttribute("name","BaseHeight");if(this.baseHeight>0){_15.setAttribute("value",""+this.baseHeight);}else{_15.setAttribute("value",""+_e.height);}this.dcanvas.appendChild(_15);var _16=document.createElement("param");_16.setAttribute("name","IgnoreTabletQuery");_16.setAttribute("value",((this.InitMsinkIgnoreQuery)?"1":"0"));this.dcanvas.appendChild(_16);var _17=document.createElement("param");_17.setAttribute("name","DefSupportedStatus");_17.setAttribute("value",((this.InitMsinkDefSupportStatus)?"1":"0"));this.dcanvas.appendChild(_17);var _18=document.createElement("param");_18.setAttribute("name","DefSupportedPressure");_18.setAttribute("value",((this.InitMsinkDefSupportPressure)?"1":"0"));this.dcanvas.appendChild(_18);var _19=document.createElement("param");_19.setAttribute("name","UseSignPad");_19.setAttribute("value",((this.UseSignPad)?"1":"0"));this.dcanvas.appendChild(_19);this.dcanvas.id="inktool_"+this.id+"_activex";this.dcanvas.classid="clsid:"+_a.ActiveXGuid;this.dcanvas.onselectstart=function(){return false;};this.dcanvas.ondragstart=function(){return false;};this.dcanvas.style.userSelect="none";this.dcanvas.style.MozUserSelect="none";this.dcanvas.style.webkitUserSelect="none";this.dcanvas.style.msUserSelect="none";this.dcanvas.style.msTouchAction="none";this.dcanvas.style.touchAction="none";this.dcanvas.style.position="absolute";this.dcanvas.style.left=""+_c.left+"px";this.dcanvas.style.top=""+_c.top+"px";this.dcanvas.width=_e.width;this.dcanvas.height=_e.height;if(_f!==null){this.dcanvas.style.zIndex=_f;}_9.addElementAfter(_1,this.dcanvas);this.bcanvas=null;this.slayer=null;var _1a=(document.body||document.getElementsByTagName("body")[0]);this.pddiv=document.createElement("div");if(_9.Browser.IE&&_9.BrowserVersion.IE<=8){this.pdscript=null;_1a.appendChild(this.pddiv);this.pddiv.innerHTML="&nbsp;<script LANGUAGE=\"JavaScript\" FOR=\""+this.dcanvas.id+"\" EVENT=\"OnPenDown(xp,yp)\" defer=\"defer\">InkTool.InkCanvasLib.performPenDown(\""+this.id+"\", xp, yp);</script>";}else{this.pdscript=document.createElement("script");this.pdscript.setAttribute("LANGUAGE","JavaScript");this.pdscript.setAttribute("FOR",this.dcanvas.id);this.pdscript.setAttribute("EVENT","OnPenDown(xp,yp)");var _1b=document.createTextNode("InkTool.InkCanvasLib.performPenDown('"+this.id+"', xp, yp);");this.pdscript.appendChild(_1b);this.pddiv.appendChild(this.pdscript);_1a.appendChild(this.pddiv);}this.pudiv=document.createElement("div");if(_9.Browser.IE&&_9.BrowserVersion.IE<=8){this.puscript=null;_1a.appendChild(this.pudiv);this.pudiv.innerHTML="&nbsp;<script LANGUAGE=\"JavaScript\" FOR=\""+this.dcanvas.id+"\" EVENT=\"OnPenUp(xp,yp)\" defer=\"defer\">InkTool.InkCanvasLib.performPenUp(\""+this.id+"\", xp, yp);</script>";}else{this.puscript=document.createElement("script");this.puscript.setAttribute("LANGUAGE","JavaScript");this.puscript.setAttribute("FOR",this.dcanvas.id);this.puscript.setAttribute("EVENT","OnPenUp(xp,yp)");var _1c=document.createTextNode("InkTool.InkCanvasLib.performPenUp('"+this.id+"', xp, yp);");this.puscript.appendChild(_1c);this.pudiv.appendChild(this.puscript);_1a.appendChild(this.pudiv);}this.sudiv=document.createElement("div");if(_9.Browser.IE&&_9.BrowserVersion.IE<=8){this.suscript=null;_1a.appendChild(this.sudiv);this.sudiv.innerHTML="&nbsp;<script LANGUAGE=\"JavaScript\" FOR=\""+this.dcanvas.id+"\" EVENT=\"OnSignPadUp(xp,yp)\" defer=\"defer\">InkTool.InkCanvasLib.performSignPadUp(\""+this.id+"\", xp, yp);</script>";}else{this.suscript=document.createElement("script");this.suscript.setAttribute("LANGUAGE","JavaScript");this.suscript.setAttribute("FOR",this.dcanvas.id);this.suscript.setAttribute("EVENT","OnSignPadUp(xp,yp)");var _1d=document.createTextNode("InkTool.InkCanvasLib.performSignPadUp('"+this.id+"', xp, yp);");this.suscript.appendChild(_1d);this.sudiv.appendChild(this.suscript);_1a.appendChild(this.sudiv);}this.rect=new InkTool.InkRect(_c.left,_c.top,_e.width,_e.height);this.srect=new InkTool.InkRect(_d.left,_d.top,_e.width,_e.height);this.isDrawing=false;this.drawingContext=new InkTool.DrawingContext(null,0,0,1);this.autoZoomRatio=true;if(this.baseWidth>0){this.inkWidth=this.baseWidth;}else{this.inkWidth=_e.width;}if(this.baseHeight>0){this.inkHeight=this.baseHeight;}else{this.inkHeight=_e.height;}this.backColor=new InkTool.InkColor("rgba(0, 0, 0, 0.0)");this.pen=null;this.pageIndex=_2;if(this.pageIndex==0){this.pageIndex=_a.InkData.Note.countPages()+1;}this.penDownPreFunc=null;this.penDownFunc=null;this.penMoveFunc=null;this.penUpFunc=null;this.signpadUpFunc=null;this.penDownInnerPreFunc=null;this.penDownInnerFunc=null;this.penMoveInnerFunc=null;this.penUpInnerFunc=null;this.signpadUpInnerFunc=null;this.subcanvas=new InkTool.InkCanvasBase(_1,0,_3,0,_5,_6);this.subcanvas.display(false);this.canvasmode=0;this.startTime=null;this.endTime=null;if(this.pageIndex>0){var _1e=_a.InkData.Note.countPages();if(_1e<this.pageIndex){_a.InkData.Note.addPages(this.pageIndex-_1e);}this.currentPage=_a.InkData.Note.getPage(this.pageIndex-1);this.currentLayer=this.currentPage.getCurrentLayer();this.currentDrawing=this.currentLayer.Drawing;}else{this.currentPage=null;this.currentLayer=null;this.currentDrawing=null;}this.clearDrawingCanvas();this.drawingBuffer=new InkTool.InkDrawing();this.drawingMode=1;this.replayMode=0;this.replaySpeed=1;this.replayMaxInterval=1000;this.replayStrokeIndex=0;this.replayCellIndex=0;this.replayStartTime=0;this.replayTargetBaseTime=0;this.replayLastTime=0;this.replayPackets=[];this.replayHandler=null;this.replayTimer=null;if(this.dcanvas!=null){var _1f=this.dcanvas.GetInkToolInfo();var _20=this.InitWintabFitParams;this.dcanvas.SetFitControlSizeDetail(_20.ControlMargin.Left,_20.ControlMargin.Top,_20.ControlMargin.Right,_20.ControlMargin.Bottom,(_20.KeepAspectRatio==true)?1:0,(_20.EmbedTabletInControl==true)?1:0,_20.Alignment.Horizontal,_20.Alignment.Vertical);if(this.isSignPadAvailable()==true){_20=this.InitSignPadFitParams;this.dcanvas.SetSignPadFitDetail(_20.ControlMargin.Left,_20.ControlMargin.Top,_20.ControlMargin.Right,_20.ControlMargin.Bottom,(_20.KeepAspectRatio==true)?1:0,(_20.EmbedTabletInControl==true)?1:0,_20.Alignment.Horizontal,_20.Alignment.Vertical);if(_a.DeviceSignPadBackImageURL!=null){this.setSignPadImageURL(_a.DeviceSignPadBackImageURL);}}}},setupTracePacket:function(){this.subcanvas.setupTracePacket();},setupCanPenMove:function(){this.subcanvas.setupCanPenMove();},getVersion:function(){return this.getCanvasInfo("version");},getCanvasType:function(){if(this.canvasmode==0){return this.CanvasType;}else{return this.subcanvas.getCanvasType();}},getCanvasInfo:function(key){if(this.canvasmode==0){this.setupCanvasInfo();if(key===undefined||key===null||key===""){return this.CanvasInfo;}else{if(this.CanvasInfo==null){return null;}else{return this.CanvasInfo[key];}}}else{return this.subcanvas.getCanvasInfo(key);}},setupCanvasInfo:function(){if(this.CanvasInfo==null){var _21=this.dcanvas.GetInkToolInfo();this.CanvasInfo=JSON.parse(_21);if(this.CanvasInfo["signpad"]==null){this.CanvasInfo["signpad"]=false;}if(this.CanvasInfo["replay"]==null){this.CanvasInfo["replay"]=false;}}},getDeviceType:function(){if(this.canvasmode==0){var _22=this.dcanvas.GetDriveMode();if(_22<0){return "unknown";}else{if(_22==0){return "none";}else{if(_22==1){return "wintab";}else{if(_22==2){return "msink";}else{if(_22==3){return "mouse";}else{return "unknown";}}}}}}else{return this.subcanvas.getDeviceType();}},setDevicePriority:function(_23){var _24=this.InitializeMode;if(this.doSetInitializeMode(_23)==false){return false;}if(_24!=this.InitializeMode){this.dcanvas.CloseTablet();this.dcanvas.InitializeMode=this.InitializeMode;if(this.canvasmode==0){this.dcanvas.OpenTablet();}}return true;},doSetInitializeMode:function(_25){if(_25=="auto"){this.InitializeMode=8;}else{if(_25=="wintab"){this.InitializeMode=6;}else{if(_25=="msink"){this.InitializeMode=7;}else{if(_25=="mouse"){this.InitializeMode=3;}else{return false;}}}}this.InitializeModeStr=_25;return true;},getDevicePriority:function(){return this.InitializeModeStr;},setDeviceFitControlSize:function(fit){if(fit!=this.InitWintabFit){this.InitWintabFit=fit;this.dcanvas.FitControlSize=((this.InitWintabFit==true)?1:0);return true;}return false;},getDeviceFitControlSize:function(){return this.InitWintabFit;},setDeviceFitControlSizeParams:function(_26,_27,_28,_29,_2a,_2b,_2c,_2d){var _2e=InkTool.InkLib;var _2f=_2e.deepCopy(this.InitWintabFitParams);_2f.ControlMargin.Left=_26;_2f.ControlMargin.Top=_27;_2f.ControlMargin.Right=_28;_2f.ControlMargin.Bottom=_29;_2f.KeepAspectRatio=_2a;_2f.EmbedTabletInControl=_2b;_2f.Alignment.Horizontal=_2c;_2f.Alignment.Vertical=_2d;if(_2e.deepEquals(_2f,this.InitWintabFitParams)==false){this.InitWintabFitParams=_2f;this.setupDeviceFitControlSizeParams();return true;}return false;},setupDeviceFitControlSizeParams:function(){var _30=this.InitWintabFitParams;this.dcanvas.SetFitControlSizeDetail(_30.ControlMargin.Left,_30.ControlMargin.Top,_30.ControlMargin.Right,_30.ControlMargin.Bottom,(_30.KeepAspectRatio==true)?1:0,(_30.EmbedTabletInControl==true)?1:0,_30.Alignment.Horizontal,_30.Alignment.Vertical);},setDeviceFitControlSizeControlMargin:function(_31,_32,_33,_34){var _35=InkTool.InkLib;var _36=_35.deepCopy(this.InitWintabFitParams);_36.ControlMargin.Left=_31;_36.ControlMargin.Top=_32;_36.ControlMargin.Right=_33;_36.ControlMargin.Bottom=_34;if(_35.deepEquals(_36,this.InitWintabFitParams)==false){this.InitWintabFitParams=_36;this.setupDeviceFitControlSizeParams();return true;}return false;},getDeviceFitControlSizeControlMargin:function(){return this.InitWintabFitParams.ControlMargin;},setDeviceFitControlSizeKeepAspectRatio:function(_37){var _38=this.InitWintabFitParams;if(_38.KeepAspectRatio!=_37){_38.KeepAspectRatio=_37;this.setupDeviceFitControlSizeParams();return true;}return false;},getDeviceFitControlSizeKeepAspectRatio:function(){return this.InitWintabFitParams.KeepAspectRatio;},setDeviceFitControlSizeEmbedTabletInControl:function(_39){var _3a=this.InitWintabFitParams;if(_3a.EmbedTabletInControl!=_39){_3a.EmbedTabletInControl=_39;this.setupDeviceFitControlSizeParams();return true;}return false;},getDeviceFitControlSizeEmbedTabletInControl:function(){return this.InitWintabFitParams.EmbedTabletInControl;},setDeviceFitControlSizeAlignment:function(_3b,_3c){var _3d=this.InitWintabFitParams;if(_3d.Alignment.Horizontal!=_3b||_3d.Alignment.Vertical!=_3c){_3d.Alignment.Horizontal=_3b;_3d.Alignment.Vertical=_3c;this.setupDeviceFitControlSizeParams();return true;}return false;},getDeviceFitControlSizeAlignment:function(){return this.InitWintabFitParams.Alignment;},setDeviceIgnoreTabletQuery:function(_3e,_3f,_40){if(_3e!=this.InitMsinkIgnoreQuery||_3f!=this.InitMsinkDefSupportStatus||_40!=this.InitMsinkDefSupportPressure){this.InitMsinkIgnoreQuery=_3e;this.InitMsinkDefSupportStatus=_3f;this.InitMsinkDefSupportPressure=_40;this.dcanvas.IgnoreTabletQuery=((this.InitMsinkIgnoreQuery==true)?1:0);this.dcanvas.DefSupportedStatus=((this.InitMsinkDefSupportStatus==true)?1:0);this.dcanvas.DefSupportedPressure=((this.InitMsinkDefSupportPressure==true)?1:0);return true;}return false;},getDeviceIgnoreTabletQuery:function(){return this.InitMsinkIgnoreQuery;},getDeviceDefSupportStatus:function(){return this.InitMsinkDefSupportStatus;},getDeviceDefSupportPressure:function(){return this.InitMsinkDefSupportPressure;},setSignPadPossible:function(_41){var _42=this.UseSignPad;this.UseSignPad=_41;if(_42!=this.UseSignPad){if(this.isSignPadAvailable()==true){this.dcanvas.CloseTablet();this.dcanvas.UseSignPad=this.UseSignPad;if(this.canvasmode==0){this.dcanvas.OpenTablet();}}}return true;},getSignPadPossible:function(){return this.UseSignPad;},isSignPadAvailable:function(){this.setupCanvasInfo();return this.CanvasInfo["signpad"];},isSignPadConnecting:function(){if(this.isSignPadAvailable()==false){return false;}return (this.dcanvas.GetSignPadIsConnecting()>0);},getSignPadInfo:function(){var _43=0;var _44="";var _45="";var _46=0;var _47=0;if(this.isSignPadAvailable()==true){_43=this.dcanvas.GetSignPadType();if(_43!=0){_44=this.dcanvas.GetSignPadName();_46=this.dcanvas.GetSignPadLEDWidth();_47=this.dcanvas.GetSignPadLEDHeight();}if(_43>=2){_45=this.dcanvas.GetSignPadID();}}return {"type":_43,"name":_44,"id":_45,"width":_46,"height":_47};},setSignPadFitControlSizeParams:function(_48,_49,_4a,_4b,_4c,_4d,_4e,_4f){var _50=InkTool.InkLib;var _51=_50.deepCopy(this.InitSignPadFitParams);_51.ControlMargin.Left=_48;_51.ControlMargin.Top=_49;_51.ControlMargin.Right=_4a;_51.ControlMargin.Bottom=_4b;_51.KeepAspectRatio=_4c;_51.EmbedTabletInControl=_4d;_51.Alignment.Horizontal=_4e;_51.Alignment.Vertical=_4f;if(_50.deepEquals(_51,this.InitSignPadFitParams)==false){this.InitSignPadFitParams=_51;this.setupSignPadFitControlSizeParams();return true;}return false;},setupSignPadFitControlSizeParams:function(){var _52=this.InitSignPadFitParams;this.dcanvas.SetSignPadFitDetail(_52.ControlMargin.Left,_52.ControlMargin.Top,_52.ControlMargin.Right,_52.ControlMargin.Bottom,(_52.KeepAspectRatio==true)?1:0,(_52.EmbedTabletInControl==true)?1:0,_52.Alignment.Horizontal,_52.Alignment.Vertical);},setSignPadFitControlSizeControlMargin:function(_53,_54,_55,_56){var _57=InkTool.InkLib;var _58=_57.deepCopy(this.InitSignPadFitParams);_58.ControlMargin.Left=_53;_58.ControlMargin.Top=_54;_58.ControlMargin.Right=_55;_58.ControlMargin.Bottom=_56;if(_57.deepEquals(_58,this.InitSignPadFitParams)==false){this.InitSignPadFitParams=_58;this.setupSignPadFitControlSizeParams();return true;}return false;},getSignPadFitControlSizeControlMargin:function(){return this.InitSignPadFitParams.ControlMargin;},setSignPadFitControlSizeKeepAspectRatio:function(_59){var _5a=this.InitSignPadFitParams;if(_5a.KeepAspectRatio!=_59){_5a.KeepAspectRatio=_59;this.setupSignPadFitControlSizeParams();return true;}return false;},getSignPadFitControlSizeKeepAspectRatio:function(){return this.InitSignPadFitParams.KeepAspectRatio;},setSignPadFitControlSizeEmbedSignPadInControl:function(_5b){var _5c=this.InitSignPadFitParams;if(_5c.EmbedTabletInControl!=_5b){_5c.EmbedTabletInControl=_5b;this.setupSignPadFitControlSizeParams();return true;}return false;},getSignPadFitControlSizeEmbedSignPadInControl:function(){return this.InitSignPadFitParams.EmbedTabletInControl;},setSignPadFitControlSizeAlignment:function(_5d,_5e){var _5f=this.InitSignPadFitParams;if(_5f.Alignment.Horizontal!=_5d||_5f.Alignment.Vertical!=_5e){_5f.Alignment.Horizontal=_5d;_5f.Alignment.Vertical=_5e;this.setupSignPadFitControlSizeParams();return true;}return false;},getSignPadFitControlSizeAlignment:function(){return this.InitSignPadFitParams.Alignment;},setUseEmulatingTimer:function(_60){this.useEmulatingTimer=_60;this.subcanvas.setUseEmulatingTimer(_60);},getUseEmulatingTimer:function(){return this.useEmulatingTimer;},setFeatureDetectingParams:function(_61,_62,_63,_64){this.subcanvas.setFeatureDetectingParams(_61,_62,_63,_64);},setFeatureDetectingBend:function(_65){this.subcanvas.setFeatureDetectingBend(_65);},getFeatureDetectingBend:function(){return this.subcanvas.getFeatureDetectingBend();},setFeatureDetectingStraight:function(_66){this.subcanvas.setFeatureDetectingStraight(_66);},getFeatureDetectingStraight:function(){return this.subcanvas.getFeatureDetectingStraight();},setFeatureDetectingTime:function(_67){this.subcanvas.setFeatureDetectingTime(_67);},getFeatureDetectingTime:function(){return this.subcanvas.getFeatureDetectingTime();},setFeatureDetectingSharp:function(_68){this.subcanvas.setFeatureDetectingSharp(_68);},getFeatureDetectingSharp:function(){return this.subcanvas.getFeatureDetectingSharp();},getId:function(){return this.id;},getNumStrokes:function(){if(this.canvasmode==0){return this.dcanvas.GetDrawCount();}else{return this.subcanvas.getNumStrokes();}},getMaxStrokes:function(){if(this.canvasmode==0){return this.dcanvas.GetMaxDrawCount();}else{return this.subcanvas.getMaxStrokes();}},getNumCells:function(){if(this.canvasmode==0){return 0;}else{return this.subcanvas.getNumCells();}},getNumFeatureCells:function(_69){if(this.canvasmode==0){return 0;}else{return this.subcanvas.getNumFeatureCells(_69);}},setDrawingMode:function(_6a){this.drawingMode=_6a;var _6b=this.dcanvas;setTimeout(function(){_6b.PacketEnable=((_6a!=0)?1:0);},50);this.subcanvas.setDrawingMode(_6a);},getDrawingMode:function(){return this.drawingMode;},setHandler:function(_6c,_6d){if(_6c=="prependown"){this.penDownPreFunc=_6d;}else{if(_6c=="pendown"){this.penDownFunc=_6d;}else{if(_6c=="penmove"){this.penMoveFunc=_6d;}else{if(_6c=="penup"){this.penUpFunc=_6d;}else{if(_6c=="signpadup"){this.signpadUpFunc=_6d;}}}}}this.subcanvas.setHandler(_6c,_6d);},setAutoZoomRatio:function(){this.autoZoomRatio=true;this.calcAutoZoomRatio();this.subcanvas.setAutoZoomRatio();},calcAutoZoomRatio:function(){var _6e,_6f;if(this.baseWidth>0){_6e=this.baseWidth/this.inkWidth;}else{_6e=this.rect.getWidth()/this.inkWidth;}if(this.baseHeight>0){_6f=this.baseHeight/this.inkHeight;}else{_6f=this.rect.getHeight()/this.inkHeight;}if(_6e<=_6f){this.dcanvas.ScaleW=_6e;this.dcanvas.ScaleH=_6e;}else{this.dcanvas.ScaleW=_6f;this.dcanvas.ScaleH=_6f;}this.dcanvas.OffsetX=0;this.dcanvas.OffsetY=0;},setZoomRatio:function(_70){this.autoZoomRatio=false;if(this.baseWidth>0||this.baseHeight>0){this.baseWidth=0;this.baseHeight=0;this.dcanvas.BaseWidth=this.rect.getWidth();this.dcanvas.BaseHeight=this.rect.getHeight();}this.dcanvas.ScaleW=_70;this.dcanvas.ScaleH=_70;this.inkWidth=Math.round(this.rect.getWidth()/this.drawingContext.getZoomRatio());this.inkHeight=Math.round(this.rect.getHeight()/this.drawingContext.getZoomRatio());this.subcanvas.setZoomRatio(_70);},setOffset:function(_71,_72){this.autoZoomRatio=false;this.dcanvas.OffsetX=_71;this.dcanvas.OffsetY=_72;this.subcanvas.setOffset(_71,_72);},setPen:function(pen){if(pen.isAutomaticSwitchover()==true){this.pen=pen.activeXPen;}else{this.pen=pen;}var _73=this.pen.getPenType();var _74=this.pen.getPenWidth();var _75=this.pen.getPenMinWidth();var _76=this.pen.getPenMaxWidth();var _77=this.pen.getPenColor();var red=_77.R;var _78=_77.G;var _79=_77.B;var _7a=_77.A;var _7b=red+(_78*256)+(_79*65536);this.dcanvas.UsePenPressure=1;this.dcanvas.SetPen(_73,_74,_75,_76,_7b,_7a);this.subcanvas.setPen(pen);return true;},setBackgroundColor:function(_7c){var red=_7c.R;var _7d=_7c.G;var _7e=_7c.B;var _7f=red+(_7d*256)+(_7e*65536);this.dcanvas.BackColor=_7f;},setBackgroundImageURL:function(url){var _80=InkTool.InkLib.getAbsoluteURL(url);this.dcanvas.LoadBackImageURL(_80);},setSignPadImageURL:function(url){if(this.isSignPadAvailable()==true){var _81=InkTool.InkLib.getAbsoluteURL(url);this.dcanvas.LoadSignPadImageURL(_81);}},setActiveXMode:function(_82){if(_82==true){this.dcanvas.OpenTablet();this.canvasmode=0;this.display(true);this.subcanvas.display(false);}else{this.canvasmode=1;this.subcanvas.display(true);this.display(false);this.dcanvas.CloseTablet();}},relayout:function(){var _83=InkTool.InkLib;var _84=InkTool.InkCanvasLib;var _85=_83.getElementById(this.id);if(_85==null){return false;}var _86=_83.getElementAbsoluteLocation(_85);var _87=_83.getElementLocation(_85);var _88=_83.getElementSize(_85);var _89=this.zorder;if(_89==0){_89=_83.getStyleOfElement(_85,"z-index",null);}this.dcanvas.style.left=""+_86.left+"px";this.dcanvas.style.top=""+_86.top+"px";this.dcanvas.width=_88.width;this.dcanvas.height=_88.height;this.dcanvas.style.zIndex=_89;this.rect=new InkTool.InkRect(_86.left,_86.top,_88.width,_88.height);this.srect=new InkTool.InkRect(_87.left,_87.top,_88.width,_88.height);this.inkWidth=Math.round(_88.width/this.drawingContext.getZoomRatio());this.inkHeight=Math.round(_88.height/this.drawingContext.getZoomRatio());this.subcanvas.relayout();var cvs=this;if(cvs.baseWidth==0){cvs.dcanvas.BaseWidth=_88.width;}if(cvs.baseHeight==0){cvs.dcanvas.BaseHeight=_88.height;}if(InkTool.InkLib.needsEmulateCanvas()){if(this.canvasmode==0){cvs.display(false);setTimeout(function(){cvs.display(true);},0);}}else{cvs.dcanvas.RelayoutControl(1);}return true;},relocation:function(){var _8a=InkTool.InkLib;var _8b=InkTool.InkCanvasLib;var _8c=_8a.getElementById(this.id);if(_8c!=null){var _8d=_8a.getElementAbsoluteLocation(_8c);var _8e=_8a.getElementLocation(_8c);this.rect.left=_8d.left;this.rect.top=_8d.top;this.srect.left=_8e.left;this.srect.top=_8e.top;}this.subcanvas.relocation();},display:function(_8f){var _90=InkTool.InkLib;var _91=InkTool.InkCanvasLib;if(_8f){_90.showElement(this.dcanvas);}else{_90.hideElement(this.dcanvas);}},clearInk:function(){if(this.canvasmode==0){this.clearInkOfCurrentLayer();}else{this.subcanvas.clearInk();}},undoInk:function(){if(this.canvasmode==0){this.undoInkOfCurrentLayer();}else{this.subcanvas.undoInk();}},redoInk:function(){if(this.canvasmode==0){this.redoInkOfCurrentLayer();}else{this.subcanvas.redoInk();}},saveInk:function(){if(this.canvasmode==0){var _92=this.dcanvas.SaveInkJson();if(this.baseWidth==0||this.baseHeight==0){var _93=JSON.parse(_92);_93["w"]=this.inkWidth;_93["h"]=this.inkHeight;return JSON.stringify(_93);}else{return _92;}}else{return this.subcanvas.saveInk();}},saveInkLegacy:function(){if(this.canvasmode==0){var _94=this.dcanvas.SaveInkJson();if(this.baseWidth==0||this.baseHeight==0){var _95=JSON.parse(_94);_95["w"]=this.inkWidth;_95["h"]=this.inkHeight;return JSON.stringify(_95);}else{return _94;}}else{return this.subcanvas.saveInkLegacy();}},saveInkWithFeature:function(){if(this.canvasmode==0){var _96=this.dcanvas.SaveInkJson();if(this.baseWidth==0||this.baseHeight==0){var _97=JSON.parse(_96);_97["w"]=this.inkWidth;_97["h"]=this.inkHeight;return JSON.stringify(_97);}else{return _96;}}else{return this.subcanvas.saveInkWithFeature();}},loadInk:function(_98){if(this.canvasmode==0){var _99=JSON.parse(_98);this.inkWidth=_99.w;this.inkHeight=_99.h;if(this.autoZoomRatio){this.baseWidth=_99.w;this.dcanvas.BaseWidth=_99.w;this.baseHeight=_99.h;this.dcanvas.BaseHeight=_99.h;this.calcAutoZoomRatio();}this.dcanvas.LoadInkJson(_98);}else{this.subcanvas.loadInk(_98);}},saveImage:function(){if(this.canvasmode==0){var _9a=this.dcanvas.SaveImageTextWithBGColor(1,96,0,0);var _9b="data:image/png;base64,"+_9a;return _9b;}else{return this.subcanvas.saveImage.apply(this.subcanvas,arguments);}},saveImageWithBGColor:function(){if(this.canvasmode==0){var dpi=96;var _9c=arguments[0];var _9d=new InkTool.InkColor(_9c);var red=_9d.R;var _9e=_9d.G;var _9f=_9d.B;var _a0=_9d.A;var _a1=red+(_9e*256)+(_9f*65536);var _a2=this.dcanvas.SaveImageTextWithBGColor(1,dpi,2,_a1);var _a3="data:image/png;base64,"+_a2;return _a3;}else{return this.subcanvas.saveImageWithBGColor.apply(this.subcanvas,arguments);}},saveImageDPI:function(){if(this.canvasmode==0){var dpi=arguments[0];var _a4=this.dcanvas.SaveImageTextWithBGColor(1,dpi,0,0);var _a5="data:image/png;base64,"+_a4;return _a5;}else{return this.subcanvas.saveImageDPI.apply(this.subcanvas,arguments);}},saveImageDPIWithBGColor:function(){if(this.canvasmode==0){var dpi=arguments[0];var _a6=arguments[1];var _a7=new InkTool.InkColor(_a6);var red=_a7.R;var _a8=_a7.G;var _a9=_a7.B;var _aa=_a7.A;var _ab=red+(_a8*256)+(_a9*65536);var _ac=this.dcanvas.SaveImageTextWithBGColor(1,dpi,2,_ab);var _ad="data:image/png;base64,"+_ac;return _ad;}else{return this.subcanvas.saveImageDPIWithBGColor.apply(this.subcanvas,arguments);}},replayInk:function(_ae,_af,_b0){return false;},stopReplay:function(){},changeReplay:function(_b1,_b2){},isReplaying:function(){return false;},getReplayCurrentStroke:function(){return -1;},getReplayMaxStroke:function(){if(this.canvasmode==0){return this.getNumStrokes();}else{return this.subcanvas.getReplayMaxStroke();}},isCanvasTag:function(_b3){if(this.canvasmode==0){var tid=(_b3?_b3.id:"");return (this.id===tid||this.dcanvas.id===tid);}else{return this.subcanvas.isCanvasTag(_b3);}},isCanvasId:function(tid){if(this.canvasmode==0){return (this.dcanvas.id===tid||this.id===tid);}else{return this.subcanvas.isCanvasId(tid);}},convertPositionElementToCanvas:function(_b4,pos){return {"left":(pos.left/_b4.getZoomRatio())+_b4.getOffsetX(),"top":(pos.top/_b4.getZoomRatio())+_b4.getOffsetY()};},convertPositionCanvasToElement:function(_b5,pos){return {"left":(pos.left-_b5.getOffsetX())*_b5.getZoomRatio(),"top":(pos.top-_b5.getOffsetY())*_b5.getZoomRatio()};},doPenDown:function(_b6,_b7){if(this.canvasmode!=0){return this.subcanvas.doPenDown(_b6,_b7);}else{return false;}},performPenDown:function(xp,yp){if(this.canvasmode!=0){this.subcanvas.performPenDown(xp,yp);return;}var _b8={left:xp,top:yp};if(this.penDownInnerFunc!=null){this.penDownInnerFunc(this,_b8);}if(this.penDownFunc!=null){this.penDownFunc(this,_b8);}},doPenMove:function(_b9){if(this.canvasmode!=0){return this.subcanvas.doPenMove(_b9);}else{return false;}},performPenMove:function(xp,yp){if(this.canvasmode!=0){this.subcanvas.performPenMove(xp,yp);return;}var _ba={left:xp,top:yp};if(this.penMoveInnerFunc!=null){this.penMoveInnerFunc(this,_ba);}if(this.penMoveFunc!=null){this.penMoveFunc(this,_ba);}},doPenUp:function(_bb,_bc){if(this.canvasmode!=0){return this.subcanvas.doPenUp(_bb,_bc);}else{return false;}},performPenUp:function(xp,yp){if(this.canvasmode!=0){this.subcanvas.performPenUp(xp,yp);return;}var _bd={left:xp,top:yp};if(this.penUpInnerFunc!=null){this.penUpInnerFunc(this,_bd);}if(this.penUpFunc!=null){this.penUpFunc(this,_bd);}},performSignPadUp:function(xp,yp){if(this.canvasmode!=0){this.subcanvas.performSignPadUp(xp,yp);return;}var _be={left:xp,top:yp};if(this.singpadUpInnerFunc!=null){this.signpadUpInnerFunc(this,_be);}if(this.signpadUpFunc!=null){this.signpadUpFunc(this,_be);}},clearInkOfCurrentLayer:function(){this.clearScreen();return true;},undoInkOfCurrentLayer:function(){var _bf=this.getNumStrokes();if(_bf==0){return false;}this.dcanvas.UndoInk();return true;},redoInkOfCurrentLayer:function(){var num=this.getNumStrokes();var _c0=this.getMaxStrokes();if(num>=_c0){return false;}this.dcanvas.RedoInk();return true;},countDrawItems:function(){var _c1=this.currentLayer.Drawing;return _c1.countDrawItems();},clearScreen:function(){this.clearDrawingCanvas();},redrawCurrentLayerByInk:function(){if(this.canvasmode!=0){this.subcanvas.redrawCurrentLayerByInk();}},clearDrawingCanvas:function(){if(this.canvasmode==0){this.dcanvas.ClearInk();}else{this.subcanvas.clearDrawingCanvas();}},clearTracers:function(){if(this.canvasmode==0){for(var _c2 in this.traceList){packet=this.traceList[_c2];delete this.traceList[_c2];}}else{this.subcanvas.clearTracers();}},traceInterval:function(){if(this.canvasmode!=0){this.subcanvas.traceInterval();}},traceTimeout:function(){if(this.canvasmode!=0){this.subcanvas.traceTimeout();}},doTraceTimeout:function(_c3){this.subcanvas.doTraceTimeout(_c3);},tracePausing:function(){if(this.canvasmode!=0){this.subcanvas.tracePausing();}},doTracePausing:function(_c4,_c5,_c6,_c7){this.subcanvas.doTracePausing(_c4,_c5,_c6,_c7);},benchMarkCircles:function(){this.subcanvas.benchMarkCircles();},dummy:function(){}});}InkTool.InkCanvasLib.registerCanvasClass("activex",InkTool.InkCanvasActiveX);InkTool.InkCanvasLib.setActiveX("INKTOOLNX.InkToolNXCtrl.110","09147895-52B1-4e49-BFC3-54882B3B78D5","auto");